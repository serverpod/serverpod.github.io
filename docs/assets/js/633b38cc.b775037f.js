"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[36406],{91339:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>l,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"get-started/working-with-database","title":"Working with the database","description":"A core feature of Serverpod is to query the database easily. Serverpod provides an ORM that supports type and null safety.","source":"@site/versioned_docs/version-2.6.0/01-get-started/08-working-with-database.md","sourceDirName":"01-get-started","slug":"/get-started/working-with-database","permalink":"/2.6.0/get-started/working-with-database","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-2.6.0/01-get-started/08-working-with-database.md","tags":[],"version":"2.6.0","sidebarPosition":8,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Serializing data","permalink":"/2.6.0/get-started/serializing-data"},"next":{"title":"Where to go next","permalink":"/2.6.0/get-started/next-steps"}}');var s=t(74848),r=t(28453);const i={},o="Working with the database",d={},c=[{value:"Connecting to the database",id:"connecting-to-the-database",level:2},{value:"Migrations",id:"migrations",level:2},{value:"Object database mapping",id:"object-database-mapping",level:2},{value:"Writing to database",id:"writing-to-database",level:2},{value:"Reading from database",id:"reading-from-database",level:2}];function h(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"working-with-the-database",children:"Working with the database"})}),"\n",(0,s.jsx)(a.p,{children:"A core feature of Serverpod is to query the database easily. Serverpod provides an ORM that supports type and null safety."}),"\n",(0,s.jsx)(a.h2,{id:"connecting-to-the-database",children:"Connecting to the database"}),"\n",(0,s.jsxs)(a.p,{children:["When working with the database, it is common that you want to connect to it with a database viewer such as ",(0,s.jsx)(a.a,{href:"https://eggerapps.at/postico2/",children:"Postico2"}),", ",(0,s.jsx)(a.a,{href:"https://www.pgadmin.org/download/",children:"PgAdmin"}),", or ",(0,s.jsx)(a.a,{href:"https://dbeaver.io/download/",children:"DBeaver"}),". To connect to the database, you need to specify the host and port along with the database name, user name, and password. In your project, you can find these inside the ",(0,s.jsx)(a.code,{children:"config"})," directory."]}),"\n",(0,s.jsxs)(a.p,{children:["The connection details can be found in the file ",(0,s.jsx)(a.code,{children:"config/development.yaml"}),". The variable ",(0,s.jsx)(a.code,{children:"name"})," refers to the database name (which is your project name only)."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-yaml",children:"database:\n  host: localhost\n  port: 8090\n  name: projectname\n  user: postgres\n"})}),"\n",(0,s.jsxs)(a.p,{children:["The password can be found in the file ",(0,s.jsx)(a.code,{children:"config/passwords.yaml"}),"."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-yaml",children:"development:\n  database: '<MY DATABASE PASSWORD>'\n"})}),"\n",(0,s.jsx)(a.h2,{id:"migrations",children:"Migrations"}),"\n",(0,s.jsxs)(a.p,{children:["With database migrations, Serverpod makes it easy to evolve your database schema. When you make changes to your project that should be reflected in your database, you need to create a migration. A migration is a set of SQL queries that are run to update the database. To create a migration, run ",(0,s.jsx)(a.code,{children:"serverpod create-migration"})," in the home directory of the server."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"$ cd mypod/mypod_server\n$ serverpod create-migration\n"})}),"\n",(0,s.jsxs)(a.p,{children:["Migrations are then applied to the database as part of the server startup by adding the ",(0,s.jsx)(a.code,{children:"--apply-migrations"})," flag."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"$ cd mypod/mypod_server\n$ dart bin/main.dart --apply-migrations\n"})}),"\n",(0,s.jsx)(a.admonition,{type:"tip",children:(0,s.jsxs)(a.p,{children:["To learn more about database migrations, see the ",(0,s.jsx)(a.a,{href:"../concepts/database/migrations",children:"Migrations"})," section."]})}),"\n",(0,s.jsx)(a.h2,{id:"object-database-mapping",children:"Object database mapping"}),"\n",(0,s.jsxs)(a.p,{children:["Add a ",(0,s.jsx)(a.code,{children:"table"})," key to your model file to add a mapping to the database. The value specified after the key sets the database table name. Here is the ",(0,s.jsx)(a.code,{children:"Company"})," class from earlier with a database table mapping to a table called ",(0,s.jsx)(a.code,{children:"company"}),":"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-yaml",children:"class: Company\ntable: company\nfields:\n  name: String\n  foundedDate: DateTime?\n"})}),"\n",(0,s.jsxs)(a.p,{children:["CRUD operations are available through the static ",(0,s.jsx)(a.code,{children:"db"})," method on all classes with database bindings."]}),"\n",(0,s.jsx)(a.admonition,{type:"tip",children:(0,s.jsxs)(a.p,{children:["To learn more about database CRUD operations, see the ",(0,s.jsx)(a.a,{href:"../concepts/database/crud",children:"CRUD"})," section."]})}),"\n",(0,s.jsx)(a.h2,{id:"writing-to-database",children:"Writing to database"}),"\n",(0,s.jsxs)(a.p,{children:["Inserting a new row into the database is as simple as calling the static ",(0,s.jsx)(a.code,{children:"db.insertRow"})," method."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-dart",children:"var myCompany = Company(name: 'Serverpod corp.', foundedDate: DateTime.now());\nmyCompany = await Company.db.insertRow(session, myCompany);\n"})}),"\n",(0,s.jsxs)(a.p,{children:["The method returns the inserted object with its ",(0,s.jsx)(a.code,{children:"id"})," field set from the database."]}),"\n",(0,s.jsx)(a.h2,{id:"reading-from-database",children:"Reading from database"}),"\n",(0,s.jsxs)(a.p,{children:["Retrieving a single row from the database can done by calling the static ",(0,s.jsx)(a.code,{children:"db.findById"})," method and providing the ",(0,s.jsx)(a.code,{children:"id"})," of the row."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-dart",children:"var myCompany = await Company.db.findById(session, companyId);\n"})}),"\n",(0,s.jsxs)(a.p,{children:["You can also use an expression to do a more refined search through the ",(0,s.jsx)(a.code,{children:"db.findFirstRow(...)"}),". method. The ",(0,s.jsx)(a.code,{children:"where"})," parameter is a typed expression builder. The builder's parameter, ",(0,s.jsx)(a.code,{children:"t"}),", contains a description of the table and gives access to the table's columns."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-dart",children:"var myCompany = await Company.db.findFirstRow(\n  session,\n  where: (t) => t.name.equals('My Company'),\n);\n"})}),"\n",(0,s.jsxs)(a.p,{children:["The example above will return a single row from the database where the ",(0,s.jsx)(a.code,{children:"name"})," column is equal to ",(0,s.jsx)(a.code,{children:"My Company"}),"."]}),"\n",(0,s.jsxs)(a.p,{children:["If no matching row is found, ",(0,s.jsx)(a.code,{children:"null"})," is returned."]}),"\n",(0,s.jsx)(a.admonition,{type:"tip",children:(0,s.jsxs)(a.p,{children:["Working with a database is an extensive subject. Learn more in the ",(0,s.jsx)(a.a,{href:"../concepts/database/connection",children:"Database"})," section."]})})]})}function l(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,a,t)=>{t.d(a,{R:()=>i,x:()=>o});var n=t(96540);const s={},r=n.createContext(s);function i(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);