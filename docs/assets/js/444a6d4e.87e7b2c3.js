"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[4801],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(n),h=a,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||o;return n?i.createElement(m,r(r({ref:t},d),{},{components:n})):i.createElement(m,r({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},375:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var i=n(7462),a=n(3366),o=(n(7294),n(3905)),r=["components"],s={},l="Authentication",p={unversionedId:"concepts/authentication",id:"version-0.9.22/concepts/authentication",title:"Authentication",description:"Serverpod comes with built-in user management and authentication. You can either build your custom authentication method or use the serverpod_auth module. The module makes it easy to authenticate with email or social sign-ins.",source:"@site/versioned_docs/version-0.9.22/04-concepts/07-authentication.md",sourceDirName:"04-concepts",slug:"/concepts/authentication",permalink:"/0.9.22/concepts/authentication",editUrl:"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-0.9.22/04-concepts/07-authentication.md",tags:[],version:"0.9.22",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Modules",permalink:"/0.9.22/concepts/modules"},next:{title:"Uploading files",permalink:"/0.9.22/concepts/file-uploads"}},d={},u=[{value:"The basics",id:"the-basics",level:2},{value:"Restricting access to endpoints",id:"restricting-access-to-endpoints",level:3},{value:"Installing the auth module",id:"installing-the-auth-module",level:2},{value:"App setup",id:"app-setup",level:2},{value:"Setting up Sign in with Email",id:"setting-up-sign-in-with-email",level:2},{value:"Setting up Sign in with Google",id:"setting-up-sign-in-with-google",level:2},{value:"Configure Google Cloud console and your server",id:"configure-google-cloud-console-and-your-server",level:3},{value:"Configure your app",id:"configure-your-app",level:3},{value:"Calling Google APIs",id:"calling-google-apis",level:3},{value:"Setting up Sign in with Apple",id:"setting-up-sign-in-with-apple",level:2},{value:"Setting up Sign in with Firebase",id:"setting-up-sign-in-with-firebase",level:2},{value:"Working with users",id:"working-with-users",level:2},{value:"Displaying or editing user images",id:"displaying-or-editing-user-images",level:2},{value:"Supported authentication methods",id:"supported-authentication-methods",level:2}],c={toc:u};function h(e){var t=e.components,s=(0,a.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"authentication"},"Authentication"),(0,o.kt)("p",null,"Serverpod comes with built-in user management and authentication. You can either build your custom authentication method or use the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverpod_auth")," module. The module makes it easy to authenticate with email or social sign-ins."),(0,o.kt)("h2",{id:"the-basics"},"The basics"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Session")," object provides information about the current user. A unique ",(0,o.kt)("inlineCode",{parentName:"p"},"userId")," identifies a user. You should use this id whenever you a referring to a user. Access the id of a signed-in user through the ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," field of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Session")," object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"Future<void> myMethod(Session session) async {\n  var userId = await session.auth.authenticatedUserId;\n  var isSignedIn = userId == null;\n  ...\n}\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It's most common to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," module for handling sign ins, but you can also build your own. If you are building custom authentication methods, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"session.auth.signInUser()")," method to sign in a user and ",(0,o.kt)("inlineCode",{parentName:"p"},"session.auth.signOutUser()")," to sign someone out."))),(0,o.kt)("h3",{id:"restricting-access-to-endpoints"},"Restricting access to endpoints"),(0,o.kt)("p",null,"It is common to want to restrict access to an endpoint to users that have signed in. You can do this by overriding the ",(0,o.kt)("inlineCode",{parentName:"p"},"requireLogin")," property of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Endpoint")," class."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"class MyEndpoint extends Endpoint {\n  @override\n  bool get requireLogin => true;\n\n  ...\n}\n")),(0,o.kt)("p",null,"Serverpod also supports scopes for restricting access. One or more scopes can be associated with a user. For instance, this can be used to give admin access to a specific user. To restrict access for an endpoint, override the ",(0,o.kt)("inlineCode",{parentName:"p"},"requiredScopes")," property."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"class MyEndpoint extends Endpoint {\n  @override\n  bool get requireLogin => true;\n\n  @override\n  Set<Scope> get requiredScopes => {Scope.admin};\n  ...\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"serverpod_auth_server")," package provides convenient methods for handling basic user information and scopes."),(0,o.kt)("p",null,"To update a user's scopes, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"Users")," class's ",(0,o.kt)("inlineCode",{parentName:"p"},"updateUserScopes")," method."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"await Users.updateUserScopes(session, userId, {Scope.admin});\n")),(0,o.kt)("h2",{id:"installing-the-auth-module"},"Installing the auth module"),(0,o.kt)("p",null,"Serverpod's auth module makes it easy to authenticate users through email or 3rd parties. Currently supported is Signing in with email, Google, Apple, and Firebase. Future versions of the authentication module will include more options. Using this module requires some setup with Google and Apple to work."),(0,o.kt)("p",null,"The authentication module also handles basic user information, such as user names and profile pictures."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/serverpod/serverpod/raw/main/misc/images/sign-in.png",alt:"Sign-in with Serverpod"})),(0,o.kt)("p",null,"Please refer to the previous section, ",(0,o.kt)("a",{parentName:"p",href:"./modules"},"Modules"),", for instructions on how to add a module to your project."),(0,o.kt)("h2",{id:"app-setup"},"App setup"),(0,o.kt)("p",null,"First, add dependencies to your app's ",(0,o.kt)("inlineCode",{parentName:"p"},"pubspec.yaml")," file for the methods of signing in that you want to support. Make sure to use the same version numbers as for Serverpod itself."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"dependencies:\n  flutter:\n    sdk: flutter\n  serverpod_flutter: ^1.x.x\n  auth_example_client:\n    path: ../auth_example_client\n  \n  serverpod_auth_shared_flutter: ^1.x.x\n  serverpod_auth_email_flutter: ^1.x.x\n  serverpod_auth_google_flutter: ^1.x.x\n")),(0,o.kt)("p",null,"Next, you need to set up a ",(0,o.kt)("inlineCode",{parentName:"p"},"SessionManager"),", which keeps track of the user's state. It will also handle the authentication keys passed to the client from the server, upload user profile images, etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"void main() async {\n  // Need to call this as we are using Flutter bindings before runApp is called.\n  WidgetsFlutterBinding.ensureInitialized();\n\n  // Sets up a singleton client object that can be used to talk to the server\n  // from anywhere in our app. The client is generated from your server code.\n  // The client is set up to connect to a Serverpod running on a local server on\n  // the default port. You will need to modify this to connect to staging or\n  // production servers.\n  client = Client(\n    'http://localhost:8080/',\n    authenticationKeyManager: FlutterAuthenticationKeyManager(),\n  );\n\n  // The session manager keeps track of the signed-in state of the user. You\n  // can query it to see if the user is currently signed in and get information\n  // about the user.\n  sessionManager = SessionManager(\n    caller: client.modules.auth,\n  );\n  await sessionManager.initialize();\n\n  runApp(MyApp());\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"SessionManager")," has useful methods for viewing and monitoring the user's current state:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"signedInUser")," will return a ",(0,o.kt)("inlineCode",{parentName:"li"},"UserInfo")," if the user is currently signed in (or ",(0,o.kt)("inlineCode",{parentName:"li"},"null")," if the user isn't signed in)."),(0,o.kt)("li",{parentName:"ul"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"addListener")," method to get notified of changes to the user's signed in state."),(0,o.kt)("li",{parentName:"ul"},"Sign out a user by calling the ",(0,o.kt)("inlineCode",{parentName:"li"},"signOut")," method.")),(0,o.kt)("h2",{id:"setting-up-sign-in-with-email"},"Setting up Sign in with Email"),(0,o.kt)("p",null,"To properly configure Sign in with Email, you must connect your Serverpod to an external service that can send the emails. One convenient option is the ",(0,o.kt)("a",{parentName:"p",href:"https://pub.dev/packages/mailer"},"mailer")," package, which can send emails through any SMTP service. Most email providers, such as Sendgrid or Mandrill, support SMTP."),(0,o.kt)("p",null,"In your main ",(0,o.kt)("inlineCode",{parentName:"p"},"server.dart")," file, you can configure the auth module. First, make sure to include the module:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"import 'package:serverpod_auth_server/module.dart' as auth;\n")),(0,o.kt)("p",null,"Then, add the configuration before you start your Serverpod:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"auth.AuthConfig.set(auth.AuthConfig(\n  sendValidationEmail: (session, email, validationCode) async {\n    // Send your validation email here.\n  },\n  sendPasswordResetEmail: (session, userInfo, validationCode) async {\n    // Send a password reset email here.\n  },\n));\n\n// Start the server.\nawait pod.start();\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For debugging purposes, you can print the validation code to the console. The chat module example does just this. You can view that code ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/serverpod/serverpod/blob/main/examples/chat/chat_server/lib/server.dart"},"here"),"."))),(0,o.kt)("p",null,"In your app, you will need to add the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverpod_auth_email_flutter")," package to your ",(0,o.kt)("inlineCode",{parentName:"p"},"pubspec.yaml"),". The package includes both methods for creating a custom email sign-in form and a pre-made ",(0,o.kt)("inlineCode",{parentName:"p"},"SignInWithEmailButton")," widget. If you are building custom forms, it is helpful to read the documentation provided in the module and review the code in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/serverpod/serverpod/blob/main/modules/serverpod_auth/serverpod_auth_email_flutter/lib/src/signin_dialog.dart"},"SignInWithEmailDialog"),"."),(0,o.kt)("h2",{id:"setting-up-sign-in-with-google"},"Setting up Sign in with Google"),(0,o.kt)("p",null,"To set up Sign in with Google, you will need a Google account for your organization and set up a new project. For the project, you need to set up ",(0,o.kt)("em",{parentName:"p"},"Credentials")," and ",(0,o.kt)("em",{parentName:"p"},"Oauth consent screen"),". You will also need to add the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverpod_auth_google_flutter")," package to your app and do some additional setup depending on each platform."),(0,o.kt)("h3",{id:"configure-google-cloud-console-and-your-server"},"Configure Google Cloud console and your server"),(0,o.kt)("p",null,"In the Google Cloud console, you need to set up a few things:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Activate the ",(0,o.kt)("em",{parentName:"li"},"People API")," for your project. You find it in ",(0,o.kt)("em",{parentName:"li"},"APIs & Services")," > ",(0,o.kt)("em",{parentName:"li"},"Enabled APIs & services"),"."),(0,o.kt)("li",{parentName:"ol"},"Set up the OAuth consent screen. It's in ",(0,o.kt)("em",{parentName:"li"},"APIs & Services")," > ",(0,o.kt)("em",{parentName:"li"},"OAuth consent screen"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"You will need a domain for your project, which you add under ",(0,o.kt)("inlineCode",{parentName:"li"},"Authorized domains"),"."),(0,o.kt)("li",{parentName:"ul"},"Add ",(0,o.kt)("inlineCode",{parentName:"li"},".../auth/userinfo.email")," and ",(0,o.kt)("inlineCode",{parentName:"li"},".../auth/userinfo.profile")," to your ",(0,o.kt)("inlineCode",{parentName:"li"},"Scopes"),"."))),(0,o.kt)("li",{parentName:"ol"},"Add OAuth 2.0 credentials for your web application. Do this under ",(0,o.kt)("em",{parentName:"li"},"APIs & Services")," > ",(0,o.kt)("em",{parentName:"li"},"Credentials"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Create a ",(0,o.kt)("em",{parentName:"li"},"Web application OAuth Client ID"),". This is required even if you only want to provide sign-in with iOS or Android, as the server uses it to access Google's APIs."),(0,o.kt)("li",{parentName:"ul"},"For _Authorized JavaScript origins`, enter your domain name."),(0,o.kt)("li",{parentName:"ul"},"For ",(0,o.kt)("em",{parentName:"li"},"Authorized redirect URIs"),", enter your domain name. You may also want to add your development server here, e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8080"),"."),(0,o.kt)("li",{parentName:"ul"},"Download the JSON file for your web application OAuth client. This file contains both the client id and the client secret. Rename the file to ",(0,o.kt)("inlineCode",{parentName:"li"},"google_client_secret.json")," and place it in your server's ",(0,o.kt)("inlineCode",{parentName:"li"},"config")," directory."))),(0,o.kt)("li",{parentName:"ol"},"Add OAuth 2.0 credentials for iOS and Android.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Create an ",(0,o.kt)("em",{parentName:"li"},"OAuth Client ID")," for iOS or Android."),(0,o.kt)("li",{parentName:"ul"},"Download the associated Plist-file.")))),(0,o.kt)("p",null,(0,o.kt)("img",{loading:"lazy",alt:"Google credentials",src:n(2533).Z,width:"2286",height:"1020"}),"\n",(0,o.kt)("em",{parentName:"p"},"Credentials configured for the server and an iOS app.")),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"google_client_secret.json")," contains a private key and should not be version controlled."))),(0,o.kt)("h3",{id:"configure-your-app"},"Configure your app"),(0,o.kt)("p",null,"You need to take platform-dependent steps to configure Sign in with Google in your app."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add the ",(0,o.kt)("inlineCode",{parentName:"li"},"serverpod_auth_google_flutter")," package to your app."),(0,o.kt)("li",{parentName:"ul"},"For iOS, download the plist from the ",(0,o.kt)("em",{parentName:"li"},"Credentials")," page in Google Cloud console. Rename the file to ",(0,o.kt)("inlineCode",{parentName:"li"},"GoogleService-Info.plist")," and add it to your Xcode project. Open the plist file. If there is no entry for ",(0,o.kt)("inlineCode",{parentName:"li"},"SERVER_CLIENT_ID"),", you will need to add that to the file. The ",(0,o.kt)("inlineCode",{parentName:"li"},"SERVER_CLIENT_ID")," is the ",(0,o.kt)("em",{parentName:"li"},"Client ID")," of your web app, and you get it from the ",(0,o.kt)("em",{parentName:"li"},"Credentials")," page."),(0,o.kt)("li",{parentName:"ul"},"For iOS, add a URL type to your ",(0,o.kt)("em",{parentName:"li"},"Info"),". You find it in Xcode under ",(0,o.kt)("em",{parentName:"li"},"Targets")," > ",(0,o.kt)("em",{parentName:"li"},"Runner")," > ",(0,o.kt)("em",{parentName:"li"},"Info"),". Set the ",(0,o.kt)("em",{parentName:"li"},"URL Schemes")," to the ",(0,o.kt)("inlineCode",{parentName:"li"},"REVERSE_CLIENT_ID")," as specified in the plist, and the ",(0,o.kt)("em",{parentName:"li"},"Role")," to ",(0,o.kt)("em",{parentName:"li"},"Editor"),"."),(0,o.kt)("li",{parentName:"ul"},"For Android, there are similar steps you need to take. The ",(0,o.kt)("a",{parentName:"li",href:"https://pub.dev/packages/google_sign_in"},"google_sign_in")," package provides information about the setup."),(0,o.kt)("li",{parentName:"ul"},"In your code, you sign in with Google by calling the ",(0,o.kt)("inlineCode",{parentName:"li"},"signInWithGoogle")," method or by adding the ",(0,o.kt)("inlineCode",{parentName:"li"},"SignInWithGoogleButton")," widget. For the process to work, you must pass in the ",(0,o.kt)("inlineCode",{parentName:"li"},"redirectUri")," parameter. This Uri should be the same as you configured in the OAuth consent screen. For debugging purposes, use ",(0,o.kt)("inlineCode",{parentName:"li"},"Uri.parse('http://localhost:8080')"),";")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Rather than using the ",(0,o.kt)("inlineCode",{parentName:"p"},"GoogleService-Info.plist")," file for iOS, you can pass the ",(0,o.kt)("inlineCode",{parentName:"p"},"clientId")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverClientId")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"signInWithGoogle")," method or the ",(0,o.kt)("inlineCode",{parentName:"p"},"SignInWithGoogleButton")," widget. The ",(0,o.kt)("inlineCode",{parentName:"p"},"serverClientId")," is the client ID of the web application."))),(0,o.kt)("h3",{id:"calling-google-apis"},"Calling Google APIs"),(0,o.kt)("p",null,"The default setup allows access to basic user information, such as email, profile image, and name. You may require additional access scopes, such as accessing a user's calendar, contacts, or files. To do this, you will need to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add the required scopes to the OAuth consent screen."),(0,o.kt)("li",{parentName:"ul"},"Request access to the scopes when signing in. Do this by setting the ",(0,o.kt)("inlineCode",{parentName:"li"},"scopes")," parameter of the ",(0,o.kt)("inlineCode",{parentName:"li"},"signInWithGoogle")," method or the ",(0,o.kt)("inlineCode",{parentName:"li"},"SignInWithGoogleButton")," widget.")),(0,o.kt)("p",null,"On the server side, you can now access these Google APIs. If a user has signed in with Google, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"authClientForUser")," method from the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverpod_auth_server")," package to request an ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoRefreshingAuthClient"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoRefreshingAuthClient")," can be used to access Google's APIs on the user's behalf."),(0,o.kt)("p",null,"For instance, to access the Youtube APIs, add the scope to your ",(0,o.kt)("inlineCode",{parentName:"p"},"SignInWithGoogleButton")," in your app:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"SignInWithGoogleButton(\n  scopes: [YouTubeApi.youtubeReadonlyScope],\n  // other required parameters\n)\n")),(0,o.kt)("p",null,"On the server, access the Youtube API by first creating a client, then calling the API."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"var googleClient = await authClientForUser(session, userId);\n\nif (googleClient != null) {\n  var youtubeApi = YouTubeApi(googleClient);\n\n  var favorites = await youTubeApi.playlistItems.list(\n    ['snippet'],\n    playlistId: 'LL', // Liked List\n  );\n\n}\nelse {\n  // The user hasn't signed in with Google.\n}\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Adding additional scopes may require approval by Google. On the OAuth consent screen, you can see which of your scopes are considered sensitive."))),(0,o.kt)("h2",{id:"setting-up-sign-in-with-apple"},"Setting up Sign in with Apple"),(0,o.kt)("p",null,"You will need an Apple developer account to configure Sign in with Apple. Follow the instructions in ",(0,o.kt)("a",{parentName:"p",href:"https://pub.dev/packages/sign_in_with_apple"},"sign_in_with_apple"),"."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Note that Sign in with Apple may not work on some versions of the Simulator (iOS 13.5 works). This issue doesn't affect real devices.")),(0,o.kt)("h2",{id:"setting-up-sign-in-with-firebase"},"Setting up Sign in with Firebase"),(0,o.kt)("p",null,"Serverpod uses FlutterFire UI to handle authentication through Firebase. It allows you to add social sign-in types that Serverpod doesn't directly support."),(0,o.kt)("p",null,"To add authentication with Firebase, you must first install and initialize the Firebase CLI tools and Flutter fire. Follow the instructions ",(0,o.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/flutter/setup?platform=web"},"here")," for your Flutter project. In the Firebase console, configure the different social sign-ins you plan to use. Then pass your provider configurations to either the signInWithFirebase method or the SignInWithFirebaseButton of the ",(0,o.kt)("a",{parentName:"p",href:"https://pub.dev/packages/serverpod_auth_firebase_flutter"},"serverpod_auth_firebase_flutter")," package."),(0,o.kt)("p",null,"Server-side, you need to create a set of authentication keys in the ",(0,o.kt)("a",{parentName:"p",href:"https://console.firebase.google.com/"},"Firebase console"),", download the JSON file, rename it to firebase_service_account_key.json and place it in the config folder."),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Serverpod automatically merges accounts that are using the same email addresses, so make sure only to allow sign-ins where the email has been verified."))),(0,o.kt)("h2",{id:"working-with-users"},"Working with users"),(0,o.kt)("p",null,"It's a common task to read or update user information on your server. You can always retrieve the id of a signed-in user through the session object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"var userId = await session.auth.authorizedUserId;\n")),(0,o.kt)("p",null,"If you sign in users through the auth module, you will be able to retrieve more information through the static methods of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Users")," class."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"var userInfo = await Users.findUserByUserId(session, userId!);\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"UserInfo")," is automatically populated when the user signs in. Different data may be available depending on which method was used for authentication."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Users")," class contains many other convenient methods for working with users. You can find the full documentation ",(0,o.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/serverpod_auth_server/latest/protocol/Users-class.html"},"here"),"."))),(0,o.kt)("h2",{id:"displaying-or-editing-user-images"},"Displaying or editing user images"),(0,o.kt)("p",null,"The module has built-in methods for handling a user's basic settings, including uploading new profile pictures."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/serverpod/serverpod/raw/main/misc/images/user-image-button.png",alt:"UserImageButton"})),(0,o.kt)("p",null,"To display a user's profile picture, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"CircularUserImage")," widget and pass a ",(0,o.kt)("inlineCode",{parentName:"p"},"UserInfo")," retrieved from the ",(0,o.kt)("inlineCode",{parentName:"p"},"SessionManager"),"."),(0,o.kt)("p",null,"To edit a user profile image, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"UserImageButton")," widget. It will automatically fetch the signed-in user's profile picture and communicate with the server."),(0,o.kt)("h2",{id:"supported-authentication-methods"},"Supported authentication methods"),(0,o.kt)("p",null,"Currently, sign-in with Google, Apple, Firebase, and email is natively supported. If you write another authentication module, please consider ",(0,o.kt)("a",{parentName:"p",href:"/contribute"},"contributing")," your code."))}h.isMDXComponent=!0},2533:function(e,t,n){t.Z=n.p+"assets/images/6-google-credentials-aba2aae45d64b6d5438133a0c68765f6.jpg"}}]);