"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[51879],{12174(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"concepts/authentication/providers/microsoft/configuration","title":"Configuration","description":"This page covers configuration options for the Microsoft identity provider beyond the basic setup.","source":"@site/docs/06-concepts/11-authentication/04-providers/08-microsoft/02-configuration.md","sourceDirName":"06-concepts/11-authentication/04-providers/08-microsoft","slug":"/concepts/authentication/providers/microsoft/configuration","permalink":"/next/concepts/authentication/providers/microsoft/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/docs/06-concepts/11-authentication/04-providers/08-microsoft/02-configuration.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Setup","permalink":"/next/concepts/authentication/providers/microsoft/setup"},"next":{"title":"Customizing the UI","permalink":"/next/concepts/authentication/providers/microsoft/customizing-the-ui"}}');var s=i(74848),t=i(28453);const r={},c="Configuration",a={},l=[{value:"Configuration options",id:"configuration-options",level:2},{value:"Tenant configuration",id:"tenant-configuration",level:3},{value:"Custom account validation",id:"custom-account-validation",level:3},{value:"MicrosoftAccountDetails",id:"microsoftaccountdetails",level:3},{value:"Accessing Microsoft APIs",id:"accessing-microsoft-apis",level:3},{value:"Accessing Microsoft APIs on the server",id:"accessing-microsoft-apis-on-the-server",level:3},{value:"Configuring client IDs on the app",id:"configuring-client-ids-on-the-app",level:2},{value:"Passing client IDs in code",id:"passing-client-ids-in-code",level:3},{value:"Using environment variables",id:"using-environment-variables",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,s.jsx)(n.p,{children:"This page covers configuration options for the Microsoft identity provider beyond the basic setup."}),"\n",(0,s.jsx)(n.h2,{id:"configuration-options",children:"Configuration options"}),"\n",(0,s.jsxs)(n.p,{children:["Below is a non-exhaustive list of some of the most common configuration options. For more details on all options, check the ",(0,s.jsx)(n.code,{children:"MicrosoftIdpConfig"})," in-code documentation."]}),"\n",(0,s.jsx)(n.h3,{id:"tenant-configuration",children:"Tenant configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"tenant"})," parameter determines which accounts can sign in to your application:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"'common'"})," (default) - Allows both personal Microsoft accounts and work/school accounts."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"'organizations'"})," - Allows only work/school accounts (any organization)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"'consumers'"})," - Allows only personal Microsoft accounts."]}),"\n",(0,s.jsx)(n.li,{children:"A specific tenant ID - Restricts to accounts from a specific Microsoft Entra ID tenant."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final microsoftIdpConfig = MicrosoftIdpConfig(\n  clientId: pod.getPassword('microsoftClientId')!,\n  clientSecret: pod.getPassword('microsoftClientSecret')!,\n  tenant: 'organizations', // Only allow work/school accounts\n);\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"'common'"})," for the widest user base. Use a specific tenant ID when building internal applications for a single organization."]})}),"\n",(0,s.jsx)(n.h3,{id:"custom-account-validation",children:"Custom account validation"}),"\n",(0,s.jsx)(n.p,{children:"You can customize the validation for Microsoft account details before allowing sign-in. By default, the validation checks that the received account details contain a non-empty userIdentifier."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final microsoftIdpConfig = MicrosoftIdpConfigFromPasswords(\n  // Optional: Custom validation for Microsoft account details\n  microsoftAccountDetailsValidation: (MicrosoftAccountDetails accountDetails) {\n    // Throw an exception if account doesn't meet custom requirements\n    if (accountDetails.userIdentifier.isEmpty) {\n      throw MicrosoftUserInfoMissingDataException();\n    }\n    // Example: Require email to be present\n    if (accountDetails.email == null || accountDetails.email!.isEmpty) {\n      throw MicrosoftUserInfoMissingDataException();\n    }\n  },\n);\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Users may choose not to share their email or other information during the Microsoft login flow. Adjust your validation function carefully to avoid blocking legitimate users."})}),"\n",(0,s.jsx)(n.h3,{id:"microsoftaccountdetails",children:"MicrosoftAccountDetails"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"microsoftAccountDetailsValidation"})," callback receives a ",(0,s.jsx)(n.code,{children:"MicrosoftAccountDetails"})," record with the following properties:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"userIdentifier"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"String"})}),(0,s.jsx)(n.td,{children:"The Microsoft user's unique identifier (Object ID)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"email"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"String?"})}),(0,s.jsx)(n.td,{children:"The user's email address (may be null)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"name"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"String?"})}),(0,s.jsx)(n.td,{children:"The user's display name from Microsoft"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"image"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Uri?"})}),(0,s.jsx)(n.td,{children:"URL to the user's profile image"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Example of accessing these properties:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"microsoftAccountDetailsValidation: (accountDetails) {\n  print('Microsoft Object ID: ${accountDetails.userIdentifier}');\n  print('Email: ${accountDetails.email}');\n  print('Display name: ${accountDetails.name}');\n  print('Profile image: ${accountDetails.image}');\n\n  // Custom validation logic\n  if (accountDetails.email == null) {\n    throw MicrosoftUserInfoMissingDataException();\n  }\n},\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The properties available depend on the scopes requested and what the user consented to share."})}),"\n",(0,s.jsx)(n.h3,{id:"accessing-microsoft-apis",children:"Accessing Microsoft APIs"}),"\n",(0,s.jsxs)(n.p,{children:["The default setup allows access to basic user information, such as ",(0,s.jsx)(n.code,{children:"name"}),", ",(0,s.jsx)(n.code,{children:"email"}),". You may require additional access scopes to access other Microsoft APIs, such as accessing a user's calendar, mail, or OneDrive files."]}),"\n",(0,s.jsx)(n.p,{children:"The default scopes requested are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openid"}),": Required for OpenID Connect authentication."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"profile"}),": Access to user's basic profile information."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"email"}),": Access to user's email address."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"offline_access"}),": Allows refresh tokens for long-lived sessions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"https://graph.microsoft.com/User.Read"}),": Access to user's Microsoft Graph profile."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To request additional scopes, you will need to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure the required API permissions are configured in your Microsoft Entra ID app registration (navigate to ",(0,s.jsx)(n.strong,{children:"API permissions"})," in the ",(0,s.jsx)(n.a,{href:"https://portal.azure.com/",children:"Azure Portal"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Request access to the scopes when signing in. Do this by setting the ",(0,s.jsx)(n.code,{children:"scopes"})," parameter of the ",(0,s.jsx)(n.code,{children:"MicrosoftSignInWidget"})," or ",(0,s.jsx)(n.code,{children:"MicrosoftAuthController"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["A full list of available scopes and Microsoft Graph API permissions can be found in the ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/graph/permissions-reference",children:"Microsoft Graph permissions reference"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Adding additional scopes may require admin consent depending on your tenant configuration and the sensitivity of the requested permissions."})}),"\n",(0,s.jsx)(n.h3,{id:"accessing-microsoft-apis-on-the-server",children:"Accessing Microsoft APIs on the server"}),"\n",(0,s.jsxs)(n.p,{children:["On the server side, you can access Microsoft APIs using the access token. The ",(0,s.jsx)(n.code,{children:"getExtraMicrosoftInfoCallback"})," in ",(0,s.jsx)(n.code,{children:"MicrosoftIdpConfig"})," receives the access token and can be used to call Microsoft Graph APIs:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:http/http.dart' as http;\n\nfinal microsoftIdpConfig = MicrosoftIdpConfigFromPasswords(\n  // Optional: Extract additional info from Microsoft Graph APIs\n  getExtraMicrosoftInfoCallback: (session, {\n    required accountDetails,\n    required accessToken,\n    required transaction,\n  }) async {\n    // Use accessToken to call Microsoft Graph APIs and store additional info\n    // Example: Access user's calendar\n    final response = await http.get(\n      Uri.https('graph.microsoft.com', '/v1.0/me/calendar'),\n      headers: {'Authorization': 'Bearer $accessToken'},\n    );\n    // Process response and store additional info in the database\n  },\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuring-client-ids-on-the-app",children:"Configuring client IDs on the app"}),"\n",(0,s.jsx)(n.h3,{id:"passing-client-ids-in-code",children:"Passing client IDs in code"}),"\n",(0,s.jsxs)(n.p,{children:["You can pass the ",(0,s.jsx)(n.code,{children:"clientId"}),", ",(0,s.jsx)(n.code,{children:"redirectUri"}),", and ",(0,s.jsx)(n.code,{children:"tenant"})," directly when initializing the Microsoft Sign-In service:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"await client.auth.initializeMicrosoftSignIn(\n  clientId: 'YOUR_MICROSOFT_CLIENT_ID',\n  redirectUri: 'yourapp://auth',\n  tenant: 'common', // Optional, defaults to 'common'\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"This approach is useful when you need different client IDs per platform and want to manage them in your Dart code."}),"\n",(0,s.jsx)(n.h3,{id:"using-environment-variables",children:"Using environment variables"}),"\n",(0,s.jsxs)(n.p,{children:["Alternatively, you can pass client configuration during build time using the ",(0,s.jsx)(n.code,{children:"--dart-define"})," option. The Microsoft Sign-In provider supports the following environment variables:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"MICROSOFT_CLIENT_ID"}),": Your Microsoft Application (client) ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"MICROSOFT_REDIRECT_URI"}),": The callback URI"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'flutter run -d <device> \\\n  --dart-define="MICROSOFT_CLIENT_ID=your_client_id" \\\n  --dart-define="MICROSOFT_REDIRECT_URI=msauth://auth" \\\n  --dart-define="MICROSOFT_TENANT=common"\n'})}),"\n",(0,s.jsx)(n.p,{children:"This approach is useful when you need to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Manage separate client IDs for different platforms (Android, iOS, Web, macOS) in a centralized way"}),"\n",(0,s.jsx)(n.li,{children:"Avoid committing client IDs to version control"}),"\n",(0,s.jsx)(n.li,{children:"Configure different credentials for different build environments (development, staging, production)"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"You can also set these environment variables in your IDE's run configuration or CI/CD pipeline to avoid passing them manually each time."})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,i){i.d(n,{R:()=>r,x:()=>c});var o=i(96540);const s={},t=o.createContext(s);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);