"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[81542],{88920:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"concepts/authentication/providers/email/setup","title":"Setup","description":"To properly configure Sign in with Email, you must connect your Serverpod to an external service that can send the emails. One convenient option is the mailer package, which can send emails through any SMTP service. Most email providers, such as Resend, Sendgrid or Mandrill, support SMTP.","source":"@site/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/01-email/01-setup.md","sourceDirName":"06-concepts/11-authentication/04-providers/01-email","slug":"/concepts/authentication/providers/email/setup","permalink":"/3.0.0/concepts/authentication/providers/email/setup","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/01-email/01-setup.md","tags":[],"version":"3.0.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Working with users","permalink":"/3.0.0/concepts/authentication/working-with-users"},"next":{"title":"Configuration","permalink":"/3.0.0/concepts/authentication/providers/email/configuration"}}');var r=n(74848),o=n(28453);const s={},a="Setup",d={},c=[{value:"Server-side configuration",id:"server-side-configuration",level:2},{value:"Basic configuration options",id:"basic-configuration-options",level:3},{value:"Client-side configuration",id:"client-side-configuration",level:2}];function l(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"setup",children:"Setup"})}),"\n",(0,r.jsxs)(i.p,{children:["To properly configure Sign in with Email, you must connect your Serverpod to an external service that can send the emails. One convenient option is the ",(0,r.jsx)(i.a,{href:"https://pub.dev/packages/mailer",children:"mailer"})," package, which can send emails through any SMTP service. Most email providers, such as Resend, Sendgrid or Mandrill, support SMTP."]}),"\n",(0,r.jsx)(i.admonition,{type:"caution",children:(0,r.jsxs)(i.p,{children:["You need to install the auth module before you continue, see ",(0,r.jsx)(i.a,{href:"../../setup",children:"Setup"}),"."]})}),"\n",(0,r.jsx)(i.h2,{id:"server-side-configuration",children:"Server-side configuration"}),"\n",(0,r.jsxs)(i.p,{children:["In your main ",(0,r.jsx)(i.code,{children:"server.dart"})," file, configure the email identity provider using the ",(0,r.jsx)(i.code,{children:"EmailIdpConfig"})," object and add it to your ",(0,r.jsx)(i.code,{children:"pod.initializeAuthServices()"})," configuration:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\nimport 'package:serverpod_auth_idp_server/providers/email.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  pod.initializeAuthServices(\n    tokenManagerBuilders: [\n      JwtConfigFromPasswords(),\n    ],\n    identityProviderBuilders: [\n      // Configure the Email Identity Provider\n      // This is the basic configuration for the Email IDP to work.\n      EmailIdpConfig(\n        // Secret pepper to hash the password and verification code.\n        secretHashPepper: pod.getPassword('emailSecretHashPepper')!,\n        // Callback to send the registration verification code to the user.\n        sendRegistrationVerificationCode: _sendRegistrationCode,\n        // Callback to send the password reset verification code to the user.\n        sendPasswordResetVerificationCode: _sendPasswordResetCode,\n      ),\n    ],\n  );\n\n  await pod.start();\n}\n\nvoid _sendRegistrationCode(\n  Session session, {\n  required String email,\n  required UuidValue accountRequestId,\n  required String verificationCode,\n  required Transaction? transaction,\n}) {\n  // NOTE: Here you call your mail service to send the verification code to\n  // the user. For testing, we will just log the verification code.\n  session.log('[EmailIDP] Registration code ($email): $verificationCode');\n}\n\nvoid _sendPasswordResetCode(\n  Session session, {\n  required String email,\n  required UuidValue passwordResetRequestId,\n  required String verificationCode,\n  required Transaction? transaction,\n}) {\n  // NOTE: Here you call your mail service to send the verification code to\n  // the user. For testing, we will just log the verification code.\n  session.log('[EmailIDP] Password reset code ($email): $verificationCode');\n}\n"})}),"\n",(0,r.jsx)(i.p,{children:"Then, extend the abstract endpoint to expose it on the server:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_server/providers/email.dart';\n\nclass EmailIdpEndpoint extends EmailIdpBaseEndpoint {}\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Then, run ",(0,r.jsx)(i.code,{children:"serverpod generate"})," to generate the client code and create a migration to initialize the database for the provider. More detailed instructions can be found in the general ",(0,r.jsx)(i.a,{href:"../../setup#identity-providers-configuration",children:"identity providers setup section"}),"."]}),"\n",(0,r.jsx)(i.h3,{id:"basic-configuration-options",children:"Basic configuration options"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"secretHashPepper"}),": Required. A secret pepper used for hashing passwords and verification codes. Must be at least 10 characters long, but the ",(0,r.jsx)(i.a,{href:"https://www.ietf.org/archive/id/draft-ietf-kitten-password-storage-04.html#name-storage-2",children:"recommended pepper length"})," is 32 bytes."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"sendRegistrationVerificationCode"}),": A callback that will be called to send the registration verification code to the user. Here you should call the email sending service to send the verification code to the user."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"sendPasswordResetVerificationCode"}),": A callback that will be called to send the password reset verification code to the user. Here you should call the email sending service to send the verification code to the user."]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["For more details on configuration options, such as customizing password requirements, verification code generation, rate limiting, and more, see the ",(0,r.jsx)(i.a,{href:"./configuration",children:"configuration section"}),"."]}),"\n",(0,r.jsx)(i.admonition,{type:"tip",children:(0,r.jsxs)(i.p,{children:["If you are using the ",(0,r.jsx)(i.code,{children:"config/passwords.yaml"})," file or environment variables, you can use the ",(0,r.jsx)(i.code,{children:"EmailIdpConfigFromPasswords"})," constructor to automatically load the secret pepper. It will expect the ",(0,r.jsx)(i.code,{children:"emailSecretHashPepper"})," key or the ",(0,r.jsx)(i.code,{children:"SERVERPOD_PASSWORD_emailSecretHashPepper"})," environment variable to be set with the secret pepper value."]})}),"\n",(0,r.jsx)(i.h2,{id:"client-side-configuration",children:"Client-side configuration"}),"\n",(0,r.jsxs)(i.p,{children:["If you have configured the ",(0,r.jsx)(i.code,{children:"SignInWidget"})," as described in the ",(0,r.jsx)(i.a,{href:"../../setup#present-the-authentication-ui",children:"setup section"}),", the Email identity provider will be automatically detected and displayed in the sign-in widget."]}),"\n",(0,r.jsxs)(i.p,{children:["You can also use the ",(0,r.jsx)(i.code,{children:"EmailSignInWidget"})," to include the email authentication flow in your own custom UI."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\n\nEmailSignInWidget(\n  client: client,\n  onAuthenticated: () {\n    // Do something when the user is authenticated.\n    //\n    // NOTE: You should not navigate to the home screen here, otherwise\n    // the user will have to sign in again every time they open the app.\n  },\n  onError: (error) {\n    // Handle errors\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(content: Text('Error: $error')),\n    );\n  },\n)\n"})}),"\n",(0,r.jsx)(i.p,{children:"The widget automatically handles:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Login with email and password."}),"\n",(0,r.jsx)(i.li,{children:"Registration with terms acceptance and email verification."}),"\n",(0,r.jsx)(i.li,{children:"Password reset flow with email verification."}),"\n",(0,r.jsx)(i.li,{children:"Navigation between screens."}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["For details on how to display the email authentication UI in your Flutter app, see the ",(0,r.jsx)(i.a,{href:"./customizing-the-ui",children:"customizing the UI section"}),"."]})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>a});var t=n(96540);const r={},o=t.createContext(r);function s(e){const i=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:i},e.children)}}}]);