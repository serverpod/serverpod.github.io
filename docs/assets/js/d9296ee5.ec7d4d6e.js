"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[83632],{17976(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"concepts/authentication/providers/apple/setup","title":"Setup","description":"Sign-in with Apple requires that you have a subscription to the Apple Developer Program, even if you only want to test the feature in development mode.","source":"@site/versioned_docs/version-3.2.0/06-concepts/11-authentication/04-providers/03-apple/01-setup.md","sourceDirName":"06-concepts/11-authentication/04-providers/03-apple","slug":"/concepts/authentication/providers/apple/setup","permalink":"/concepts/authentication/providers/apple/setup","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.2.0/06-concepts/11-authentication/04-providers/03-apple/01-setup.md","tags":[],"version":"3.2.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Customizing the UI","permalink":"/concepts/authentication/providers/google/customizing-the-ui"},"next":{"title":"Configuration","permalink":"/concepts/authentication/providers/apple/configuration"}}');var r=i(74848),o=i(28453);const s={},d="Setup",l={},a=[{value:"Create your credentials",id:"create-your-credentials",level:2},{value:"Server-side configuration",id:"server-side-configuration",level:2},{value:"Basic configuration options",id:"basic-configuration-options",level:3},{value:"Client-side configuration",id:"client-side-configuration",level:2},{value:"iOS and macOS",id:"ios-and-macos",level:3},{value:"Android",id:"android",level:3},{value:"Web",id:"web",level:3},{value:"Present the authentication UI",id:"present-the-authentication-ui",level:2},{value:"Initializing the <code>AppleSignInService</code>",id:"initializing-the-applesigninservice",level:3},{value:"Using AppleSignInWidget",id:"using-applesigninwidget",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"setup",children:"Setup"})}),"\n",(0,r.jsxs)(n.p,{children:["Sign-in with Apple requires that you have a subscription to the ",(0,r.jsx)(n.a,{href:"https://developer.apple.com/programs/",children:"Apple Developer Program"}),", even if you only want to test the feature in development mode."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Right now, we have official support for iOS, macOS, Android, and Web for Sign in with Apple."})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["You need to install the auth module before you continue, see ",(0,r.jsx)(n.a,{href:"../../setup",children:"Setup"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"create-your-credentials",children:"Create your credentials"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create a Service ID"})," in the ",(0,r.jsx)(n.a,{href:"https://developer.apple.com/account/resources/identifiers/list/serviceId",children:"Apple Developer Portal"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Register a new Service ID"}),"\n",(0,r.jsx)(n.li,{children:'Enable "Sign in with Apple"'}),"\n",(0,r.jsx)(n.li,{children:"Configure domains and redirect URLs"}),"\n",(0,r.jsxs)(n.li,{children:["Note the Service Identifier (e.g., ",(0,r.jsx)(n.code,{children:"com.example.service"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create a Key"})," for Sign in with Apple:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Go to Keys section in Apple Developer Portal"}),"\n",(0,r.jsx)(n.li,{children:'Create a new key with "Sign in with Apple" enabled'}),"\n",(0,r.jsxs)(n.li,{children:["Download the key file (",(0,r.jsx)(n.code,{children:".p8"})," file) - ",(0,r.jsx)(n.strong,{children:"you can only download this once"})]}),"\n",(0,r.jsx)(n.li,{children:"Note the Key ID"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Store the credentials securely"})," in your ",(0,r.jsx)(n.code,{children:"config/passwords.yaml"}),":"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"development:\n  appleServiceIdentifier: 'com.example.service'\n  appleBundleIdentifier: 'com.example.app'\n  appleRedirectUri: 'https://example.com/auth/callback'\n  appleTeamId: 'ABC123DEF4'\n  appleKeyId: 'XYZ789ABC0'\n  appleKey: |\n    -----BEGIN PRIVATE KEY-----\n    MIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQg...\n    -----END PRIVATE KEY-----\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"The Apple private key can only be downloaded once. Store it securely and never commit it to version control. Use environment variables or secure secret management in production."})}),"\n",(0,r.jsx)(n.h2,{id:"server-side-configuration",children:"Server-side configuration"}),"\n",(0,r.jsxs)(n.p,{children:["After creating your credentials, you need to configure the Apple identity provider on your main ",(0,r.jsx)(n.code,{children:"server.dart"})," file by setting the ",(0,r.jsx)(n.code,{children:"AppleIdpConfig"})," as a ",(0,r.jsx)(n.code,{children:"identityProviderBuilders"})," in your ",(0,r.jsx)(n.code,{children:"pod.initializeAuthServices()"})," configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\nimport 'package:serverpod_auth_idp_server/providers/apple.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  // Configure Apple identity provider\n  pod.initializeAuthServices(\n    tokenManagerBuilders: [\n      JwtConfigFromPasswords(),\n    ],\n    identityProviderBuilders: [\n      AppleIdpConfig(\n        serviceIdentifier: pod.getPassword('appleServiceIdentifier')!,\n        bundleIdentifier: pod.getPassword('appleBundleIdentifier')!,\n        redirectUri: pod.getPassword('appleRedirectUri')!,\n        teamId: pod.getPassword('appleTeamId')!,\n        keyId: pod.getPassword('appleKeyId')!,\n        key: pod.getPassword('appleKey')!,\n      ),\n    ],\n  );\n\n  // Configure web routes for Apple Sign-In\n  // Paths must match paths configured on Apple's developer portal.\n  // The method's parameters are optional and defaults to the values below.\n  pod.configureAppleIdpRoutes(\n    revokedNotificationRoutePath: '/hooks/apple-notification',\n    webAuthenticationCallbackRoutePath: '/auth/callback',\n  );\n\n  await pod.start();\n}\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["You can use the ",(0,r.jsx)(n.code,{children:"AppleIdpConfigFromPasswords"})," constructor in replacement of the ",(0,r.jsx)(n.code,{children:"AppleIdpConfig"})," above to automatically load the credentials from the ",(0,r.jsx)(n.code,{children:"config/passwords.yaml"})," file or environment variables. It will expect either the following keys on the file:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleServiceIdentifier"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleBundleIdentifier"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleRedirectUri"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleTeamId"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleKeyId"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"appleKey"})}),"\n"]}),(0,r.jsx)(n.p,{children:"Or the following environment variables:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleServiceIdentifier"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleBundleIdentifier"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleRedirectUri"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleTeamId"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleKeyId"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_appleKey"})}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"Then, extend the abstract endpoint to expose it on the server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_server/providers/apple.dart';\n\nclass AppleIdpEndpoint extends AppleIdpBaseEndpoint {}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Finally, run ",(0,r.jsx)(n.code,{children:"serverpod generate"})," to generate the client code and create a migration to initialize the database for the provider. More detailed instructions can be found in the general ",(0,r.jsx)(n.a,{href:"../../setup#identity-providers-configuration",children:"identity providers setup section"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"basic-configuration-options",children:"Basic configuration options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"serviceIdentifier"}),": Required. The service identifier for the Sign in with Apple project."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bundleIdentifier"}),": Required. The bundle ID of the Apple-native app using Sign in with Apple."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"redirectUri"}),": Required. The redirect URL used for 3rd party platforms (e.g., Android, Web)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"teamId"}),": Required. The team identifier of the parent Apple Developer account."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"keyId"}),": Required. The ID of the key associated with the Sign in with Apple service."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"key"}),": Required. The secret contents of the private key file received from Apple."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For more details on configuration options, see the ",(0,r.jsx)(n.a,{href:"./configuration",children:"configuration section"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"client-side-configuration",children:"Client-side configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"serverpod_auth_idp_flutter"})," package implements the sign-in logic using ",(0,r.jsx)(n.a,{href:"https://pub.dev/packages/sign_in_with_apple",children:"sign_in_with_apple"}),". The documentation for this package should in most cases also apply to the Serverpod integration."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Note that Sign in with Apple may not work on some versions of the Simulator (iOS 13.5 works). This issue doesn't affect real devices."})}),"\n",(0,r.jsx)(n.h3,{id:"ios-and-macos",children:"iOS and macOS"}),"\n",(0,r.jsx)(n.p,{children:"Enable the Sign in with Apple capability in your Xcode project:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Open your project in Xcode"}),"\n",(0,r.jsx)(n.li,{children:"Select your target"}),"\n",(0,r.jsx)(n.li,{children:'Go to "Signing & Capabilities"'}),"\n",(0,r.jsx)(n.li,{children:'Click "+ Capability"'}),"\n",(0,r.jsx)(n.li,{children:'Add "Sign in with Apple"'}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Add capabilities",src:i(37322).A+"",width:"1600",height:"624"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Sign in with Apple",src:i(55219).A+"",width:"1342",height:"972"})}),"\n",(0,r.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,r.jsx)(n.p,{children:"For Android, you need to configure the redirect URI in your app. The redirect URI should match what you configured in Apple Developer Portal and your server."}),"\n",(0,r.jsx)(n.h3,{id:"web",children:"Web"}),"\n",(0,r.jsxs)(n.p,{children:["For web, configure the redirect URI in your Apple Developer Portal to match your server's callback route (e.g., ",(0,r.jsx)(n.code,{children:"https://example.com/auth/callback"}),")."]}),"\n",(0,r.jsx)(n.h2,{id:"present-the-authentication-ui",children:"Present the authentication UI"}),"\n",(0,r.jsxs)(n.h3,{id:"initializing-the-applesigninservice",children:["Initializing the ",(0,r.jsx)(n.code,{children:"AppleSignInService"})]}),"\n",(0,r.jsxs)(n.p,{children:["To use the AppleSignInService, you need to initialize it in your main function. The initialization is done from the ",(0,r.jsx)(n.code,{children:"initializeAppleSignIn()"})," extension method on the ",(0,r.jsx)(n.code,{children:"FlutterAuthSessionManager"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\nimport 'package:your_client/your_client.dart';\n\nfinal client = Client('http://localhost:8080/')\n  ..authSessionManager = FlutterAuthSessionManager();\n\nvoid main() {\n  client.auth.initialize();\n  client.auth.initializeAppleSignIn();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-applesigninwidget",children:"Using AppleSignInWidget"}),"\n",(0,r.jsxs)(n.p,{children:["If you have configured the ",(0,r.jsx)(n.code,{children:"SignInWidget"})," as described in the ",(0,r.jsx)(n.a,{href:"../../setup#present-the-authentication-ui",children:"setup section"}),", the Apple identity provider will be automatically detected and displayed in the sign-in widget."]}),"\n",(0,r.jsxs)(n.p,{children:["You can also use the ",(0,r.jsx)(n.code,{children:"AppleSignInWidget"})," to include the Apple authentication flow in your own custom UI."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\n\nAppleSignInWidget(\n  client: client,\n  onAuthenticated: () {\n    // Do something when the user is authenticated.\n    //\n    // NOTE: You should not navigate to the home screen here, otherwise\n    // the user will have to sign in again every time they open the app.\n  },\n  onError: (error) {\n    // Handle errors\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(content: Text('Error: $error')),\n    );\n  },\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:"The widget automatically handles:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Apple Sign-In flow for iOS, macOS, Android, and Web."}),"\n",(0,r.jsx)(n.li,{children:"Token management."}),"\n",(0,r.jsx)(n.li,{children:"Underlying Apple Sign-In package error handling."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For details on how to customize the Apple Sign-In UI in your Flutter app, see the ",(0,r.jsx)(n.a,{href:"./customizing-the-ui",children:"customizing the UI section"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},37322(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/1-xcode-add-4970bf68f8b6a6f6f938b7d48978d0c6.png"},55219(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/2-xcode-sign-in-with-apple-81b2b6a5bcfa774fd02732f2ee43b565.png"},28453(e,n,i){i.d(n,{R:()=>s,x:()=>d});var t=i(96540);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);