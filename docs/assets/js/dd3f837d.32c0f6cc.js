"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[23914],{7868:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"concepts/database/connection","title":"Connection","description":"In Serverpod the connection details and password for the database are stored inside the config directory in your server package. Serverpod automatically establishes a connection to the Postgres instance by using these configuration details when you start the server.","source":"@site/versioned_docs/version-2.6.0/06-concepts/06-database/01-connection.md","sourceDirName":"06-concepts/06-database","slug":"/concepts/database/connection","permalink":"/2.6.0/concepts/database/connection","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-2.6.0/06-concepts/06-database/01-connection.md","tags":[],"version":"2.6.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Sessions","permalink":"/2.6.0/concepts/sessions"},"next":{"title":"Models","permalink":"/2.6.0/concepts/database/models"}}');var t=o(74848),a=o(28453);const r={},i="Connection",c={},d=[{value:"Connection details",id:"connection-details",level:3},{value:"Configure search paths",id:"configure-search-paths",level:4},{value:"Database password",id:"database-password",level:3},{value:"Development database",id:"development-database",level:2},{value:"Connecting to a custom Postgres instance",id:"connecting-to-a-custom-postgres-instance",level:2},{value:"Connecting to a local Postgres server",id:"connecting-to-a-local-postgres-server",level:3},{value:"Connecting to a remote Postgres server",id:"connecting-to-a-remote-postgres-server",level:3},{value:"Connecting to Google Cloud SQL",id:"connecting-to-google-cloud-sql",level:3},{value:"Connecting to AWS RDS",id:"connecting-to-aws-rds",level:3}];function l(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"connection",children:"Connection"})}),"\n",(0,t.jsxs)(n.p,{children:["In Serverpod the connection details and password for the database are stored inside the ",(0,t.jsx)(n.code,{children:"config"})," directory in your server package. Serverpod automatically establishes a connection to the Postgres instance by using these configuration details when you start the server."]}),"\n",(0,t.jsx)(n.p,{children:"The easiest way to get started is to use a Docker container to run your local Postgres server, and this is how Serverpod is set up out of the box. This page contains more detailed information if you want to connect to another database instance or run Postgres locally yourself."}),"\n",(0,t.jsx)(n.h3,{id:"connection-details",children:"Connection details"}),"\n",(0,t.jsxs)(n.p,{children:["Each environment configuration contains a ",(0,t.jsx)(n.code,{children:"database"})," keyword that specifies the connection details.\nFor your development build you can find the connection details in the ",(0,t.jsx)(n.code,{children:"config/development.yaml"})," file."]}),"\n",(0,t.jsx)(n.p,{children:"This is an example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"...\ndatabase:\n  host: localhost\n  port: 8090\n  name: <YOUR_PROJECT_NAME>\n  user: postgres\n...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"name"})," refers to the database name, ",(0,t.jsx)(n.code,{children:"host"})," is the domain name or IP address pointing to your Postgres instance, ",(0,t.jsx)(n.code,{children:"port"})," is the port that Postgres is listening to, and ",(0,t.jsx)(n.code,{children:"user"})," is the username that is used to connect to the database."]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"By default, Postgres is listening for connections on port 5432. However, the Docker container shipped with Serverpod uses port 8090 to avoid conflicts. If you host your own instance, double-check that the correct port is specified in your configuration files."})}),"\n",(0,t.jsx)(n.h4,{id:"configure-search-paths",children:"Configure search paths"}),"\n",(0,t.jsxs)(n.p,{children:["You can customize the search paths for your database connection\u2014helpful if you're working with multiple schemas. By default, Postgres uses the ",(0,t.jsx)(n.code,{children:"public"})," schema unless otherwise specified."]}),"\n",(0,t.jsxs)(n.p,{children:["To override this, use the optional ",(0,t.jsx)(n.code,{children:"searchPaths"})," setting in your configuration:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"...\ndatabase:\n  host: localhost\n  port: 8090\n  name: <YOUR_PROJECT_NAME>\n  user: postgres\n  searchPaths:  custom, public\n...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In this example, Postgres will look for tables in the ",(0,t.jsx)(n.code,{children:"custom"})," schema first, and then fall back to ",(0,t.jsx)(n.code,{children:"public"})," if needed. This gives you more control over where your data lives and how it\u2019s accessed"]}),"\n",(0,t.jsx)(n.h3,{id:"database-password",children:"Database password"}),"\n",(0,t.jsxs)(n.p,{children:["The database password is stored in a separate file called ",(0,t.jsx)(n.code,{children:"passwords.yaml"})," in the same ",(0,t.jsx)(n.code,{children:"config"})," directory. The password for each environment is stored under the ",(0,t.jsx)(n.code,{children:"database"})," keyword in the file."]}),"\n",(0,t.jsx)(n.p,{children:"An example of this could look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"...\ndevelopment:\n  database: '<MY DATABASE PASSWORD>'\n...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"development-database",children:"Development database"}),"\n",(0,t.jsxs)(n.p,{children:["A newly created Serverpod project has a preconfigured Docker instance with a Postgres database set up. Run the following command from the root of the ",(0,t.jsx)(n.code,{children:"server"})," package to start the database:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ docker compose up --build --detach\n"})}),"\n",(0,t.jsx)(n.p,{children:"To stop the database run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ docker compose stop\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To remove the database and ",(0,t.jsx)(n.strong,{children:"delete"})," all associated data, run:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ docker compose down -v\n"})}),"\n",(0,t.jsx)(n.h2,{id:"connecting-to-a-custom-postgres-instance",children:"Connecting to a custom Postgres instance"}),"\n",(0,t.jsx)(n.p,{children:"Just like you can connect to the Postgres database inside the Docker container, you can connect to any other Postgres instance. There are a few things you need to take into consideration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Make sure that your Postgres instance is up and running and is reachable from your Serverpod server."}),"\n",(0,t.jsx)(n.li,{children:"You will need to create a user with a password, and a database."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"connecting-to-a-local-postgres-server",children:"Connecting to a local Postgres server"}),"\n",(0,t.jsxs)(n.p,{children:["If you want to connect to a local Postgres Server (with the default setup) then the ",(0,t.jsx)(n.code,{children:"development.yaml"})," will work fine if you set the correct port, user, database, and update the password in the ",(0,t.jsx)(n.code,{children:"passwords.yaml"})," file."]}),"\n",(0,t.jsx)(n.h3,{id:"connecting-to-a-remote-postgres-server",children:"Connecting to a remote Postgres server"}),"\n",(0,t.jsx)(n.p,{children:"To connect to a remote Postgres server (that you have installed on a VPS or VDS), you need to follow a couple of steps:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Make sure that the Postgres server has a reachable network address and that it accepts incoming traffic."}),"\n",(0,t.jsx)(n.li,{children:"You may need to open the database port on the machine. This may include configuring its firewall."}),"\n",(0,t.jsxs)(n.li,{children:["Update your Serverpod ",(0,t.jsx)(n.code,{children:"database"})," config to use the public network address, database name, port, user, and password."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"connecting-to-google-cloud-sql",children:"Connecting to Google Cloud SQL"}),"\n",(0,t.jsx)(n.p,{children:"You can connect to a Google Cloud SQL Postgres instance in two ways:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Setting up the ",(0,t.jsx)(n.em,{children:"Public IP Authorized networks"})," (with your Serverpod server IP) and changing the database host string to the ",(0,t.jsx)(n.em,{children:"Cloud SQL public IP"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Using the ",(0,t.jsx)(n.em,{children:"Connection String"})," if you are hosting your Serverpod server on Google Cloud Run and changing the database host string to the Cloud SQL: ",(0,t.jsx)(n.code,{children:"/cloudsql/my-project:server-location:database-name/.s.PGSQL.5432"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The next step is to update the database password in ",(0,t.jsx)(n.code,{children:"passwords.yaml"})," and the connection details for the desired environment in the ",(0,t.jsx)(n.code,{children:"config"})," folder."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["If you are using the ",(0,t.jsx)(n.code,{children:"isUnixSocket"})," don't forget to add ",(0,t.jsx)(n.strong,{children:'"/.s.PGSQL.5432"'})," to the end of the ",(0,t.jsx)(n.code,{children:"host"})," IP address. Otherwise, your Google Cloud Run instance will not be able to connect to the database."]})}),"\n",(0,t.jsx)(n.h3,{id:"connecting-to-aws-rds",children:"Connecting to AWS RDS"}),"\n",(0,t.jsx)(n.p,{children:"You can connect to an AWS RDS Instance in two ways:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Enable public access to the database and configure VPC/Subnets to accept your Serverpod's IP address."}),"\n",(0,t.jsxs)(n.li,{children:["Use the Endpoint ",(0,t.jsx)(n.code,{children:"database-name.some-unique-id.server-location.rds.amazonaws.com"})," to connect to it from AWS ECS."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The next step is to update the database password in ",(0,t.jsx)(n.code,{children:"passwords.yaml"})," and the connection details for the desired environment in the ",(0,t.jsx)(n.code,{children:"config"})," folder."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>i});var s=o(96540);const t={},a=s.createContext(t);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);