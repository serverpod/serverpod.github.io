"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[28697],{39272:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"concepts/authentication/token-managers/jwt-token-manager","title":"JWT Token Manager","description":"The JwtTokenManager uses JWT (JSON Web Tokens) for stateless authentication. This token manager provides:","source":"@site/docs/06-concepts/11-authentication/05-token-managers/02-jwt-token-manager.md","sourceDirName":"06-concepts/11-authentication/05-token-managers","slug":"/concepts/authentication/token-managers/jwt-token-manager","permalink":"/next/concepts/authentication/token-managers/jwt-token-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/docs/06-concepts/11-authentication/05-token-managers/02-jwt-token-manager.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Managing tokens","permalink":"/next/concepts/authentication/token-managers/managing-tokens"},"next":{"title":"Server-side Sessions Token Manager","permalink":"/next/concepts/authentication/token-managers/server-side-sessions-token-manager"}}');var o=t(74848),s=t(28453);const r={},a="JWT Token Manager",c={},l=[{value:"Server-side configuration",id:"server-side-configuration",level:2},{value:"Basic configuration options",id:"basic-configuration-options",level:3},{value:"Token Algorithms",id:"token-algorithms",level:4},{value:"Extra configuration options",id:"extra-configuration-options",level:3},{value:"Client-side configuration",id:"client-side-configuration",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"jwt-token-manager",children:"JWT Token Manager"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"JwtTokenManager"})," uses JWT (JSON Web Tokens) for stateless authentication. This token manager provides:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Stateless authentication (no database queries for validation)."}),"\n",(0,o.jsx)(n.li,{children:"Access tokens with short lifetimes."}),"\n",(0,o.jsx)(n.li,{children:"Refresh tokens for long-term authentication."}),"\n",(0,o.jsx)(n.li,{children:"Automatic token rotation."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"server-side-configuration",children:"Server-side configuration"}),"\n",(0,o.jsxs)(n.p,{children:["This token manager is created by passing a ",(0,o.jsx)(n.code,{children:"JwtConfig"})," object to the ",(0,o.jsx)(n.code,{children:"pod.initializeAuthServices()"})," as a ",(0,o.jsx)(n.code,{children:"tokenManagerBuilder"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"pod.initializeAuthServices(\n  tokenManagerBuilders: [\n    JwtConfig(\n      // The pepper used to hash the refresh token secret.\n      refreshTokenHashPepper: pod.getPassword(\n        'jwtRefreshTokenHashPepper',\n      )!,\n      // The algorithm used to sign the tokens.\n      algorithm: JwtAlgorithm.hmacSha512(\n        SecretKey(pod.getPassword('jwtHmacSha512PrivateKey')!),\n      ),\n    ),\n  ],\n);\n"})}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsxs)(n.p,{children:["You can use the ",(0,o.jsx)(n.code,{children:"JwtConfigFromPasswords"})," constructor in replacement of the ",(0,o.jsx)(n.code,{children:"JwtConfig"})," above to automatically load the credentials from the ",(0,o.jsx)(n.code,{children:"config/passwords.yaml"})," file or environment variables. It will expect either the following keys on the file:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"jwtRefreshTokenHashPepper"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"jwtHmacSha512PrivateKey"})}),"\n"]}),(0,o.jsx)(n.p,{children:"Or the following environment variables:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"SERVERPOD_PASSWORD_jwtRefreshTokenHashPepper"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"SERVERPOD_PASSWORD_jwtHmacSha512PrivateKey"})}),"\n"]})]}),"\n",(0,o.jsx)(n.h3,{id:"basic-configuration-options",children:"Basic configuration options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"algorithm"}),": Required. The algorithm to use for signing tokens (HMAC SHA-512 or ECDSA SHA-512)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"refreshTokenHashPepper"}),": Required. A secret pepper for hashing refresh tokens. Must be at least 10 characters long, but ",(0,o.jsx)(n.a,{href:"https://www.ietf.org/archive/id/draft-ietf-kitten-password-storage-04.html#name-storage-2",children:"the recommended length is 32 bytes"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"token-algorithms",children:"Token Algorithms"}),"\n",(0,o.jsx)(n.p,{children:"There are two supported token algorithms:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"HMAC SHA-512"}),": Use HMAC SHA-512 for symmetric key signing."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"algorithm: JwtAlgorithm.hmacSha512(\n  SecretKey(pod.getPassword('authenticationTokenPrivateKey')!),\n),\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"ECDSA SHA-512"}),": Use ECDSA SHA-512 for asymmetric key signing."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"algorithm: JwtAlgorithm.ecdsaSha512(\n  privateKey: ecPrivateKey,\n  publicKey: ecPublicKey,\n),\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["As of now, the ",(0,o.jsx)(n.code,{children:"JwtConfigFromPasswords"})," only supports HMAC SHA-512. To use ECDSA SHA-512, you need to pass the private and public keys manually."]}),"\n",(0,o.jsx)(n.h3,{id:"extra-configuration-options",children:"Extra configuration options"}),"\n",(0,o.jsxs)(n.p,{children:["Below is an example of a non-exhaustive list of some of the most common configuration options for the ",(0,o.jsx)(n.code,{children:"JwtTokenManager"}),". For more details on all options, check the ",(0,o.jsx)(n.code,{children:"JwtConfig"})," in-code documentation."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"final jwtConfig = JwtConfigFromPasswords(\n  // Optional: Set fallback algorithms for token verification\n  // This is useful for allowing old tokens to be validated after a rotation.\n  fallbackVerificationAlgorithms: [\n    JwtAlgorithm.hmacSha512(\n      SecretKey(pod.getPassword('fallbackJwtPrivateKey')!),\n    ),\n  ],\n  // Optional: Configure token lifetimes\n  accessTokenLifetime: Duration(minutes: 10),\n  refreshTokenLifetime: Duration(days: 14),\n  // Optional: Add custom claims to tokens.\n  // Claims will be included in every access token and sent with requests.\n  extraClaimsProvider: (session, context) async {\n    return {\n      'userRole': 'admin',\n      'organizationId': 'org-123',\n    };\n  },\n  // Check the [JwtConfig] documentation for more options.\n);\n"})}),"\n",(0,o.jsx)(n.h2,{id:"client-side-configuration",children:"Client-side configuration"}),"\n",(0,o.jsxs)(n.p,{children:["When using the ",(0,o.jsx)(n.code,{children:"JwtTokenManager"})," in the server, no extra configuration is needed on the client. It will automatically include the access token in requests to the server and eagerly refresh the token when it is 30 seconds away from expiring. In case the refresh token expires, the client will automatically sign the user out and redirect to the login page."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);