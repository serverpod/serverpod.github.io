"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[35836],{14997:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"concepts/authentication/providers/google/setup","title":"Setup","description":"To set up Sign in with Google, you will need a Google account for your organization and set up a new project. For the project, you need to set up Credentials and OAuth consent screen. You will also need to add the serverpodauthidp_flutter package to your app and do some additional setup depending on each platform.","source":"@site/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/02-google/01-setup.md","sourceDirName":"06-concepts/11-authentication/04-providers/02-google","slug":"/concepts/authentication/providers/google/setup","permalink":"/3.0.0/concepts/authentication/providers/google/setup","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/02-google/01-setup.md","tags":[],"version":"3.0.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Admin Operations","permalink":"/3.0.0/concepts/authentication/providers/email/admin-operations"},"next":{"title":"Configuration","permalink":"/3.0.0/concepts/authentication/providers/google/configuration"}}');var o=i(74848),r=i(28453);const s={},d="Setup",l={},c=[{value:"Create your credentials",id:"create-your-credentials",level:2},{value:"Enable People API",id:"enable-people-api",level:3},{value:"Setup OAuth consent screen",id:"setup-oauth-consent-screen",level:3},{value:"Server-side configuration",id:"server-side-configuration",level:2},{value:"Basic configuration options",id:"basic-configuration-options",level:3},{value:"Client-side configuration",id:"client-side-configuration",level:2},{value:"iOS",id:"ios",level:3},{value:"Add the URL scheme",id:"add-the-url-scheme",level:4},{value:"Android",id:"android",level:3},{value:"Web",id:"web",level:3},{value:"Present the authentication UI",id:"present-the-authentication-ui",level:2},{value:"Initializing the <code>GoogleSignInService</code>",id:"initializing-the-googlesigninservice",level:3},{value:"Using GoogleSignInWidget",id:"using-googlesigninwidget",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"setup",children:"Setup"})}),"\n",(0,o.jsxs)(n.p,{children:["To set up Sign in with Google, you will need a Google account for your organization and set up a new project. For the project, you need to set up ",(0,o.jsx)(n.em,{children:"Credentials"})," and ",(0,o.jsx)(n.em,{children:"OAuth consent screen"}),". You will also need to add the ",(0,o.jsx)(n.code,{children:"serverpod_auth_idp_flutter"})," package to your app and do some additional setup depending on each platform."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Right now, we have official support for iOS, Android, and Web for Google Sign In."})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["You need to install the auth module before you continue, see ",(0,o.jsx)(n.a,{href:"../../setup",children:"Setup"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"create-your-credentials",children:"Create your credentials"}),"\n",(0,o.jsxs)(n.p,{children:["To implement Google Sign In, you need a Google Cloud project. You can create one in the ",(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/",children:"Google Cloud Console"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"enable-people-api",children:"Enable People API"}),"\n",(0,o.jsx)(n.p,{children:"To be allowed to access user data and use the authentication method in Serverpod we have to enable the People API in our project."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/apis/library/people.googleapis.com",children:"Enable it here"})," or find it yourself by navigating to the ",(0,o.jsx)(n.em,{children:"Library"})," section under ",(0,o.jsx)(n.em,{children:"APIs & Services"}),". Search for ",(0,o.jsx)(n.em,{children:"Google People API"}),", select it, and click on ",(0,o.jsx)(n.em,{children:"Enable"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"setup-oauth-consent-screen",children:"Setup OAuth consent screen"}),"\n",(0,o.jsxs)(n.p,{children:["The setup for the OAuth consent screen can be found ",(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/apis/credentials/consent",children:"here"})," or under ",(0,o.jsx)(n.em,{children:"APIs & Services"})," > ",(0,o.jsx)(n.em,{children:"OAuth consent screen"}),"."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Fill in all the required information, for production use you need a domain that adds under ",(0,o.jsx)(n.code,{children:"Authorized"})," domains."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the scopes ",(0,o.jsx)(n.code,{children:".../auth/userinfo.email"})," and ",(0,o.jsx)(n.code,{children:".../auth/userinfo.profile"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add your email to the test users so that you can test your integration in development mode."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Scopes",src:i(7633).A+"",width:"2466",height:"1868"})}),"\n",(0,o.jsx)(n.h2,{id:"server-side-configuration",children:"Server-side configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Create the server credentials in the Google Cloud Console. Navigate to ",(0,o.jsx)(n.em,{children:"Credentials"})," under ",(0,o.jsx)(n.em,{children:"APIs & Services"}),". Click ",(0,o.jsx)(n.em,{children:"Create Credentials"})," and select ",(0,o.jsx)(n.em,{children:"OAuth client ID"}),". Configure the OAuth client as a ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"Web application"})}),". If you have a domain add it to the ",(0,o.jsx)(n.code,{children:"Authorized JavaScript origins"})," and ",(0,o.jsx)(n.code,{children:"Authorized redirect URIs"}),". For development purposes we can add ",(0,o.jsx)(n.code,{children:"http://localhost:8082"})," to both fields, this is the address to the web server."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Google credentials",src:i(1065).A+"",width:"2286",height:"1020"})}),"\n",(0,o.jsxs)(n.p,{children:["Download the JSON file for your web application OAuth client. This file contains both the client id and the client secret. You will need to supply the contents of the file to the ",(0,o.jsx)(n.code,{children:"clientSecret"})," property of the ",(0,o.jsx)(n.code,{children:"GoogleIdpConfig"})," object."]}),"\n",(0,o.jsxs)(n.p,{children:["This can be done by pasting the contents of the JSON file into the ",(0,o.jsx)(n.code,{children:"googleClientSecret"})," key in the ",(0,o.jsx)(n.code,{children:"config/passwords.yaml"})," file or setting as value of the ",(0,o.jsx)(n.code,{children:"SERVERPOD_PASSWORD_googleClientSecret"})," environment variable. Alternatively, you can read the file contents directly using the ",(0,o.jsx)(n.code,{children:"GoogleClientSecret.fromJsonFile()"})," method."]}),"\n",(0,o.jsxs)(n.p,{children:["In your main ",(0,o.jsx)(n.code,{children:"server.dart"})," file, configure the Google identity provider:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\nimport 'package:serverpod_auth_idp_server/providers/google.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  pod.initializeAuthServices(\n    tokenManagerBuilders: [\n      JwtConfigFromPasswords(),\n    ],\n    identityProviderBuilders: [\n      GoogleIdpConfig(\n        clientSecret: GoogleClientSecret.fromJsonString(\n          pod.getPassword('googleClientSecret')!,\n        ),\n      ),\n    ],\n  );\n\n  await pod.start();\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can use the ",(0,o.jsx)(n.code,{children:"GoogleIdpConfigFromPasswords"})," constructor in replacement of the ",(0,o.jsx)(n.code,{children:"GoogleIdpConfig"})," above to automatically load the client secret from the ",(0,o.jsx)(n.code,{children:"config/passwords.yaml"})," file or environment variables. It will expect the ",(0,o.jsx)(n.code,{children:"googleClientSecret"})," key on the file or the ",(0,o.jsx)(n.code,{children:"SERVERPOD_PASSWORD_googleClientSecret"})," environment variable."]})}),"\n",(0,o.jsx)(n.p,{children:"Then, extend the abstract endpoint to expose it on the server:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_server/providers/google.dart';\n\nclass GoogleIdpEndpoint extends GoogleIdpBaseEndpoint {}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Finally, run ",(0,o.jsx)(n.code,{children:"serverpod generate"})," to generate the client code and create a migration to initialize the database for the provider. More detailed instructions can be found in the general ",(0,o.jsx)(n.a,{href:"../../setup#identity-providers-configuration",children:"identity providers setup section"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"basic-configuration-options",children:"Basic configuration options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"clientSecret"}),": Required. Google OAuth client secret loaded from JSON. See the ",(0,o.jsx)(n.a,{href:"./configuration",children:"configuration section"})," for details on different ways to load the client secret."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For more details on configuration options, such as customizing account validation, accessing Google APIs, and more, see the ",(0,o.jsx)(n.a,{href:"./configuration",children:"configuration section"}),"."]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"google_client_secret.json"})," contains a private key and should not be version controlled. Store it securely using environment variables or secret management."]})}),"\n",(0,o.jsx)(n.h2,{id:"client-side-configuration",children:"Client-side configuration"}),"\n",(0,o.jsxs)(n.p,{children:["For our client-side configurations, we have to first create client-side credentials and include the credentials files in our projects. The Android and iOS integrations use the ",(0,o.jsx)(n.a,{href:"https://pub.dev/packages/google_sign_in",children:"google_sign_in"})," package under the hood, so any documentation there should also apply to this setup."]}),"\n",(0,o.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,o.jsxs)(n.p,{children:["Create the client credentials. Navigate to ",(0,o.jsx)(n.em,{children:"Credentials"})," under ",(0,o.jsx)(n.em,{children:"APIs & Services"}),". Click ",(0,o.jsx)(n.em,{children:"Create Credentials"})," and select ",(0,o.jsx)(n.em,{children:"OAuth client ID"}),". Configure the OAuth client as Application type ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"iOS"})}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Fill in all the required information, and create the credentials. Then download the ",(0,o.jsx)(n.code,{children:"plist"})," file rename it to ",(0,o.jsx)(n.code,{children:"GoogleService-Info.plist"})," and put it inside your ios project folder. Then drag and drop it into your XCode project to include the file in your build."]}),"\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"GoogleService-Info.plist"})," in your editor and add the SERVER_CLIENT_ID if it does not exist:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<dict>\n  ...\n  <key>SERVER_CLIENT_ID</key>\n  <string>your_server_client_id</string>\n</dict>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Replace ",(0,o.jsx)(n.code,{children:"your_server_client_id"})," with the client id from the JSON file you put inside the config folder in the server."]}),"\n",(0,o.jsx)(n.h4,{id:"add-the-url-scheme",children:"Add the URL scheme"}),"\n",(0,o.jsxs)(n.p,{children:["To allow us to navigate back to the app after the user has signed in we have to add the URL Scheme, the scheme is the reversed client ID of your iOS app. You can find it inside the ",(0,o.jsx)(n.code,{children:"GoogleService-Info.plist"})," file."]}),"\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"info.plist"})," file in your editor and add the following to register the URL Scheme."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<dict>\n  ...\n  <key>CFBundleURLTypes</key>\n  <array>\n    <dict>\n      <key>CFBundleTypeRole</key>\n      <string>Editor</string>\n      <key>CFBundleURLSchemes</key>\n      <array>\n        <string>your_reversed_client_id</string>\n      </array>\n    </dict>\n  </array>\n</dict>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Replace ",(0,o.jsx)(n.code,{children:"your_reversed_client_id"})," with your reversed client ID."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:['If you have any social logins in your app you also need to integrate "Sign in with Apple" to publish your app to the app store. (',(0,o.jsx)(n.a,{href:"https://developer.apple.com/sign-in-with-apple/get-started/",children:"Read more"}),")."]})}),"\n",(0,o.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,o.jsxs)(n.p,{children:["Create the client credentials. Navigate to ",(0,o.jsx)(n.em,{children:"Credentials"})," under ",(0,o.jsx)(n.em,{children:"APIs & Services"}),". Click ",(0,o.jsx)(n.em,{children:"Create Credentials"})," and select ",(0,o.jsx)(n.em,{children:"OAuth client ID"}),". Configure the OAuth client as Application type ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"Android"})}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Fill in all required information, you can get the debug SHA-1 hash by running ",(0,o.jsx)(n.code,{children:"./gradlew signingReport"})," in your Android project directory. Create the credentials and download the JSON file."]}),"\n",(0,o.jsxs)(n.p,{children:["Put the file inside the ",(0,o.jsx)(n.code,{children:"android/app/"})," directory and rename it to ",(0,o.jsx)(n.code,{children:"google-services.json"}),"."]}),"\n",(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsxs)(n.p,{children:["For a production app you need to get the SHA-1 key from your production keystore! This can be done by running this command: (",(0,o.jsx)(n.a,{href:"https://support.google.com/cloud/answer/6158849#installedapplications&android&zippy=%2Cnative-applications%2Candroid",children:"Read more"}),")."]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ keytool -list -v -keystore /path/to/keystore\n"})})]}),"\n",(0,o.jsx)(n.h3,{id:"web",children:"Web"}),"\n",(0,o.jsx)(n.p,{children:"There is no need to create any client credentials for the web, since it uses the same client ID as the server. However, you have to modify the server credentials inside the Google Cloud Console."}),"\n",(0,o.jsxs)(n.p,{children:["Navigate to ",(0,o.jsx)(n.em,{children:"Credentials"})," under ",(0,o.jsx)(n.em,{children:"APIs & Services"})," and select the server credentials. Under ",(0,o.jsx)(n.code,{children:"Authorized JavaScript origins"})," and ",(0,o.jsx)(n.code,{children:"Authorized redirect URIs"})," add the domain for your Flutter app, for development, this is ",(0,o.jsx)(n.code,{children:"http://localhost:<port>"})," where the port is the port you are using."]}),"\n",(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsx)(n.p,{children:"Force flutter to run on a specific port by running."}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ flutter run -d chrome --web-port=49660\n"})})]}),"\n",(0,o.jsx)(n.p,{children:"Set up the actual redirect URI where the user will navigate after the sign-in. You can choose any path you want but it has to be the same in the credentials, your server, and Flutter configurations."}),"\n",(0,o.jsxs)(n.p,{children:["For example, using the path ",(0,o.jsx)(n.code,{children:"/googlesignin"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["For development inside ",(0,o.jsx)(n.code,{children:"Authorized redirect URIs"})," add ",(0,o.jsx)(n.code,{children:"http://localhost:8082/googlesignin"}),", in production use ",(0,o.jsx)(n.code,{children:"https://example.com/googlesignin"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Then, on the ",(0,o.jsx)(n.code,{children:"web/index.html"})," file, add the following to the ",(0,o.jsx)(n.code,{children:"<head>"})," section:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<head>\n  ...\n  <meta name="google-signin-client_id" content="your_server_client_id">\n</head>\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Google credentials",src:i(38057).A+"",width:"1600",height:"1633"})}),"\n",(0,o.jsx)(n.h2,{id:"present-the-authentication-ui",children:"Present the authentication UI"}),"\n",(0,o.jsxs)(n.h3,{id:"initializing-the-googlesigninservice",children:["Initializing the ",(0,o.jsx)(n.code,{children:"GoogleSignInService"})]}),"\n",(0,o.jsxs)(n.p,{children:["To use the GoogleSignInService, you need to initialize it in your main function. The initialization is done from the ",(0,o.jsx)(n.code,{children:"initializeGoogleSignIn()"})," extension method on the ",(0,o.jsx)(n.code,{children:"FlutterAuthSessionManager"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\nimport 'package:your_client/your_client.dart';\n\nfinal client = Client('http://localhost:8080/')\n  ..authSessionManager = FlutterAuthSessionManager();\n\nvoid main() {\n  client.auth.initialize();\n  client.auth.initializeGoogleSignIn();\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"using-googlesigninwidget",children:"Using GoogleSignInWidget"}),"\n",(0,o.jsxs)(n.p,{children:["If you have configured the ",(0,o.jsx)(n.code,{children:"SignInWidget"})," as described in the ",(0,o.jsx)(n.a,{href:"../../setup#present-the-authentication-ui",children:"setup section"}),", the Google identity provider will be automatically detected and displayed in the sign-in widget."]}),"\n",(0,o.jsxs)(n.p,{children:["You can also use the ",(0,o.jsx)(n.code,{children:"GoogleSignInWidget"})," to include the Google authentication flow in your own custom UI."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\n\nGoogleSignInWidget(\n  client: client,\n  onAuthenticated: () {\n    // Navigate to home screen or update UI\n    Navigator.of(context).pushReplacement(\n      MaterialPageRoute(builder: (_) => HomePage()),\n    );\n  },\n  onError: (error) {\n    // Handle errors\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(content: Text('Error: $error')),\n    );\n  },\n)\n"})}),"\n",(0,o.jsx)(n.p,{children:"The widget automatically handles:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Google Sign-In flow for iOS, Android, and Web."}),"\n",(0,o.jsx)(n.li,{children:"Lightweight sign-in (One Tap, FedCM) support."}),"\n",(0,o.jsx)(n.li,{children:"Token management."}),"\n",(0,o.jsx)(n.li,{children:"Underlying Google Sign-In package error handling."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For details on how to customize the Google Sign-In UI in your Flutter app, see the ",(0,o.jsx)(n.a,{href:"./customizing-the-ui",children:"customizing the UI section"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},1065:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/6-google-credentials-aba2aae45d64b6d5438133a0c68765f6.jpg"},7633:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/1-scopes-d56cd609ea43c479954d557e738e49ae.png"},38057:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/2-credentials-fe2a434385d0a3bf67cd0f415385a21c.png"},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var t=i(96540);const o={},r=t.createContext(o);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);