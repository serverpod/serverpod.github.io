"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[3598],{89708:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"concepts/authentication/providers/email/configuration","title":"Configuration","description":"This page covers configuration options for the email identity provider beyond the basic setup.","source":"@site/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/01-email/02-configuration.md","sourceDirName":"06-concepts/11-authentication/04-providers/01-email","slug":"/concepts/authentication/providers/email/configuration","permalink":"/3.0.0/concepts/authentication/providers/email/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/01-email/02-configuration.md","tags":[],"version":"3.0.0","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Setup","permalink":"/3.0.0/concepts/authentication/providers/email/setup"},"next":{"title":"Customizing the UI","permalink":"/3.0.0/concepts/authentication/providers/email/customizing-the-ui"}}');var o=n(74848),s=n(28453);const r={},a="Configuration",d={},c=[{value:"Configuration options",id:"configuration-options",level:2},{value:"Peppering",id:"peppering",level:3},{value:"Rotating secret hash peppers",id:"rotating-secret-hash-peppers",level:4},{value:"Customizing Password Requirements",id:"customizing-password-requirements",level:3},{value:"Custom Verification Code Generation",id:"custom-verification-code-generation",level:3},{value:"Bypassing verification code in development",id:"bypassing-verification-code-in-development",level:4},{value:"Reacting to events",id:"reacting-to-events",level:3},{value:"Rate limiting",id:"rate-limiting",level:3}];function l(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.header,{children:(0,o.jsx)(i.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,o.jsx)(i.p,{children:"This page covers configuration options for the email identity provider beyond the basic setup."}),"\n",(0,o.jsx)(i.h2,{id:"configuration-options",children:"Configuration options"}),"\n",(0,o.jsxs)(i.p,{children:["Below is a non-exhaustive list of some of the most common configuration options. For more details on all options, check the ",(0,o.jsx)(i.code,{children:"EmailIdpConfig"})," in-code documentation."]}),"\n",(0,o.jsx)(i.h3,{id:"peppering",children:"Peppering"}),"\n",(0,o.jsx)(i.p,{children:"A pepper is a server-side secret that is added, along with a unique salt, to a password before it is hashed and stored. The pepper makes it harder for an attacker to crack password hashes if they have only gained access to the database."}),"\n",(0,o.jsxs)(i.p,{children:["The pepper is configured via the ",(0,o.jsx)(i.code,{children:"secretHashPepper"})," property in ",(0,o.jsx)(i.code,{children:"EmailIdpConfig"}),", as shown in the ",(0,o.jsx)(i.a,{href:"./setup#server-side-configuration",children:"server-side configuration"})," section. Its ",(0,o.jsx)(i.a,{href:"https://www.ietf.org/archive/id/draft-ietf-kitten-password-storage-04.html#name-storage-2",children:"recommended pepper length"})," is 32 bytes."]}),"\n",(0,o.jsx)(i.admonition,{type:"warning",children:(0,o.jsx)(i.p,{children:"If the pepper is changed, all passwords in the database will need to be re-hashed with the new pepper, or the old pepper needs to be added as a fallback pepper. Store the pepper securely and never expose it to the client."})}),"\n",(0,o.jsx)(i.h4,{id:"rotating-secret-hash-peppers",children:"Rotating secret hash peppers"}),"\n",(0,o.jsxs)(i.p,{children:["To keep old passwords valid after a pepper change, use the ",(0,o.jsx)(i.code,{children:"fallbackSecretHashPeppers"})," configuration option to add the old pepper as a fallback pepper."]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-dart",children:"final emailIdpConfig = EmailIdpConfigFromPasswords(\n  fallbackSecretHashPeppers: [\n    pod.getPassword('oldEmailSecretHashPepper')!,\n  ],\n);\n"})}),"\n",(0,o.jsx)(i.h3,{id:"customizing-password-requirements",children:"Customizing Password Requirements"}),"\n",(0,o.jsxs)(i.p,{children:["By default, the minimum password length is set to 8 characters. If you wish to modify this requirement, you can utilize the ",(0,o.jsx)(i.code,{children:"passwordValidationFunction"})," configuration option."]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-dart",children:"final emailIdpConfig = EmailIdpConfigFromPasswords(\n  passwordValidationFunction: (password) {\n    // Require at least 12 characters, one uppercase, one lowercase, one number\n    if (password.length < 12) return false;\n    if (!password.contains(RegExp(r'[A-Z]'))) return false;\n    if (!password.contains(RegExp(r'[a-z]'))) return false;\n    if (!password.contains(RegExp(r'[0-9]'))) return false;\n    return true;\n  },\n);\n"})}),"\n",(0,o.jsx)(i.admonition,{type:"tip",children:(0,o.jsxs)(i.p,{children:["This is useful to ensure password policies on the server-side. It is a best practice to pair it with a configuration on the client-side to provide a better UX when creating a new password. The ",(0,o.jsx)(i.code,{children:"EmailSignInWidget"})," and ",(0,o.jsx)(i.code,{children:"EmailAuthController"})," have a ",(0,o.jsx)(i.code,{children:"passwordRequirements"})," parameter that can be used to configure the password requirements."]})}),"\n",(0,o.jsx)(i.h3,{id:"custom-verification-code-generation",children:"Custom Verification Code Generation"}),"\n",(0,o.jsx)(i.p,{children:"You can customize how verification codes are generated:"}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-dart",children:"final emailIdpConfig = EmailIdpConfigFromPasswords(\n  registrationVerificationCodeGenerator: () {\n    // Generate a 6-digit numeric code\n    final random = Random();\n    return List.generate(6, (_) => random.nextInt(10)).join();\n  },\n);\n"})}),"\n",(0,o.jsx)(i.admonition,{type:"warning",children:(0,o.jsxs)(i.p,{children:["Remember to configure the ",(0,o.jsx)(i.code,{children:"verificationCodeConfig"})," parameter on the ",(0,o.jsx)(i.code,{children:"EmailSignInWidget"})," to match the length of the verification code you generate. Otherwise, users will never be able to enter the verification code correctly. See the ",(0,o.jsx)(i.a,{href:"./customizing-the-ui",children:"customizing the UI section"})," for more details."]})}),"\n",(0,o.jsx)(i.h4,{id:"bypassing-verification-code-in-development",children:"Bypassing verification code in development"}),"\n",(0,o.jsx)(i.p,{children:"To simplify testing, it is possible to bypass the verification code by using a custom verification code generator that always returns the same code. This can be configured only for the development run mode as below:"}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-dart",children:"pod.initializeAuthServices(\n  tokenManagerBuilders: [\n    JwtConfigFromPasswords(),\n  ],\n  identityProviderBuilders: [\n    EmailIdpConfigFromPasswords(\n      registrationVerificationCodeGenerator: pod.runMode == 'development'\n          ? () => 'aaaaaaaa' // Be sure to match the length used in production.\n          : defaultVerificationCodeGenerator,\n    ),\n  ],\n);\n"})}),"\n",(0,o.jsx)(i.h3,{id:"reacting-to-events",children:"Reacting to events"}),"\n",(0,o.jsxs)(i.p,{children:["Beyond the ",(0,o.jsx)(i.code,{children:"sendRegistrationVerificationCode"})," and ",(0,o.jsx)(i.code,{children:"sendPasswordResetVerificationCode"})," callbacks to send verification codes to the user, there are a few callbacks that can be used to react to events, such as ",(0,o.jsx)(i.code,{children:"onAfterAccountCreated"})," and ",(0,o.jsx)(i.code,{children:"onPasswordResetCompleted"}),". These can be useful for sending emails to the user to communicate the successful operation."]}),"\n",(0,o.jsx)(i.h3,{id:"rate-limiting",children:"Rate limiting"}),"\n",(0,o.jsx)(i.p,{children:"The email provider includes built-in rate limiting to prevent abuse, with some sensible defaults:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.strong,{children:"Failed login attempts"}),": Limited to 5 attempts per 5 minutes"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.strong,{children:"Password reset attempts"}),": Limited to 3 attempts per hour"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.strong,{children:"Verification code attempts"}),": Limited to 3 attempts per code lifetime of 15 minutes"]}),"\n"]}),"\n",(0,o.jsxs)(i.p,{children:["You can customize all rate limits in the ",(0,o.jsx)(i.code,{children:"EmailIdpConfig"}),":"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-dart",children:"final emailIdpConfig = EmailIdpConfigFromPasswords(\n  registrationVerificationCodeLifetime: Duration(minutes: 15),\n  registrationVerificationCodeAllowedAttempts: 3,\n  passwordResetVerificationCodeLifetime: Duration(minutes: 15),\n  passwordResetVerificationCodeAllowedAttempts: 3,\n  failedLoginRateLimit: RateLimit(\n    maxAttempts: 10,\n    timeframe: Duration(minutes: 10),\n  ),\n  maxPasswordResetAttempts: RateLimit(\n    maxAttempts: 5,\n    timeframe: Duration(hours: 2),\n  ),\n);\n"})})]})}function p(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,o.jsx)(i,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>a});var t=n(96540);const o={},s=t.createContext(o);function r(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);