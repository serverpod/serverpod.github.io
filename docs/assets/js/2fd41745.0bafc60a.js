"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[926],{66756:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"concepts/authentication/working-with-users","title":"Working with users","description":"The authentication module provides convenient ways to work with your authenticated users and their related profile data.","source":"@site/versioned_docs/version-3.0.0/06-concepts/11-authentication/03-working-with-users.md","sourceDirName":"06-concepts/11-authentication","slug":"/concepts/authentication/working-with-users","permalink":"/3.0.0/concepts/authentication/working-with-users","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.0.0/06-concepts/11-authentication/03-working-with-users.md","tags":[],"version":"3.0.0","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"The basics","permalink":"/3.0.0/concepts/authentication/basics"},"next":{"title":"Setup","permalink":"/3.0.0/concepts/authentication/providers/email/setup"}}');var t=s(74848),r=s(28453);const a={},o="Working with users",d={},l=[{value:"Authenticated users",id:"authenticated-users",level:2},{value:"Blocking users",id:"blocking-users",level:2},{value:"Blocking or unblocking a user",id:"blocking-or-unblocking-a-user",level:3},{value:"User profiles",id:"user-profiles",level:2},{value:"Accessing user profiles from the app",id:"accessing-user-profiles-from-the-app",level:3},{value:"Extending the user profile edit endpoint",id:"extending-the-user-profile-edit-endpoint",level:3},{value:"Setting a default user image",id:"setting-a-default-user-image",level:3},{value:"Attaching additional information",id:"attaching-additional-information",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"working-with-users",children:"Working with users"})}),"\n",(0,t.jsx)(n.p,{children:"The authentication module provides convenient ways to work with your authenticated users and their related profile data."}),"\n",(0,t.jsx)(n.h2,{id:"authenticated-users",children:"Authenticated users"}),"\n",(0,t.jsxs)(n.p,{children:["All authenticated users have an authentication identifier, that uniquely identifies them across the server. This can be retrieved from the ",(0,t.jsx)(n.code,{children:"session"})," object as a ",(0,t.jsx)(n.code,{children:"String"})," through the ",(0,t.jsx)(n.code,{children:"userIdentifier"})," property or as a ",(0,t.jsx)(n.code,{children:"UuidValue"})," from the ",(0,t.jsx)(n.code,{children:"authUserId"})," extension provided by the authentication module."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"var userIdString = session.authenticated?.userIdentifier;\n// requires `import 'package:serverpod_auth_idp_server/serverpod_auth_idp_server.dart';`\nvar userIdUuidValue = session.authenticated?.authUserId;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Further operations on the authenticated user can be performed using the ",(0,t.jsx)(n.code,{children:"AuthUsers"})," class which is provide by the ",(0,t.jsx)(n.code,{children:"AuthServices"})," instance."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"await AuthServices.instance.authUsers.delete(session, userIdUuidValue);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For the full list of operations, see the ",(0,t.jsx)(n.a,{href:"https://pub.dev/documentation/serverpod_auth_core_server/latest/serverpod_auth_core_server/AuthUsers-class.html",children:"AuthUsers"})," class documentation."]}),"\n",(0,t.jsx)(n.h2,{id:"blocking-users",children:"Blocking users"}),"\n",(0,t.jsxs)(n.p,{children:["You can block users to prevent them from signing in to your application. When a blocked user attempts to authenticate, an ",(0,t.jsx)(n.code,{children:"AuthUserBlockedException"})," will be thrown, and the authentication will fail."]}),"\n",(0,t.jsx)(n.h3,{id:"blocking-or-unblocking-a-user",children:"Blocking or unblocking a user"}),"\n",(0,t.jsxs)(n.p,{children:["To block/unblock a user, use the ",(0,t.jsx)(n.code,{children:"update"})," method of the ",(0,t.jsx)(n.code,{children:"AuthUsers"})," class:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"await AuthServices.instance.authUsers.update(\n  session,\n  authUserId: authUserId,\n  blocked: true, // or false to unblock\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Users can also be created with the blocked status set from the start:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"await AuthServices.instance.authUsers.create(\n  session,\n  blocked: true,\n);\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["When a user is blocked, they will not be able to sign in until they are unblocked. However, blocking a user does not automatically revoke their existing sessions. Be sure to revoke existing sessions for a complete block operation. See ",(0,t.jsx)(n.a,{href:"./token-managers/managing-tokens#revoking-tokens",children:"Revoking tokens"})," for more details."]})}),"\n",(0,t.jsx)(n.h2,{id:"user-profiles",children:"User profiles"}),"\n",(0,t.jsxs)(n.p,{children:["By default, all authenticated users have a ",(0,t.jsx)(n.code,{children:"UserProfile"})," object that contains information about the signed-in user. To access the ",(0,t.jsx)(n.code,{children:"UserProfile"})," object, you can use the ",(0,t.jsx)(n.code,{children:"userProfile"})," extension on the ",(0,t.jsx)(n.code,{children:"AuthenticationInfo"})," object."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"var userProfile = await session.authenticated?.userProfile(session);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"UserProfile"})," contains a basic set of information about the user, such as their full name, email address, and profile picture."]}),"\n",(0,t.jsx)(n.p,{children:"This information is automatically populated when the user signs in. Based on the authentication method used, different data may be available."}),"\n",(0,t.jsxs)(n.p,{children:["It's a common task to read or update user information on your server. The ",(0,t.jsx)(n.code,{children:"UserProfiles"})," class provides many convenient methods for working with user profiles and is accessible through the ",(0,t.jsx)(n.code,{children:"AuthServices"})," instance."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"await AuthServices.instance.userProfiles.changeFullName(session, authUserId, 'my name');\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For the full list of operations, see the ",(0,t.jsx)(n.a,{href:"https://pub.dev/documentation/serverpod_auth_core_server/latest/serverpod_auth_core_server/UserProfiles-class.html",children:"UserProfiles"})," class documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"accessing-user-profiles-from-the-app",children:"Accessing user profiles from the app"}),"\n",(0,t.jsxs)(n.p,{children:["To access the user profile from your Flutter app, you can use the ",(0,t.jsx)(n.code,{children:"userProfileInfo"})," endpoint that is included in the authentication module:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final userProfile = await client.modules.serverpod_auth_core.userProfileInfo.get();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This returns a ",(0,t.jsx)(n.code,{children:"UserProfileModel"})," object containing the logged-in user's profile information such as their name, email, and profile picture."]}),"\n",(0,t.jsx)(n.h3,{id:"extending-the-user-profile-edit-endpoint",children:"Extending the user profile edit endpoint"}),"\n",(0,t.jsxs)(n.p,{children:["The authentication module provides a ",(0,t.jsx)(n.code,{children:"UserProfileEditBaseEndpoint"})," abstract class that you can extend to expose user profile editing functionality to your app. This base endpoint includes methods for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Removing user images"}),"\n",(0,t.jsx)(n.li,{children:"Setting user images"}),"\n",(0,t.jsx)(n.li,{children:"Changing user names"}),"\n",(0,t.jsx)(n.li,{children:"Changing full names"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["To enable profile editing in your app, create a concrete endpoint class on your server by extending ",(0,t.jsx)(n.code,{children:"UserProfileEditBaseEndpoint"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\n\nclass UserProfileEditEndpoint extends UserProfileEditBaseEndpoint {}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This endpoint will have both ",(0,t.jsx)(n.code,{children:"get"})," (same as ",(0,t.jsx)(n.code,{children:"userProfileInfo"}),") and all profile editing methods. You can then call these methods from your Flutter app:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"// Get the user's profile\nfinal profile = await client.userProfileEdit.get();\n\n// Change the user's full name\nfinal updatedProfile = await client.userProfileEdit.changeFullName('John Doe');\n\n// Change the user's username\nfinal updatedProfile = await client.userProfileEdit.changeUserName('johndoe');\n\n// Remove the user's profile image\nfinal updatedProfile = await client.userProfileEdit.removeUserImage();\n\n// Set a new profile image\nfinal ByteData imageData = // ... load image data\nfinal updatedProfile = await client.userProfileEdit.setUserImage(imageData);\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"UserProfileEditBaseEndpoint"})," requires authentication and operates on the currently authenticated user's profile."]})}),"\n",(0,t.jsx)(n.p,{children:"You can also extend the endpoint class to add custom profile editing functionality:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class UserProfileEditEndpoint extends UserProfileEditBaseEndpoint {\n  Future<UserProfileModel> myCustomProfileEdit(Session session, String bio) async {\n    final userProfile = await session.authenticated?.userProfile(session);\n\n    // Your custom logic here...\n\n    return userProfile;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"setting-a-default-user-image",children:"Setting a default user image"}),"\n",(0,t.jsxs)(n.p,{children:["When logging in from some providers, the user image is automatically fetched and set as the user's profile picture - such as with Google Sign In. However, when an image is not found or the provider does not expose the picture, it is possible to set a default user image using the ",(0,t.jsx)(n.code,{children:"UserProfileConfig"})," object."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"  pod.initializeAuthServices(\n    userProfileConfig: UserProfileConfig(\n      // NOTE: The `userImageGenerator` parameter is optional and defaults to\n      // the value below - which generates Gmail-style images. You can change\n      // this parameter to generate any kind of placeholder image. The function\n      // will be called when invoking the `setDefaultUserImage` method.\n      userImageGenerator: defaultUserImageGenerator,\n      onAfterUserProfileCreated:\n          (session, userProfile, {required transaction}) async {\n            await AuthServices.instance.userProfiles.setDefaultUserImage(\n              session,\n              userProfile.authUserId,\n              transaction: transaction,\n            );\n          },\n    ),\n  ...\n  );\n"})}),"\n",(0,t.jsx)(n.h2,{id:"attaching-additional-information",children:"Attaching additional information"}),"\n",(0,t.jsx)(n.p,{children:"The recommended way to attach additional information to an authenticated user is to use a relation in the Database. This makes it easy to query the data later based on the user's authentication identifier."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"class: MyDomainData\ntable: my_domain_data\nfields:\n  ### The [AuthUser] this profile belongs to\n  authUser: module:serverpod_auth_core:AuthUser?, relation(onDelete=Cascade)\n  additionalInfo: String\n\nindexes:\n  auth_user_id_unique_idx:\n    fields: authUserId\n    unique: true\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["Note that the ",(0,t.jsx)(n.code,{children:"AuthUser"})," model is declared in the ",(0,t.jsx)(n.code,{children:"serverpod_auth_core"})," module, which is automatically included in your project as a dependency of the ",(0,t.jsx)(n.code,{children:"serverpod_auth_idp"})," module. If you are not ignoring the generated files in your ",(0,t.jsx)(n.code,{children:"analysis_options.yaml"}),", you might need to explicitly add the ",(0,t.jsx)(n.code,{children:"serverpod_auth_core"})," module to your project to prevent ",(0,t.jsx)(n.code,{children:"depend_on_referenced_packages"})," lint errors. The general recommendation, however, is to ignore linting on generated files:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# analysis_options.yaml\nanalyzer:\n  exclude:\n    - lib/src/generated/**\n"})})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["When referencing module classes in your model files, you can use a nickname for the module instead of the full module name. See the ",(0,t.jsx)(n.a,{href:"../modules",children:"modules documentation"})," for more information."]})}),"\n",(0,t.jsxs)(n.p,{children:["The model above creates a relation to the ",(0,t.jsx)(n.code,{children:"AuthUser"})," table and ensures that each user can only have one ",(0,t.jsx)(n.code,{children:"MyDomainData"})," object. The ",(0,t.jsx)(n.code,{children:"onDelete=Cascade"})," ensures that when the ",(0,t.jsx)(n.code,{children:"AuthUser"})," is deleted, the ",(0,t.jsx)(n.code,{children:"MyDomainData"})," object is also deleted."]}),"\n",(0,t.jsxs)(n.p,{children:["This makes it easy to query the additional information later based on the user's ",(0,t.jsx)(n.code,{children:"authId"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final authUserId = session.authenticated?.authUserId;\nfinal additionalInfo = await MyDomainData.db.findFirstRow(\n    session,\n    where: (t) => t.authUserId.equals(authUserId!),\n);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(96540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);