"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[21670],{50106:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"concepts/scheduling","title":"Scheduling","description":"With Serverpod you can schedule future work with the future call feature. Future calls are calls that will be invoked at a later time. An example is if you want to send a drip-email campaign after a user signs up. You can schedule a future call for a day, a week, or a month. The calls are stored in the database, so they will persist even if the server is restarted.","source":"@site/versioned_docs/version-2.8.0/06-concepts/14-scheduling.md","sourceDirName":"06-concepts","slug":"/concepts/scheduling","permalink":"/concepts/scheduling","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-2.8.0/06-concepts/14-scheduling.md","tags":[],"version":"2.8.0","sidebarPosition":14,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Health checks","permalink":"/concepts/health-checks"},"next":{"title":"Streams","permalink":"/concepts/streams"}}');var a=t(74848),i=t(28453);const s={},l="Scheduling",o={},c=[{value:"Future calls",id:"future-calls",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Enable or disable future call execution",id:"enable-or-disable-future-call-execution",level:3},{value:"Concurrency limit",id:"concurrency-limit",level:3},{value:"Scan interval",id:"scan-interval",level:3}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"scheduling",children:"Scheduling"})}),"\n",(0,a.jsxs)(n.p,{children:["With Serverpod you can schedule future work with the ",(0,a.jsx)(n.code,{children:"future call"})," feature. Future calls are calls that will be invoked at a later time. An example is if you want to send a drip-email campaign after a user signs up. You can schedule a future call for a day, a week, or a month. The calls are stored in the database, so they will persist even if the server is restarted."]}),"\n",(0,a.jsx)(n.p,{children:"A future call is guaranteed to only execute once across all your instances that are running, but execution failures are not handled automatically. It is your responsibility to schedule a new future call if the work was not able to complete."}),"\n",(0,a.jsx)(n.h2,{id:"future-calls",children:"Future calls"}),"\n",(0,a.jsxs)(n.p,{children:["Creating a future call is simple, extend the ",(0,a.jsx)(n.code,{children:"FutureCall"})," class and override the ",(0,a.jsx)(n.code,{children:"invoke"})," method. The method takes two params the first being the ",(0,a.jsx)(n.a,{href:"sessions",children:(0,a.jsx)(n.code,{children:"Session"})})," object and the second being an optional SerializableModel (",(0,a.jsx)(n.a,{href:"models",children:"See models"}),")."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"The future call feature is not enabled when running Serverpod in serverless mode."})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\n\nclass ExampleFutureCall extends FutureCall<MyModelEntity> {\n  @override\n  Future<void> invoke(Session session, MyModelEntity? object) async {\n    // Do something interesting in the future here.\n  }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To let your Server get access to the future call you have to register it in the main run method in your ",(0,a.jsx)(n.code,{children:"server.dart"})," file. You register the future call by calling ",(0,a.jsx)(n.code,{children:"registerFutureCall"})," on the Serverpod object and giving it an instance of the future call together with a string that gives the future call a name. The name has to be globally unique and is used to later invoke the future call."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"void run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  ...\n\n  pod.registerFutureCall(ExampleFutureCall(), 'exampleFutureCall');\n\n  ...\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You are now able to register a future call to be invoked in the future by calling either ",(0,a.jsx)(n.code,{children:"futureCallWithDelay"})," or ",(0,a.jsx)(n.code,{children:"futureCallAtTime"})," depending on your needs."]}),"\n",(0,a.jsxs)(n.p,{children:["Invoke the future call 1 hour from now by calling ",(0,a.jsx)(n.code,{children:"futureCallWithDelay"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await session.serverpod.futureCallWithDelay(\n  'exampleFutureCall',\n  data,\n  const Duration(hours: 1),\n);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Invoke the future call at a specific time and/or date in the future by calling ",(0,a.jsx)(n.code,{children:"futureCallAtTime"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await session.serverpod.futureCallAtTime(\n  'exampleFutureCall',\n  data,\n  DateTime(2025, 1, 1),\n);\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"data"})," is an object created from a class defined in one of your yaml files and has to be the same as the one you expect to receive in the future call. in the ",(0,a.jsx)(n.code,{children:"model"})," folder, ",(0,a.jsx)(n.code,{children:"data"})," may also be null if you don't need it."]})}),"\n",(0,a.jsxs)(n.p,{children:["When registering a future call it is also possible to give it an ",(0,a.jsx)(n.code,{children:"identifier"})," so that it can be referenced later. The same identifier can be applied to multiple future calls."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await session.serverpod.futureCallWithDelay(\n  'exampleFutureCall',\n  data,\n  const Duration(hours: 1),\n  identifier: 'an-identifying-string',\n);\n"})}),"\n",(0,a.jsx)(n.p,{children:"This identifier can then be used to cancel all future calls registered with said identifier."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await session.serverpod.cancelFutureCall('an-identifying-string');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Future calls can be configured using options defined in the configuration files or environment variables. For a detailed list of configuration options, refer to the ",(0,a.jsx)(n.a,{href:"/concepts/configuration",children:"Configuration"})," page."]}),"\n",(0,a.jsx)(n.p,{children:"Below is an example of how you can configure future calls in a YAML file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"futureCallExecutionEnabled: true\n\nfutureCall:\n  concurrencyLimit: 5\n  scanInterval: 2000\n"})}),"\n",(0,a.jsx)(n.h3,{id:"enable-or-disable-future-call-execution",children:"Enable or disable future call execution"}),"\n",(0,a.jsxs)(n.p,{children:["This option allows you to enable or disable the execution of future calls. By default, it is set to ",(0,a.jsx)(n.code,{children:"true"}),". You might want to disable future call execution in environments where you don't want background tasks to run, such as during testing or in a staging environment where you want to focus on API behavior without triggering scheduled tasks."]}),"\n",(0,a.jsx)(n.p,{children:"Example configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"futureCallExecutionEnabled: false\n"})}),"\n",(0,a.jsx)(n.h3,{id:"concurrency-limit",children:"Concurrency limit"}),"\n",(0,a.jsxs)(n.p,{children:["This option sets the maximum number of future calls that can run concurrently. By default, it is set to ",(0,a.jsx)(n.code,{children:"1"}),". Configuring this is useful if you have resource-intensive tasks and want to avoid overloading your server. For example, in a production environment, you might want to tune this value to ensure that not all of the server's resources are allocated to future calls, leaving room for other critical tasks."]}),"\n",(0,a.jsxs)(n.p,{children:["Setting this value to a negative number or ",(0,a.jsx)(n.code,{children:"null"})," removes the limitation, allowing an unlimited number of concurrent future calls. However, this should be used with caution as it can lead to resource exhaustion."]}),"\n",(0,a.jsx)(n.p,{children:"Example configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"futureCall:\n  concurrencyLimit: 5  # Adjust this value based on your server's capacity\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scan-interval",children:"Scan interval"}),"\n",(0,a.jsxs)(n.p,{children:["This option determines how often the system scans for future calls to execute, in milliseconds. The default value is ",(0,a.jsx)(n.code,{children:"5000"})," (5 seconds). Adjusting this interval can help balance responsiveness and resource usage. For example, reducing the interval can make future calls execute closer to their scheduled time, while increasing it can reduce database load in environments with limited resources."]}),"\n",(0,a.jsx)(n.p,{children:"Example configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"futureCall:\n  scanInterval: 2000  # Adjust this value based on your server's responsiveness needs\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);