"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[63655],{73960(e,n,a){a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"concepts/authentication/providers/email/admin-operations","title":"Admin Operations","description":"The email identity provider provides admin operations through EmailIdpAdmin for managing email accounts and cleaning up expired or dangling requests. These operations are useful for administrative tasks, maintenance, and preventing database bloat.","source":"@site/versioned_docs/version-3.1.0/06-concepts/11-authentication/04-providers/01-email/04-admin-operations.md","sourceDirName":"06-concepts/11-authentication/04-providers/01-email","slug":"/concepts/authentication/providers/email/admin-operations","permalink":"/3.1.0/concepts/authentication/providers/email/admin-operations","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.1.0/06-concepts/11-authentication/04-providers/01-email/04-admin-operations.md","tags":[],"version":"3.1.0","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Customizing the UI","permalink":"/3.1.0/concepts/authentication/providers/email/customizing-the-ui"},"next":{"title":"Setup","permalink":"/3.1.0/concepts/authentication/providers/google/setup"}}');var i=a(74848),s=a(28453);const r={},o="Admin Operations",d={},c=[{value:"Accessing the <code>EmailIdpAdmin</code>",id:"accessing-the-emailidpadmin",level:2},{value:"Account Management",id:"account-management",level:2},{value:"Finding Accounts",id:"finding-accounts",level:3},{value:"Creating Accounts",id:"creating-accounts",level:3},{value:"Deleting Accounts",id:"deleting-accounts",level:3},{value:"Setting Passwords",id:"setting-passwords",level:3},{value:"Finding Active Account Requests",id:"finding-active-account-requests",level:2},{value:"Cleanup Operations",id:"cleanup-operations",level:2},{value:"Cleaning Up Expired Account Requests",id:"cleaning-up-expired-account-requests",level:3},{value:"Cleaning Up Expired Password Reset Requests",id:"cleaning-up-expired-password-reset-requests",level:3},{value:"Cleaning Up Failed Login Attempts",id:"cleaning-up-failed-login-attempts",level:3}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"admin-operations",children:"Admin Operations"})}),"\n",(0,i.jsxs)(n.p,{children:["The email identity provider provides admin operations through ",(0,i.jsx)(n.code,{children:"EmailIdpAdmin"})," for managing email accounts and cleaning up expired or dangling requests. These operations are useful for administrative tasks, maintenance, and preventing database bloat."]}),"\n",(0,i.jsxs)(n.h2,{id:"accessing-the-emailidpadmin",children:["Accessing the ",(0,i.jsx)(n.code,{children:"EmailIdpAdmin"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can access the admin operations through the ",(0,i.jsx)(n.code,{children:"AuthServices.instance.emailIdp"})," property:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_server/providers/email.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\n\n// Get the EmailIdp instance\nfinal emailIdp = AuthServices.instance.emailIdp;\n\n// Access admin operations\nfinal admin = emailIdp.admin;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"account-management",children:"Account Management"}),"\n",(0,i.jsx)(n.p,{children:"The admin API provides methods for managing email accounts:"}),"\n",(0,i.jsx)(n.h3,{id:"finding-accounts",children:"Finding Accounts"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Find an account by email\nfinal account = await admin.findAccount(\n  session,\n  email: 'user@example.com',\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-accounts",children:"Creating Accounts"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Create an email authentication account\nfinal emailAccountId = await admin.createEmailAuthentication(\n  session,\n  authUserId: userId,\n  email: 'user@example.com',\n  password: 'securePassword123',\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"deleting-accounts",children:"Deleting Accounts"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Delete an account by email\nawait admin.deleteEmailAccount(\n  session,\n  email: 'user@example.com',\n);\n\n// Delete all email accounts for a user\nawait admin.deleteEmailAccountByAuthUserId(\n  session,\n  authUserId: userId,\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"setting-passwords",children:"Setting Passwords"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Set or update a password for an account\nawait admin.setPassword(\n  session,\n  email: 'user@example.com',\n  password: 'newSecurePassword123',\n);\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"setPassword"})," method does not validate the password against the configured password policy. Make sure to validate the password before calling this method if needed."]})}),"\n",(0,i.jsx)(n.h2,{id:"finding-active-account-requests",children:"Finding Active Account Requests"}),"\n",(0,i.jsx)(n.p,{children:"You can also check for active account requests:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final accountRequest = await admin.findActiveEmailAccountRequest(\n  session,\n  accountRequestId: requestId,\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:"This is useful for checking the status of a registration request or verifying if a request is still valid."}),"\n",(0,i.jsx)(n.h2,{id:"cleanup-operations",children:"Cleanup Operations"}),"\n",(0,i.jsx)(n.p,{children:"Over time, expired account requests, password reset requests, and failed login attempts can accumulate in the database, leading to database bloat and potential performance issues. It's important to periodically clean these up to prevent database bloat. Such requests are not automatically cleaned up since they can be useful for auditing purposes, so it is up to each application to decide when to clean them up."}),"\n",(0,i.jsx)(n.h3,{id:"cleaning-up-expired-account-requests",children:"Cleaning Up Expired Account Requests"}),"\n",(0,i.jsx)(n.p,{children:"Account requests that have expired (users who started registration but never completed it) should be cleaned up:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Delete all expired account requests\nawait admin.deleteExpiredAccountRequests(session);\n\n// Delete a specific account request\nawait admin.deleteEmailAccountRequestById(\n  session,\n  accountRequestId: requestId,\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cleaning-up-expired-password-reset-requests",children:"Cleaning Up Expired Password Reset Requests"}),"\n",(0,i.jsx)(n.p,{children:"Password reset requests that have expired (users who requested a password reset but never completed it) should be cleaned up:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Delete all expired password reset requests\nawait admin.deleteExpiredPasswordResetRequests(session);\n\n// Delete password reset request attempts for a specific email\n// Useful when you want to allow a user to request a new password\n// even though they have hit the rate limit\nawait admin.deletePasswordResetRequestsAttemptsForEmail(\n  session,\n  email: 'user@example.com',\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cleaning-up-failed-login-attempts",children:"Cleaning Up Failed Login Attempts"}),"\n",(0,i.jsx)(n.p,{children:"Failed login attempts are tracked for rate limiting should also be cleaned up when no longer useful for auditing purposes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Delete all failed login attempts\nawait admin.deleteFailedLoginAttempts(session);\n\n// Delete failed login attempts older than a specific duration\nawait admin.deleteFailedLoginAttempts(\n  session,\n  olderThan: Duration(days: 30),\n);\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453(e,n,a){a.d(n,{R:()=>r,x:()=>o});var t=a(96540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);