"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[42901],{51161:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"concepts/logging","title":"Logging","description":"Serverpod uses the database for storing logs; this makes it easy to search for errors, slow queries, or debug messages. To log custom messages during the execution of a session, use the log method of the session object. When the session is closed, either from successful execution or by failing from throwing an exception, the messages are written to the log. By default, session log entries are written for every completed session.","source":"@site/docs/06-concepts/09-logging.md","sourceDirName":"06-concepts","slug":"/concepts/logging","permalink":"/next/concepts/logging","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/docs/06-concepts/09-logging.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Caching","permalink":"/next/concepts/caching"},"next":{"title":"Modules","permalink":"/next/concepts/modules"}}');var i=s(74848),t=s(28453);const r={},l="Logging",a={},d=[{value:"Controlling Session Logs with Environment Variables or Configuration Files",id:"controlling-session-logs-with-environment-variables-or-configuration-files",level:3},{value:"Environment Variables",id:"environment-variables",level:4},{value:"Configuration File Example",id:"configuration-file-example",level:4},{value:"Default Behavior for Session Logs",id:"default-behavior-for-session-logs",level:3},{value:"Log retention and automated purging",id:"log-retention-and-automated-purging",level:4},{value:"Defaults values",id:"defaults-values",level:5},{value:"Customizing retention policies",id:"customizing-retention-policies",level:5}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"logging",children:"Logging"})}),"\n",(0,i.jsxs)(n.p,{children:["Serverpod uses the database for storing logs; this makes it easy to search for errors, slow queries, or debug messages. To log custom messages during the execution of a session, use the ",(0,i.jsx)(n.code,{children:"log"})," method of the ",(0,i.jsx)(n.code,{children:"session"})," object. When the session is closed, either from successful execution or by failing from throwing an exception, the messages are written to the log. By default, session log entries are written for every completed session."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"session.log('This is working well');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also pass exceptions and stack traces to the ",(0,i.jsx)(n.code,{children:"log"})," method or set the logging level."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"session.log(\n  'Oops, something went wrong',\n  level: LogLevel.warning,\n  exception: e,\n  stackTrace: stackTrace,\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Log entries are stored in the following tables of the database: ",(0,i.jsx)(n.code,{children:"serverpod_log"})," for text messages, ",(0,i.jsx)(n.code,{children:"serverpod_query_log"})," for queries, and ",(0,i.jsx)(n.code,{children:"serverpod_session_log"})," for completed sessions. Optionally, it's possible to pass a log level with the message to filter out messages depending on the server's runtime settings."]}),"\n",(0,i.jsx)(n.h3,{id:"controlling-session-logs-with-environment-variables-or-configuration-files",children:"Controlling Session Logs with Environment Variables or Configuration Files"}),"\n",(0,i.jsxs)(n.p,{children:["You can control whether session logs are written to the database, the console, both, or neither, using environment variables or configuration files. ",(0,i.jsx)(n.strong,{children:"Environment variables take priority"})," over configuration file settings if both are provided."]}),"\n",(0,i.jsxs)(n.p,{children:["For the default values when environment variables are not set, see the ",(0,i.jsx)(n.a,{href:"#default-behavior-for-session-logs",children:"default behavior for session logs"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_PERSISTENT_LOG_ENABLED"}),": Controls whether session logs are written to the database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_LOG_CLEANUP_INTERVAL"}),": How often to run the log cleanup job (duration string, e.g. ",(0,i.jsx)(n.code,{children:"6h"}),", ",(0,i.jsx)(n.code,{children:"24h"}),"). Set to empty to disable automated purging."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_LOG_RETENTION_PERIOD"}),": How long to keep session log entries (duration string, e.g. ",(0,i.jsx)(n.code,{children:"30d"}),", ",(0,i.jsx)(n.code,{children:"6h"}),"). Set to empty or omit to use the default (90 days)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_LOG_RETENTION_COUNT"}),": Maximum number of session log entries to keep. Set to empty or omit to use the default (100,000)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_CONSOLE_LOG_ENABLED"}),": Controls whether session logs are output to the console."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVERPOD_SESSION_CONSOLE_LOG_FORMAT"}),": The format for console logging (",(0,i.jsx)(n.code,{children:"text"})," or ",(0,i.jsx)(n.code,{children:"json"}),"). See ",(0,i.jsx)(n.a,{href:"./configuration",children:"configuration"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"configuration-file-example",children:"Configuration File Example"}),"\n",(0,i.jsx)(n.p,{children:"You can also configure logging behavior directly in the configuration file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sessionLogs:\n  persistentEnabled: true   # Logs are stored in the database\n  cleanupInterval: 6h       # Run cleanup every 6 hours\n  retentionPeriod: 30d      # Keep entries for 30 days\n  retentionCount: 5000      # Keep at most 5,000 entries\n  consoleEnabled: true      # Logs are output to the console\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Duration strings for the cleanup interval and retention period use the same format as in ",(0,i.jsx)(n.a,{href:"./models#duration",children:"models"}),": e.g. ",(0,i.jsx)(n.code,{children:"30d"}),", ",(0,i.jsx)(n.code,{children:"6h"}),", ",(0,i.jsx)(n.code,{children:"1d 2h 30min"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"default-behavior-for-session-logs",children:"Default Behavior for Session Logs"}),"\n",(0,i.jsx)(n.p,{children:"By default, session logging behavior depends on whether the project has database support:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When a database is present"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"persistentEnabled"})," is set to ",(0,i.jsx)(n.code,{children:"true"}),", meaning logs are stored in the database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"consoleEnabled"})," is set to ",(0,i.jsx)(n.code,{children:"false"})," by default, meaning logs are not printed to the console unless explicitly enabled."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When no database is present"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"persistentEnabled"})," is set to ",(0,i.jsx)(n.code,{children:"false"})," since persistent logging requires a database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"consoleEnabled"})," is set to ",(0,i.jsx)(n.code,{children:"true"}),", meaning logs are printed to the console by default."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"persistentEnabled"})," is set to ",(0,i.jsx)(n.code,{children:"true"})," but ",(0,i.jsx)(n.strong,{children:"no database is configured"}),", a ",(0,i.jsx)(n.code,{children:"StateError"})," will be thrown. Persistent logging requires database support, and Serverpod ensures that misconfigurations are caught early by raising this error."]})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["You can use the companion app  ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"../tools/insights",children:"Serverpod Insights"})})," to read, search, and configure the logs."]})}),"\n",(0,i.jsx)(n.h4,{id:"log-retention-and-automated-purging",children:"Log retention and automated purging"}),"\n",(0,i.jsx)(n.p,{children:"Since log entries are stored in the database when persistent logging is enabled, the logs table can grow without bound if not purged. Serverpod can automatically purge logs based on configurable retention policies to prevent unchecked storage growth."}),"\n",(0,i.jsx)(n.h5,{id:"defaults-values",children:"Defaults values"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleanup interval"}),": 24 hours \u2014 the cleanup job runs once per day."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retention period"}),": 90 days \u2014 removes entries older than this."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retention count"}),": 100,000 entries \u2014 removes entries that exceed this count."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If both time-based (retention period) and count-based (retention count) limits are set, entries are removed if they are either too old or beyond the maximum count, whichever is reached first."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Automatic cleanup is only available when persistent logging is enabled and the cleanup interval is configured."})}),"\n",(0,i.jsx)(n.h5,{id:"customizing-retention-policies",children:"Customizing retention policies"}),"\n",(0,i.jsxs)(n.p,{children:["All three settings are optional and can be set to ",(0,i.jsx)(n.code,{children:"null"})," to disable the respective policy. If the ",(0,i.jsx)(n.code,{children:"cleanupInterval"})," is set to ",(0,i.jsx)(n.code,{children:"null"}),", no purging will run regardless of the other settings, and log tables can grow without bound until you run cleanup manually or re-enable the interval."]}),"\n",(0,i.jsxs)(n.p,{children:["Configure retention and cleanup via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"})," or the ",(0,i.jsx)(n.a,{href:"#configuration-file-example",children:"configuration file"}),". For example, to keep 30 days and at most 5,000 entries, with cleanup every 6 hours:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sessionLogs:\n  persistentEnabled: true\n  cleanupInterval: 6h\n  retentionPeriod: 30d\n  retentionCount: 5000\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var o=s(96540);const i={},t=o.createContext(i);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);