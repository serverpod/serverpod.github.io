"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[12228],{50094(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"concepts/webserver/flutter-web","title":"Flutter web apps","description":"Serverpod can serve your Flutter web application directly, allowing you to host both your API and web frontend from the same server. FlutterRoute handles the specifics of serving Flutter web apps, including WASM multi-threading headers and SPA-style routing.","source":"@site/versioned_docs/version-3.1.0/06-concepts/18-webserver/09-flutter-web.md","sourceDirName":"06-concepts/18-webserver","slug":"/concepts/webserver/flutter-web","permalink":"/3.1.0/concepts/webserver/flutter-web","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.1.0/06-concepts/18-webserver/09-flutter-web.md","tags":[],"version":"3.1.0","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Single page apps","permalink":"/3.1.0/concepts/webserver/single-page-apps"},"next":{"title":"Get started","permalink":"/3.1.0/concepts/testing/get-started"}}');var s=n(74848),i=n(28453);const l={},a="Flutter web apps",c={},o=[{value:"Basic setup",id:"basic-setup",level:2},{value:"Building Flutter for web",id:"building-flutter-for-web",level:2},{value:"Project structure",id:"project-structure",level:2},{value:"WASM multi-threading",id:"wasm-multi-threading",level:2},{value:"Using WasmHeadersMiddleware directly",id:"using-wasmheadersmiddleware-directly",level:3},{value:"Cache control",id:"cache-control",level:2},{value:"Default caching behavior",id:"default-caching-behavior",level:3},{value:"Invalidating cached assets",id:"invalidating-cached-assets",level:3},{value:"Custom cache control",id:"custom-cache-control",level:3},{value:"Cache busting",id:"cache-busting",level:2},{value:"Complete example",id:"complete-example",level:2}];function d(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"flutter-web-apps",children:"Flutter web apps"})}),"\n",(0,s.jsxs)(r.p,{children:["Serverpod can serve your Flutter web application directly, allowing you to host both your API and web frontend from the same server. ",(0,s.jsx)(r.code,{children:"FlutterRoute"})," handles the specifics of serving Flutter web apps, including WASM multi-threading headers and SPA-style routing."]}),"\n",(0,s.jsx)(r.h2,{id:"basic-setup",children:"Basic setup"}),"\n",(0,s.jsxs)(r.p,{children:["Use ",(0,s.jsx)(r.code,{children:"FlutterRoute"})," to serve your Flutter web build:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  FlutterRoute(Directory('web/app')),\n);\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"info",children:(0,s.jsxs)(r.p,{children:["The route path defaults to ",(0,s.jsx)(r.code,{children:"'/'"})," (root). See ",(0,s.jsx)(r.a,{href:"single-page-apps#serving-from-a-sub-path",children:"Serving from a sub-path"})," to mount the app at a different location."]})}),"\n",(0,s.jsx)(r.p,{children:"This configuration:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Serves all static files from the Flutter build"}),"\n",(0,s.jsxs)(r.li,{children:["Falls back to ",(0,s.jsx)(r.code,{children:"index.html"})," for client-side routing"]}),"\n",(0,s.jsx)(r.li,{children:"Adds WASM multi-threading headers automatically"}),"\n",(0,s.jsx)(r.li,{children:"Applies smart caching: critical files are never cached, other files are cached for 1 day"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"building-flutter-for-web",children:"Building Flutter for web"}),"\n",(0,s.jsx)(r.p,{children:"Build your Flutter app for web with WASM support for improved performance and multi-threading:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"cd my_project_flutter\nflutter build web --wasm\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"info",children:(0,s.jsx)(r.p,{children:"WASM builds automatically fall back to JavaScript in browsers that don't support WebAssembly Garbage Collection (WasmGC). Your app works everywhere while taking advantage of WASM performance where available."})}),"\n",(0,s.jsx)(r.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,s.jsxs)(r.p,{children:["Copy your Flutter build output to the server's ",(0,s.jsx)(r.code,{children:"web"})," directory:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-text",children:"my_project/\n\u251c\u2500\u2500 my_project_server/\n\u2502   \u251c\u2500\u2500 lib/\n\u2502   \u2502   \u2514\u2500\u2500 server.dart\n\u2502   \u2514\u2500\u2500 web/\n\u2502       \u2514\u2500\u2500 app/              # Flutter web build output\n\u2502           \u251c\u2500\u2500 index.html\n\u2502           \u251c\u2500\u2500 main.dart.js\n\u2502           \u251c\u2500\u2500 flutter.js\n\u2502           \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 my_project_flutter/\n\u2502   \u2514\u2500\u2500 build/\n\u2502       \u2514\u2500\u2500 web/              # Flutter build output (source)\n\u2514\u2500\u2500 my_project_client/\n"})}),"\n",(0,s.jsx)(r.h2,{id:"wasm-multi-threading",children:"WASM multi-threading"}),"\n",(0,s.jsxs)(r.p,{children:["Flutter WASM builds can use multi-threaded rendering for improved performance. This requires ",(0,s.jsx)(r.code,{children:"SharedArrayBuffer"}),", which browsers only enable with specific security headers."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"FlutterRoute"})," automatically adds these headers:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"Cross-Origin-Opener-Policy: same-origin"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"Cross-Origin-Embedder-Policy: require-corp"})}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"using-wasmheadersmiddleware-directly",children:"Using WasmHeadersMiddleware directly"}),"\n",(0,s.jsxs)(r.p,{children:["If you're using ",(0,s.jsx)(r.code,{children:"SpaRoute"})," or custom routes instead of ",(0,s.jsx)(r.code,{children:"FlutterRoute"}),", add the headers manually with ",(0,s.jsx)(r.code,{children:"WasmHeadersMiddleware"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-dart",children:"pod.webServer.addMiddleware(const WasmHeadersMiddleware());\n\npod.webServer.addRoute(\n  SpaRoute(\n    Directory('web/app'),\n    fallback: File('web/app/index.html'),\n  ),\n  '/',\n);\n"})}),"\n",(0,s.jsx)(r.h2,{id:"cache-control",children:"Cache control"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"FlutterRoute"})," automatically applies smart caching to prevent issues with stale app versions:"]}),"\n",(0,s.jsx)(r.h3,{id:"default-caching-behavior",children:"Default caching behavior"}),"\n",(0,s.jsxs)(r.p,{children:["By default, ",(0,s.jsx)(r.code,{children:"FlutterRoute"})," uses different cache strategies for different file types:"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Critical files (never cached):"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"index.html"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"flutter_service_worker.js"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"flutter_bootstrap.js"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"manifest.json"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"version.json"})}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["These files are served with ",(0,s.jsx)(r.code,{children:"Cache-Control: private, no-cache, no-store"})," headers to ensure users always get the latest version after deployments."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"All other files (cached for 1 day):"})}),"\n",(0,s.jsxs)(r.p,{children:["Static assets like JavaScript, WASM, images, and fonts are served with ",(0,s.jsx)(r.code,{children:"Cache-Control: public, max-age=86400"})," headers, allowing browsers to cache them for better performance."]}),"\n",(0,s.jsx)(r.h3,{id:"invalidating-cached-assets",children:"Invalidating cached assets"}),"\n",(0,s.jsx)(r.p,{children:"When you deploy a new version of your Flutter app, cached assets need to be invalidated to ensure users get the latest version. To do this:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Update the version in your Flutter app's ",(0,s.jsx)(r.code,{children:"pubspec.yaml"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yaml",children:"version: 1.0.1+2  # Increment from previous version\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Rebuild your Flutter web app:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"flutter build web --wasm\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Deploy the new build to your server"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Flutter's build process includes the version in asset paths and metadata, which causes browsers to fetch the new assets instead of using cached versions."}),"\n",(0,s.jsx)(r.h3,{id:"custom-cache-control",children:"Custom cache control"}),"\n",(0,s.jsxs)(r.p,{children:["Override the default behavior using ",(0,s.jsx)(r.code,{children:"cacheControlFactory"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  FlutterRoute(\n    Directory('web/app'),\n    cacheControlFactory: StaticRoute.publicImmutable(\n      maxAge: const Duration(hours: 1),\n    ),\n  ),\n);\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"warning",children:(0,s.jsxs)(r.p,{children:["Custom cache control applies to all files served from the directory, except for the fallback ",(0,s.jsx)(r.code,{children:"index.html"})," which is always served with no-cache headers. Make sure your strategy prevents caching of service workers and manifests to avoid serving stale app versions."]})}),"\n",(0,s.jsxs)(r.p,{children:["See ",(0,s.jsx)(r.a,{href:"static-files#cache-control",children:"Static Files"})," for more on cache control."]}),"\n",(0,s.jsx)(r.h2,{id:"cache-busting",children:"Cache busting"}),"\n",(0,s.jsx)(r.p,{children:"Enable cache-busted URLs:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-dart",children:"final webDir = Directory('web/app');\n\nfinal cacheBustingConfig = CacheBustingConfig(\n  mountPrefix: '/',\n  fileSystemRoot: webDir,\n);\n\npod.webServer.addRoute(\n  FlutterRoute(\n    webDir,\n    cacheBustingConfig: cacheBustingConfig,\n    cacheControlFactory: StaticRoute.publicImmutable(\n      maxAge: const Duration(minutes: 5),\n    ),\n  ),\n);\n"})}),"\n",(0,s.jsxs)(r.p,{children:["See ",(0,s.jsx)(r.a,{href:"static-files#static-file-cache-busting",children:"Static Files"})," for more on cache busting."]}),"\n",(0,s.jsx)(r.h2,{id:"complete-example",children:"Complete example"}),"\n",(0,s.jsxs)(r.p,{children:["Here's a complete ",(0,s.jsx)(r.code,{children:"server.dart"})," serving a Flutter web app:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-dart",children:"import 'dart:io';\n\nimport 'package:serverpod/serverpod.dart';\n\nimport 'src/generated/protocol.dart';\nimport 'src/generated/endpoints.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(args, Protocol(), Endpoints());\n\n  final flutterAppDir = Directory('web/app');\n\n  if (!flutterAppDir.existsSync()) {\n    print('Warning: Flutter web app not found at ${flutterAppDir.path}');\n    print('Build your Flutter app and copy it to web/app/');\n  } else {\n    pod.webServer.addRoute(FlutterRoute(flutterAppDir));\n  }\n\n  await pod.start();\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["With this configuration, your Flutter web app is served at the root URL of your web server (typically ",(0,s.jsx)(r.code,{children:"http://localhost:8082"})," in development)."]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,r,n){n.d(r,{R:()=>l,x:()=>a});var t=n(96540);const s={},i=t.createContext(s);function l(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);