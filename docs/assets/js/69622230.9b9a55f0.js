"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[92725],{33129(e,n,i){i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>g,frontMatter:()=>l,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"concepts/authentication/providers/google/configuration","title":"Configuration","description":"This page covers configuration options for the Google identity provider beyond the basic setup.","source":"@site/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/02-google/02-configuration.md","sourceDirName":"06-concepts/11-authentication/04-providers/02-google","slug":"/concepts/authentication/providers/google/configuration","permalink":"/3.0.0/concepts/authentication/providers/google/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.0.0/06-concepts/11-authentication/04-providers/02-google/02-configuration.md","tags":[],"version":"3.0.0","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Setup","permalink":"/3.0.0/concepts/authentication/providers/google/setup"},"next":{"title":"Customizing the UI","permalink":"/3.0.0/concepts/authentication/providers/google/customizing-the-ui"}}');var t=i(74848),s=i(28453);const l={},a="Configuration",r={},c=[{value:"Configuration options",id:"configuration-options",level:2},{value:"Loading Google Client Secret",id:"loading-google-client-secret",level:3},{value:"Custom Account Validation",id:"custom-account-validation",level:3},{value:"Accessing Google APIs",id:"accessing-google-apis",level:3},{value:"Accessing Google APIs on the Server",id:"accessing-google-apis-on-the-server",level:3},{value:"Lightweight Sign-In on the Flutter app",id:"lightweight-sign-in-on-the-flutter-app",level:3},{value:"Configuring Client IDs on the App",id:"configuring-client-ids-on-the-app",level:3},{value:"Passing Client IDs in Code",id:"passing-client-ids-in-code",level:4},{value:"Using Environment Variables",id:"using-environment-variables",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,t.jsx)(n.p,{children:"This page covers configuration options for the Google identity provider beyond the basic setup."}),"\n",(0,t.jsx)(n.h2,{id:"configuration-options",children:"Configuration options"}),"\n",(0,t.jsxs)(n.p,{children:["Below is a non-exhaustive list of some of the most common configuration options. For more details on all options, check the ",(0,t.jsx)(n.code,{children:"GoogleIdpConfig"})," in-code documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"loading-google-client-secret",children:"Loading Google Client Secret"}),"\n",(0,t.jsx)(n.p,{children:"You can load the Google client secret in several ways:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"From JSON string (recommended for production):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final googleIdpConfig = GoogleIdpConfig(\n  clientSecret: GoogleClientSecret.fromJsonString(\n    pod.getPassword('googleClientSecret')!,\n  ),\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"From JSON file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final googleIdpConfig = GoogleIdpConfig(\n  clientSecret: GoogleClientSecret.fromJsonFile(\n    File('config/google_client_secret.json'),\n  ),\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"From JSON map:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final googleIdpConfig = GoogleIdpConfig(\n  clientSecret: GoogleClientSecret.fromJson({\n    'web': {\n      'client_id': 'your-client-id.apps.googleusercontent.com',\n      'client_secret': 'your-client-secret',\n      'redirect_uris': [\n        'http://localhost:8080/auth/google/callback',\n      ],\n    },\n  }),\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"custom-account-validation",children:"Custom Account Validation"}),"\n",(0,t.jsxs)(n.p,{children:["You can customize the validation for Google account details before allowing sign-in. By default, the validation checks that the received account details contains ",(0,t.jsx)(n.code,{children:"name"}),", ",(0,t.jsx)(n.code,{children:"fullName"}),", and ",(0,t.jsx)(n.code,{children:"verifiedEmail"})," set to true."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final googleIdpConfig = GoogleIdpConfigFromPasswords(\n  // Optional: Custom validation for Google account details\n  googleAccountDetailsValidation: (accountDetails) {\n    // Throw an exception if account doesn't meet custom requirements\n    if (accountDetails.verifiedEmail != true ||\n        !accountDetails.email!.endsWith('@example.com')) {\n      throw GoogleUserInfoMissingDataException();\n    }\n  },\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"accessing-google-apis",children:"Accessing Google APIs"}),"\n",(0,t.jsx)(n.p,{children:"The default setup allows access to basic user information, such as email, profile image, and name. You may require additional access scopes, such as accessing a user's calendar, contacts, or files. To do this, you will need to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add the required scopes to the ",(0,t.jsx)(n.a,{href:"./setup#configure-google-auth-platform",children:"Data Access"})," page in the Google Auth Platform."]}),"\n",(0,t.jsxs)(n.li,{children:["Request access to the scopes when signing in. Do this by setting the ",(0,t.jsx)(n.code,{children:"scopes"})," parameter of the ",(0,t.jsx)(n.code,{children:"GoogleSignInWidget"})," or ",(0,t.jsx)(n.code,{children:"GoogleAuthController"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["A full list of available scopes can be found ",(0,t.jsx)(n.a,{href:"https://developers.google.com/identity/protocols/oauth2/scopes",children:"here"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Adding additional scopes may require approval by Google. On the OAuth consent screen, you can see which of your scopes are considered sensitive."})}),"\n",(0,t.jsx)(n.h3,{id:"accessing-google-apis-on-the-server",children:"Accessing Google APIs on the Server"}),"\n",(0,t.jsxs)(n.p,{children:["On the server side, you can access Google APIs using the access token. The ",(0,t.jsx)(n.code,{children:"getExtraGoogleInfoCallback"})," in ",(0,t.jsx)(n.code,{children:"GoogleIdpConfig"})," receives the access token and can be used to call Google APIs:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"import 'package:http/http.dart' as http;\n\nfinal googleIdpConfig = GoogleIdpConfigFromPasswords(\n  // Optional: Extract additional info from Google APIs\n  getExtraGoogleInfoCallback: (session, {\n    required accountDetails,\n    required accessToken,\n    required transaction,\n  }) async {\n    // Use accessToken to call Google APIs and store additional info\n    // Example: Access YouTube API\n    final response = await http.get(\n      Uri.https('www.googleapis.com', '/youtube/v3/channels?part=snippet&mine=true'),\n      headers: {'Authorization': 'Bearer $accessToken'},\n    );\n    // Process response and store additional info in the database\n  },\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"lightweight-sign-in-on-the-flutter-app",children:"Lightweight Sign-In on the Flutter app"}),"\n",(0,t.jsxs)(n.p,{children:["Lightweight sign-in is a feature that attempts to authenticate users previously logged in with Google automatically with minimal or no user interaction. When enabled, the Google authentication controller will try to sign in users seamlessly using platform-specific lightweight authentication methods. This feature is enabled by default, but can be disabled from the ",(0,t.jsx)(n.code,{children:"GoogleSignInWidget"})," or ",(0,t.jsx)(n.code,{children:"GoogleAuthController"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"GoogleSignInWidget(\n  client: client,\n  attemptLightweightSignIn: false, // Disable lightweight sign-in\n  onAuthenticated: () {\n    // User was automatically signed in\n  },\n)\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"If lightweight sign-in fails (e.g., no previous session exists or the user dismisses the prompt), the user can still use the regular sign-in button to authenticate manually."})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"The lightweight sign-in attempt happens automatically when the controller is initialized, typically at app launch. If successful, users will be signed in without any additional interaction."})}),"\n",(0,t.jsx)(n.h3,{id:"configuring-client-ids-on-the-app",children:"Configuring Client IDs on the App"}),"\n",(0,t.jsxs)(n.p,{children:["If no client IDs are provided programmatically, the underlying ",(0,t.jsx)(n.code,{children:"google_sign_in"})," package falls back to reading from platform-specific configuration files (e.g., ",(0,t.jsx)(n.code,{children:"GoogleService-Info.plist"})," for iOS, ",(0,t.jsx)(n.code,{children:"google-services.json"})," for Android). To set them programmatically, you can use the following methods."]}),"\n",(0,t.jsx)(n.h4,{id:"passing-client-ids-in-code",children:"Passing Client IDs in Code"}),"\n",(0,t.jsx)(n.p,{children:"You can pass the client IDs directly when initializing the Google Sign-In service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"client.auth.initializeGoogleSignIn(\n  clientId: '<platform_client_id>.apps.googleusercontent.com',\n  serverClientId: '<web_client_id>.apps.googleusercontent.com',\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:"This approach is useful when you need different client IDs per platform and want to manage them in your Dart code."}),"\n",(0,t.jsx)(n.h4,{id:"using-environment-variables",children:"Using Environment Variables"}),"\n",(0,t.jsxs)(n.p,{children:["Alternatively, you can pass client IDs during build time using the ",(0,t.jsx)(n.code,{children:"--dart-define"})," option. The Google Sign-In provider supports the following environment variables:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"GOOGLE_CLIENT_ID"}),": The platform-specific OAuth client ID"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"GOOGLE_SERVER_CLIENT_ID"}),": The server (web application) OAuth client ID"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"clientId"})," and ",(0,t.jsx)(n.code,{children:"serverClientId"})," values are not supplied when initializing the service, the provider will automatically fetch them from these environment variables."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example usage:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'flutter run \\\n  -d "<device>" \\\n  --dart-define="GOOGLE_CLIENT_ID=<platform_client_id>.apps.googleusercontent.com" \\\n  --dart-define="GOOGLE_SERVER_CLIENT_ID=<web_client_id>.apps.googleusercontent.com"\n'})}),"\n",(0,t.jsx)(n.p,{children:"This approach is useful when you need to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Manage separate client IDs for different platforms (Android, iOS, Web) in a centralized way"}),"\n",(0,t.jsx)(n.li,{children:"Avoid committing client IDs to version control"}),"\n",(0,t.jsx)(n.li,{children:"Configure different credentials for different build environments (development, staging, production)"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"You can also set these environment variables in your IDE's run configuration or CI/CD pipeline to avoid passing them manually each time."})})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var o=i(96540);const t={},s=o.createContext(t);function l(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);