"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[67647],{43207(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"get-started/models-and-data","title":"Models and data","description":"Serverpod ships with a powerful data modeling system that uses easy-to-read definition files in YAML. It generates Dart classes with all the necessary code to serialize and deserialize the data and connect to the database. This allows you to define your data models for the server and the app in one place, eliminating any inconsistencies. The models give you fine-grained control over the visibility of properties and how they interact with each other.","source":"@site/docs/01-get-started/02-models-and-data.md","sourceDirName":"01-get-started","slug":"/get-started/models-and-data","permalink":"/next/get-started/models-and-data","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/docs/01-get-started/02-models-and-data.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"2\ufe0f\u20e3 Models and data"},"sidebar":"tutorialSidebar","previous":{"title":"1\ufe0f\u20e3 Creating endpoint methods","permalink":"/next/get-started/creating-endpoints"},"next":{"title":"3\ufe0f\u20e3 Working with the database","permalink":"/next/get-started/working-with-the-database"}}');var i=t(74848),s=t(28453);const a={sidebar_label:"2\ufe0f\u20e3 Models and data"},o="Models and data",l={},d=[{value:"Create a new model",id:"create-a-new-model",level:2},{value:"Generate the code",id:"generate-the-code",level:2},{value:"Use the model in the server",id:"use-the-model-in-the-server",level:2},{value:"Use the model in the app",id:"use-the-model-in-the-app",level:2},{value:"Run the app",id:"run-the-app",level:2},{value:"Next steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"models-and-data",children:"Models and data"})}),"\n",(0,i.jsx)(n.p,{children:"Serverpod ships with a powerful data modeling system that uses easy-to-read definition files in YAML. It generates Dart classes with all the necessary code to serialize and deserialize the data and connect to the database. This allows you to define your data models for the server and the app in one place, eliminating any inconsistencies. The models give you fine-grained control over the visibility of properties and how they interact with each other."}),"\n",(0,i.jsx)(n.h2,{id:"create-a-new-model",children:"Create a new model"}),"\n",(0,i.jsxs)(n.p,{children:["Models files can be placed anywhere in the server's ",(0,i.jsx)(n.code,{children:"lib"})," directory. We will create a new model file called ",(0,i.jsx)(n.code,{children:"recipe.spy.yaml"})," in the ",(0,i.jsx)(n.code,{children:"magic_recipe_server/lib/src/recipes/"})," directory. Use the ",(0,i.jsx)(n.code,{children:".spy.yaml"})," extension to indicate that this is a ",(0,i.jsx)(n.em,{children:"serverpod YAML"})," file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"### Our AI generated Recipe\nclass: Recipe\nfields:\n  ### The author of the recipe\n  author: String\n  ### The recipe text\n  text: String\n  ### The date the recipe was created\n  date: DateTime\n  ### The ingredients the user has passed in\n  ingredients: String\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use most primitive Dart types here or any other models you have specified in other YAML files. You can also use typed ",(0,i.jsx)(n.code,{children:"List"}),", ",(0,i.jsx)(n.code,{children:"Map"}),", or ",(0,i.jsx)(n.code,{children:"Set"}),". For detailed information, see ",(0,i.jsx)(n.a,{href:"/next/concepts/models",children:"Working with models"})]}),"\n",(0,i.jsx)(n.h2,{id:"generate-the-code",children:"Generate the code"}),"\n",(0,i.jsxs)(n.p,{children:["To generate the code for the model, run the ",(0,i.jsx)(n.code,{children:"serverpod generate"})," command in your server directory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ cd magic_recipe_server\n$ serverpod generate\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will generate the code for the model and create a new file called ",(0,i.jsx)(n.code,{children:"recipe.dart"})," in the ",(0,i.jsx)(n.code,{children:"lib/src/generated"})," directory. It will also update the client code in ",(0,i.jsx)(n.code,{children:"magic_recipe/magic_recipe_client"})," so you can use it in your Flutter app."]}),"\n",(0,i.jsx)(n.h2,{id:"use-the-model-in-the-server",children:"Use the model in the server"}),"\n",(0,i.jsxs)(n.p,{children:["Now that you have created the model, you can use it in your server code. Let's update the ",(0,i.jsx)(n.code,{children:"lib/src/recipes/recipe_endpoint.dart"})," file to make the ",(0,i.jsx)(n.code,{children:"generateRecipe"})," method return a ",(0,i.jsx)(n.code,{children:"Recipe"})," object instead of a string."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// ...\nimport 'package:magic_recipe_server/src/generated/protocol.dart';\n// ...\nclass RecipeEndpoint extends Endpoint {\n  /// Pass in a string containing the ingredients and get a recipe back.\n  Future<Recipe> generateRecipe(Session session, String ingredients) async {\n// ...\n    final recipe = Recipe(\n      author: 'Gemini',\n      text: responseText,\n      date: DateTime.now(),\n      ingredients: ingredients,\n    );\n\n    return recipe;\n  }\n}\n"})}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Click to see the full code"}),(0,i.jsx)("p",{children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"import 'dart:async';\n\nimport 'package:dartantic_ai/dartantic_ai.dart';\nimport 'package:magic_recipe_server/src/generated/protocol.dart';\nimport 'package:serverpod/serverpod.dart';\n\n/// This is the endpoint that will be used to generate a recipe using the\n/// Google Gemini API. It extends the Endpoint class and implements the\n/// generateRecipe method.\nclass RecipeEndpoint extends Endpoint {\n  /// Pass in a string containing the ingredients and get a recipe back.\n  Future<Recipe> generateRecipe(Session session, String ingredients) async {\n    // Serverpod automatically loads your passwords.yaml file and makes the passwords available\n    // in the session.passwords map.\n    final geminiApiKey = session.passwords['geminiApiKey'];\n    if (geminiApiKey == null) {\n      throw Exception('Gemini API key not found');\n    }\n    \n    // Configure the Dartantic AI agent for Gemini before sending the prompt.\n    final agent = Agent.forProvider(\n      GoogleProvider(apiKey: geminiApiKey),\n      chatModelName: 'gemini-2.5-flash-lite',\n    );\n\n    // A prompt to generate a recipe, the user will provide a free text input with the ingredients.\n    final prompt =\n        'Generate a recipe using the following ingredients: $ingredients, always put the title '\n        'of the recipe in the first line, and then the instructions. The recipe should be easy '\n        'to follow and include all necessary steps. Please provide a detailed recipe.';\n\n    final response = await agent.send(prompt);\n    final responseText = response.output;\n\n    // Check if the response is empty.\n    if (responseText.isEmpty) {\n      throw Exception('No response from Gemini API');\n    }\n\n    final recipe = Recipe(\n      author: 'Gemini',\n      text: responseText,\n      date: DateTime.now(),\n      ingredients: ingredients,\n    );\n\n    return recipe;\n  }\n}\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"use-the-model-in-the-app",children:"Use the model in the app"}),"\n",(0,i.jsxs)(n.p,{children:["First, we need to update our generated client by running ",(0,i.jsx)(n.code,{children:"serverpod generate"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ cd magic_recipe_server\n$ serverpod generate\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now that we have created the ",(0,i.jsx)(n.code,{children:"Recipe"})," model we can use it in the app. We will do this in the ",(0,i.jsx)(n.code,{children:"_callGenerateRecipe"})," method of the ",(0,i.jsx)(n.code,{children:"magic_recipe_flutter/lib/main.dart"})," file. Let's update our ",(0,i.jsx)(n.code,{children:"RecipeWidget"})," so that it displays the author and year of the recipe in addition to the recipe itself."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"void _callGenerateRecipe() async {\n// ...\n\n    // Update the state with the recipe we got from the server.\n    setState(() {\n      _errorMessage = null;\n\n      // Here we read the properties from our new Recipe model.\n      _resultMessage = '${result.author} on ${result.date}:\\n${result.text}';\n      _loading = false;\n    });\n\n// ...\n  }\n}\n"})}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Click to see the full code"}),(0,i.jsx)("p",{children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"import 'package:magic_recipe_client/magic_recipe_client.dart';\nimport 'package:flutter/material.dart';\nimport 'package:serverpod_flutter/serverpod_flutter.dart';\nimport 'package:serverpod_auth_idp_flutter/serverpod_auth_idp_flutter.dart';\n\n/// Sets up a global client object that can be used to talk to the server from\n/// anywhere in our app. The client is generated from your server code\n/// and is set up to connect to a Serverpod running on a local server on\n/// the default port. You will need to modify this to connect to staging or\n/// production servers.\n/// In a larger app, you may want to use the dependency injection of your choice\n/// instead of using a global client object. This is just a simple example.\nlate final Client client;\n\nlate String serverUrl;\n\nvoid main() {\n  // When you are running the app on a physical device, you need to set the\n  // server URL to the IP address of your computer. You can find the IP\n  // address by running `ipconfig` on Windows or `ifconfig` on Mac/Linux.\n  // You can set the variable when running or building your app like this:\n  // E.g. `flutter run --dart-define=SERVER_URL=https://api.example.com/`\n  const serverUrlFromEnv = String.fromEnvironment('SERVER_URL');\n  final serverUrl = serverUrlFromEnv.isEmpty\n      ? 'http://$localhost:8080/'\n      : serverUrlFromEnv;\n\n  client = Client(serverUrl)\n    ..connectivityMonitor = FlutterConnectivityMonitor()\n    ..authSessionManager = FlutterAuthSessionManager();\n\n  client.auth.initialize();\n\n  runApp(const MyApp());\n}\n\nclass MyApp extends StatelessWidget {\n  const MyApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Serverpod Demo',\n      theme: ThemeData(primarySwatch: Colors.blue),\n      home: const MyHomePage(title: 'Serverpod Example'),\n    );\n  }\n}\n\nclass MyHomePage extends StatefulWidget {\n  const MyHomePage({super.key, required this.title});\n\n  final String title;\n\n  @override\n  MyHomePageState createState() => MyHomePageState();\n}\n\nclass MyHomePageState extends State<MyHomePage> {\n  /// Holds the last result or null if no result exists yet.\n  String? _resultMessage;\n\n  /// Holds the last error message that we've received from the server or null\n  /// if no error exists yet.\n  String? _errorMessage;\n\n  final _textEditingController = TextEditingController();\n\n  bool _loading = false;\n\n  void _callGenerateRecipe() async {\n    try {\n      // Reset the state.\n      setState(() {\n        _errorMessage = null;\n        _resultMessage = null;\n        _loading = true;\n      });\n\n      // Call our `generateRecipe` method on the server.\n      final result = await client.recipe.generateRecipe(\n        _textEditingController.text,\n      );\n\n      // Update the state with the recipe we got from the server.\n      setState(() {\n        _errorMessage = null;\n        _resultMessage = '${result.author} on ${result.date}:\\n${result.text}';\n        _loading = false;\n      });\n    } catch (e) {\n      // If something goes wrong, set an error message.\n      setState(() {\n        _errorMessage = '$e';\n        _resultMessage = null;\n        _loading = false;\n      });\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: Text(widget.title),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16),\n        child: Column(\n          children: [\n            Padding(\n              padding: const EdgeInsets.only(bottom: 16.0),\n              child: TextField(\n                controller: _textEditingController,\n                decoration: const InputDecoration(\n                  hintText: 'Enter your ingredients',\n                ),\n              ),\n            ),\n            Padding(\n              padding: const EdgeInsets.only(bottom: 16.0),\n              child: ElevatedButton(\n                onPressed: _loading ? null : _callGenerateRecipe,\n                child: _loading\n                    ? const Text('Loading...')\n                    : const Text('Generate Recipe'),\n              ),\n            ),\n            Expanded(\n              child: SingleChildScrollView(\n                child: ResultDisplay(\n                  resultMessage: _resultMessage,\n                  errorMessage: _errorMessage,\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\nclass SignInScreen extends StatelessWidget {\n  const SignInScreen({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return Center(\n      child: SignInWidget(\n        client: client,\n        onAuthenticated: () {},\n      ),\n    );\n  }\n}\n\nclass ConnectedScreen extends StatefulWidget {\n  const ConnectedScreen({super.key});\n\n  @override\n  State<ConnectedScreen> createState() => _ConnectedScreenState();\n}\n\nclass _ConnectedScreenState extends State<ConnectedScreen> {\n  /// Holds the last result or null if no result exists yet.\n  String? _resultMessage;\n\n  /// Holds the last error message that we've received from the server or null\n  /// if no error exists yet.\n  String? _errorMessage;\n\n  final _textEditingController = TextEditingController();\n\n  /// Calls the `hello` method of the `greeting` endpoint. Will set either the\n  /// `_resultMessage` or `_errorMessage` field, depending on if the call\n  /// is successful.\n  void _callHello() async {\n    try {\n      final result = await client.greeting.hello(_textEditingController.text);\n      setState(() {\n        _errorMessage = null;\n        _resultMessage = result.message;\n      });\n    } catch (e) {\n      setState(() {\n        _errorMessage = '$e';\n      });\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Padding(\n      padding: const EdgeInsets.all(16),\n      child: Column(\n        children: [\n          const Text('You are connected'),\n          ElevatedButton(\n            onPressed: () async {\n              await client.auth.signOutDevice();\n            },\n            child: const Text('Sign out'),\n          ),\n          const SizedBox(height: 32),\n          TextField(\n            controller: _textEditingController,\n            decoration: const InputDecoration(hintText: 'Enter your name'),\n          ),\n          const SizedBox(height: 16),\n          ElevatedButton(\n            onPressed: _callHello,\n            child: const Text('Send to Server'),\n          ),\n          const SizedBox(height: 16),\n          ResultDisplay(\n            resultMessage: _resultMessage,\n            errorMessage: _errorMessage,\n          ),\n        ],\n      ),\n    );\n  }\n}\n\n/// ResultDisplays shows the result of the call. Either the returned result\n/// from the `example.greeting` endpoint method or an error message.\nclass ResultDisplay extends StatelessWidget {\n  final String? resultMessage;\n  final String? errorMessage;\n\n  const ResultDisplay({super.key, this.resultMessage, this.errorMessage});\n\n  @override\n  Widget build(BuildContext context) {\n    String text;\n    Color backgroundColor;\n    if (errorMessage != null) {\n      backgroundColor = Colors.red[300]!;\n      text = errorMessage!;\n    } else if (resultMessage != null) {\n      backgroundColor = Colors.green[300]!;\n      text = resultMessage!;\n    } else {\n      backgroundColor = Colors.grey[300]!;\n      text = 'No server response yet.';\n    }\n\n    return ConstrainedBox(\n      constraints: const BoxConstraints(minHeight: 50),\n      child: Container(\n        color: backgroundColor,\n        child: Center(child: Text(text)),\n      ),\n    );\n  }\n}\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"run-the-app",children:"Run the app"}),"\n",(0,i.jsx)(n.p,{children:"First, start the server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ cd magic_recipe_server\n$ docker compose up -d\n$ dart bin/main.dart\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then, start the Flutter app:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ cd magic_recipe_flutter\n$ flutter run -d chrome\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will start the Flutter app in your browser. It should look something like this:\n",(0,i.jsx)(n.img,{alt:"Flutter Recipe App",src:t(49789).A+"",width:"2166",height:"1612"})]}),"\n",(0,i.jsx)(n.p,{children:"Click the button to get a new recipe. The app will call the endpoint on the server and display the result in the app."}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,i.jsx)(n.p,{children:"On the Flutter side, there are quite a few things that could be improved, like a nicer display of the result, e.g., using a markdown renderer."}),"\n",(0,i.jsx)(n.p,{children:"In the next section, you will learn how to use the database to store your favorite recipes and display them in your app."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},49789(e,n,t){t.d(n,{A:()=>r});const r=t.p+"assets/images/flutter-web-ingredients-4e8a89eb52e8e984520e053ea0b7dee5.png"},28453(e,n,t){t.d(n,{R:()=>a,x:()=>o});var r=t(96540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);