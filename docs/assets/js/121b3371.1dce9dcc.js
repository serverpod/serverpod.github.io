"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[67049],{81758:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"concepts/scheduling/setup","title":"Setup","description":"Serverpod supports scheduling future work with the future call feature. Future calls are calls that will be invoked at a later time. An example is if you want to send a drip-email campaign after a user signs up. You can schedule a future call for a day, a week, a month, or a recurring interval. The calls are stored in the database, so they will persist even if the server is restarted.","source":"@site/versioned_docs/version-3.2.0/06-concepts/14-scheduling/01-setup.md","sourceDirName":"06-concepts/14-scheduling","slug":"/concepts/scheduling/setup","permalink":"/concepts/scheduling/setup","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.2.0/06-concepts/14-scheduling/01-setup.md","tags":[],"version":"3.2.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Health checks","permalink":"/concepts/health-checks"},"next":{"title":"Recurring Task","permalink":"/concepts/scheduling/recurring-task"}}');var a=r(74848),s=r(28453);const i={},l="Setup",o={},c=[];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"setup",children:"Setup"})}),"\n",(0,a.jsxs)(n.p,{children:["Serverpod supports scheduling future work with the ",(0,a.jsx)(n.code,{children:"future call"})," feature. Future calls are calls that will be invoked at a later time. An example is if you want to send a drip-email campaign after a user signs up. You can schedule a future call for a day, a week, a month, or a ",(0,a.jsx)(n.a,{href:"recurring-task",children:"recurring interval"}),". The calls are stored in the database, so they will persist even if the server is restarted."]}),"\n",(0,a.jsx)(n.p,{children:"A future call is guaranteed to only execute once across all your instances that are running, but execution failures are not handled automatically. It is your responsibility to schedule a new future call if the work was not able to complete."}),"\n",(0,a.jsxs)(n.p,{children:["To create future calls, extend the ",(0,a.jsx)(n.code,{children:"FutureCall"})," class and define the methods you wish to invoke at a later time."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\n\nclass ExampleFutureCall extends FutureCall {\n  Future<void> doWork(Session session, String data) async {\n    // Do something interesting in the future here.\n  }\n\n  Future<void> doOtherWork(Session session, String data) async {\n    // Do something interesting in the future here.\n  }\n}\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["For a method to be recognized by Serverpod as a future call, it must return a ",(0,a.jsx)(n.code,{children:"Future<void>"})," and take at least two parameters. The first parameter must be a ",(0,a.jsx)(n.a,{href:"../sessions",children:(0,a.jsx)(n.code,{children:"Session"})})," object. You can pass any serializable types as other parameters, and even use ",(0,a.jsx)(n.code,{children:"List"}),", ",(0,a.jsx)(n.code,{children:"Map"}),", ",(0,a.jsx)(n.code,{children:"Set"})," or Dart records as long as they are typed. ",(0,a.jsx)(n.code,{children:"Streaming"})," parameters are not supported."]})}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["It is not valid to override the ",(0,a.jsx)(n.code,{children:"invoke"})," method of the ",(0,a.jsx)(n.code,{children:"FutureCall"})," class. This method is reserved for the execution of the future call."]})}),"\n",(0,a.jsx)(n.p,{children:"Next, you need to generate the code for your future calls:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ serverpod generate\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Calling ",(0,a.jsx)(n.code,{children:"serverpod generate"})," will create a type-safe interface for invoking the future calls in the server's ",(0,a.jsx)(n.code,{children:"generated/future_calls.dart"})," file. This interface can be accessed from the Serverpod object."]}),"\n",(0,a.jsxs)(n.p,{children:["The future calls you create are registered by ",(0,a.jsx)(n.code,{children:"Serverpod"})," after the server starts."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\n\nimport 'src/generated/protocol.dart';\nimport 'src/generated/endpoints.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  await pod.start();\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You are now able to schedule future calls to be invoked in the future by calling either ",(0,a.jsx)(n.code,{children:"callWithDelay"})," or ",(0,a.jsx)(n.code,{children:"callAtTime"})," depending on your needs."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"futureCalls"})," getter is only available if at least one future call has been defined."]})}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsx)(n.p,{children:"Scheduling a future call before the server starts will lead to exceptions."})}),"\n",(0,a.jsxs)(n.p,{children:["Invoke a future call 1 hour from now by calling ",(0,a.jsx)(n.code,{children:"callWithDelay"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await pod.futureCalls\n    .callWithDelay(const Duration(hours: 1))\n    .example\n    .doWork('1');\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Invoke a future call at a specific time and/or date in the future by calling ",(0,a.jsx)(n.code,{children:"callAtTime"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await pod.futureCalls\n    .callAtTime(DateTime(2026, 1, 1))\n    .example\n    .doOtherWork('2');\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Scheduling a future call at a specific time/date will always resolve the ",(0,a.jsx)(n.code,{children:"DateTime"})," to UTC."]})}),"\n",(0,a.jsxs)(n.p,{children:["When scheduling a future call, it is also possible to give it an ",(0,a.jsx)(n.code,{children:"identifier"})," so that it can be referenced later. The same identifier can be applied to multiple future calls."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await pod.futureCalls\n    .callWithDelay(\n      const Duration(hours: 1),\n      identifier: 'an-identifying-string',\n    )\n    .example\n    .doWork('1');\n"})}),"\n",(0,a.jsx)(n.p,{children:"This identifier can then be used to cancel all future calls scheduled with said identifier."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await pod.futureCalls.cancel('an-identifying-string');\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"The future call feature is not enabled when running Serverpod in serverless mode."})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var t=r(96540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);