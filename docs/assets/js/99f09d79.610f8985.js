"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[73752],{11669(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"concepts/authentication/providers/firebase/setup","title":"Setup","description":"Firebase authentication works differently from other identity providers in Serverpod. Instead of handling authentication directly, Serverpod\'s Firebase integration acts as a bridge between Firebase Authentication and your Serverpod backend. Firebase handles the actual sign-in process through its own SDKs and UI components, while Serverpod syncs the authenticated user and manages the server-side session.","source":"@site/versioned_docs/version-3.2.0/06-concepts/11-authentication/04-providers/05-firebase/01-setup.md","sourceDirName":"06-concepts/11-authentication/04-providers/05-firebase","slug":"/concepts/authentication/providers/firebase/setup","permalink":"/concepts/authentication/providers/firebase/setup","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.2.0/06-concepts/11-authentication/04-providers/05-firebase/01-setup.md","tags":[],"version":"3.2.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Customizing the UI","permalink":"/concepts/authentication/providers/passkey/customizing-the-ui"},"next":{"title":"Configuration","permalink":"/concepts/authentication/providers/firebase/configuration"}}');var r=i(74848),s=i(28453);const a={},o="Setup",c={},d=[{value:"Create your credentials",id:"create-your-credentials",level:2},{value:"Generate Service Account Key",id:"generate-service-account-key",level:3},{value:"Enable Authentication Methods",id:"enable-authentication-methods",level:3},{value:"Server-side configuration",id:"server-side-configuration",level:2},{value:"Store the Service Account Key",id:"store-the-service-account-key",level:3},{value:"Configure the Firebase Identity Provider",id:"configure-the-firebase-identity-provider",level:3},{value:"Expose the Endpoint",id:"expose-the-endpoint",level:3},{value:"Generate and Migrate",id:"generate-and-migrate",level:3},{value:"Basic configuration options",id:"basic-configuration-options",level:3},{value:"Client-side configuration",id:"client-side-configuration",level:2},{value:"Install Required Packages",id:"install-required-packages",level:3},{value:"Configure FlutterFire",id:"configure-flutterfire",level:3},{value:"Initialize Firebase and Serverpod",id:"initialize-firebase-and-serverpod",level:3},{value:"The authentication flow",id:"the-authentication-flow",level:2},{value:"Present the authentication UI",id:"present-the-authentication-ui",level:2},{value:"Using firebase_ui_auth",id:"using-firebase_ui_auth",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"setup",children:"Setup"})}),"\n",(0,r.jsx)(n.p,{children:"Firebase authentication works differently from other identity providers in Serverpod. Instead of handling authentication directly, Serverpod's Firebase integration acts as a bridge between Firebase Authentication and your Serverpod backend. Firebase handles the actual sign-in process through its own SDKs and UI components, while Serverpod syncs the authenticated user and manages the server-side session."}),"\n",(0,r.jsx)(n.p,{children:"This approach allows you to use any authentication method supported by Firebase (email/password, phone, Google, Apple, Facebook, etc.) while maintaining a unified user system in your Serverpod backend."}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["You need to install the auth module before you continue, see ",(0,r.jsx)(n.a,{href:"../../setup",children:"Setup"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"create-your-credentials",children:"Create your credentials"}),"\n",(0,r.jsx)(n.h3,{id:"generate-service-account-key",children:"Generate Service Account Key"}),"\n",(0,r.jsx)(n.p,{children:"The server needs service account credentials to verify Firebase ID tokens. To create a new key:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to the ",(0,r.jsx)(n.a,{href:"https://console.firebase.google.com/",children:"Firebase Console"})," (create a new project if you don't have one)."]}),"\n",(0,r.jsx)(n.li,{children:"Select your project."}),"\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.strong,{children:"Project settings"})," > ",(0,r.jsx)(n.strong,{children:"Service accounts"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Generate new private key"}),", then ",(0,r.jsx)(n.strong,{children:"Generate key"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Service account",src:i(99299).A+"",width:"2000",height:"1360"})}),"\n",(0,r.jsx)(n.p,{children:"This downloads a JSON file containing your service account credentials."}),"\n",(0,r.jsx)(n.h3,{id:"enable-authentication-methods",children:"Enable Authentication Methods"}),"\n",(0,r.jsx)(n.p,{children:"In the Firebase Console, enable the authentication methods you want to support:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.strong,{children:"Authentication"})," > ",(0,r.jsx)(n.strong,{children:"Sign-in method"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Enable your desired providers (Email/Password, Phone, Google, Apple, etc.)."}),"\n",(0,r.jsx)(n.li,{children:"Configure each provider according to Firebase's documentation."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Auth provider",src:i(54497).A+"",width:"1992",height:"510"})}),"\n",(0,r.jsx)(n.h2,{id:"server-side-configuration",children:"Server-side configuration"}),"\n",(0,r.jsx)(n.h3,{id:"store-the-service-account-key",children:"Store the Service Account Key"}),"\n",(0,r.jsxs)(n.p,{children:["This can be done by pasting the contents of the JSON file into the ",(0,r.jsx)(n.code,{children:"firebaseServiceAccountKey"})," key in the ",(0,r.jsx)(n.code,{children:"config/passwords.yaml"})," file or setting as value of the ",(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_firebaseServiceAccountKey"})," environment variable. Alternatively, you can read the file contents directly using the ",(0,r.jsx)(n.code,{children:"FirebaseServiceAccountCredentials.fromJsonFile()"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'development:\n  firebaseServiceAccountKey: |\n    {\n      "type": "service_account",\n      "project_id": "your-project-id",\n      "private_key_id": "...",\n      "private_key": "-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n",\n      "client_email": "firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com",\n      "client_id": "...",\n      "auth_uri": "https://accounts.google.com/o/oauth2/auth",\n      "token_uri": "https://oauth2.googleapis.com/token"\n    }\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"The service account key gives admin access to your Firebase project and should not be version controlled. Store it securely using environment variables or secret management."})}),"\n",(0,r.jsx)(n.h3,{id:"configure-the-firebase-identity-provider",children:"Configure the Firebase Identity Provider"}),"\n",(0,r.jsxs)(n.p,{children:["In your main ",(0,r.jsx)(n.code,{children:"server.dart"})," file, configure the Firebase identity provider:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod/serverpod.dart';\nimport 'package:serverpod_auth_idp_server/core.dart';\nimport 'package:serverpod_auth_idp_server/providers/firebase.dart';\n\nvoid run(List<String> args) async {\n  final pod = Serverpod(\n    args,\n    Protocol(),\n    Endpoints(),\n  );\n\n  pod.initializeAuthServices(\n    tokenManagerBuilders: [\n      JwtConfigFromPasswords(),\n    ],\n    identityProviderBuilders: [\n      FirebaseIdpConfig(\n        credentials: FirebaseServiceAccountCredentials.fromJsonString(\n          pod.getPassword('firebaseServiceAccountKey')!,\n        ),\n      ),\n    ],\n  );\n\n  await pod.start();\n}\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["You can use ",(0,r.jsx)(n.code,{children:"FirebaseIdpConfigFromPasswords()"})," to automatically load credentials from ",(0,r.jsx)(n.code,{children:"config/passwords.yaml"})," or the ",(0,r.jsx)(n.code,{children:"SERVERPOD_PASSWORD_firebaseServiceAccountKey"})," environment variable:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"identityProviderBuilders: [\n  FirebaseIdpConfigFromPasswords(),\n],\n"})})]}),"\n",(0,r.jsx)(n.h3,{id:"expose-the-endpoint",children:"Expose the Endpoint"}),"\n",(0,r.jsxs)(n.p,{children:["Create an endpoint that extends ",(0,r.jsx)(n.code,{children:"FirebaseIdpBaseEndpoint"})," to expose the Firebase authentication API:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_idp_server/providers/firebase.dart';\n\nclass FirebaseIdpEndpoint extends FirebaseIdpBaseEndpoint {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"generate-and-migrate",children:"Generate and Migrate"}),"\n",(0,r.jsxs)(n.p,{children:["Finally, run ",(0,r.jsx)(n.code,{children:"serverpod generate"})," to generate the client code and create a migration to initialize the database for the provider. More detailed instructions can be found in the general ",(0,r.jsx)(n.a,{href:"../../setup#identity-providers-configuration",children:"identity providers setup section"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"basic-configuration-options",children:"Basic configuration options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credentials"}),": Required. Firebase service account credentials for verifying ID tokens. See the ",(0,r.jsx)(n.a,{href:"./configuration",children:"configuration section"})," for different ways to load credentials."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"firebaseAccountDetailsValidation"}),": Optional. Validation function for Firebase account details. By default, this validates that the email is verified when present (phone-only authentication is allowed). See the ",(0,r.jsx)(n.a,{href:"./configuration#custom-account-validation",children:"configuration section"})," for customization options."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"client-side-configuration",children:"Client-side configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The client-side setup uses the official Firebase packages (",(0,r.jsx)(n.code,{children:"firebase_core"}),", ",(0,r.jsx)(n.code,{children:"firebase_auth"}),", and optionally ",(0,r.jsx)(n.code,{children:"firebase_ui_auth"}),") for authentication. The steps below follow standard Firebase usage - for troubleshooting, refer to the ",(0,r.jsx)(n.a,{href:"https://firebase.google.com/docs/flutter/setup",children:"official Firebase Flutter documentation"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"install-required-packages",children:"Install Required Packages"}),"\n",(0,r.jsx)(n.p,{children:"Add the Firebase and Serverpod authentication packages to your Flutter project:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"flutter pub add firebase_core firebase_auth serverpod_auth_idp_flutter_firebase\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you want to use Firebase's pre-built UI components, also add:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"flutter pub add firebase_ui_auth\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configure-flutterfire",children:"Configure FlutterFire"}),"\n",(0,r.jsx)(n.p,{children:"If you haven't already, install the Firebase CLI and FlutterFire CLI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install -g firebase-tools\ndart pub global activate flutterfire_cli\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then run the FlutterFire CLI to configure Firebase for your Flutter project:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"flutterfire configure\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This generates a ",(0,r.jsx)(n.code,{children:"firebase_options.dart"})," file with your platform-specific Firebase configuration."]}),"\n",(0,r.jsx)(n.h3,{id:"initialize-firebase-and-serverpod",children:"Initialize Firebase and Serverpod"}),"\n",(0,r.jsxs)(n.p,{children:["In your ",(0,r.jsx)(n.code,{children:"main.dart"}),", initialize both Firebase and the Serverpod client:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:firebase_core/firebase_core.dart';\nimport 'package:flutter/material.dart';\nimport 'package:serverpod_flutter/serverpod_flutter.dart';\nimport 'package:serverpod_auth_idp_flutter_firebase/serverpod_auth_idp_flutter_firebase.dart';\nimport 'package:your_client/your_client.dart';\nimport 'firebase_options.dart';\n\nlate Client client;\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n\n  // Initialize Firebase\n  await Firebase.initializeApp(\n    options: DefaultFirebaseOptions.currentPlatform,\n  );\n\n  // Create the Serverpod client\n  client = Client('http://localhost:8080/')\n    ..connectivityMonitor = FlutterConnectivityMonitor()\n    ..authSessionManager = FlutterAuthSessionManager();\n\n  // Initialize Serverpod auth\n  await client.auth.initialize();\n\n  // Initialize Firebase sign-in service (enables automatic sign-out sync)\n  client.auth.initializeFirebaseSignIn();\n\n  runApp(const MyApp());\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"the-authentication-flow",children:"The authentication flow"}),"\n",(0,r.jsx)(n.p,{children:"Understanding the Firebase authentication flow helps when building custom integrations:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User initiates sign-in"})," with Firebase using ",(0,r.jsx)(n.code,{children:"firebase_auth"})," or ",(0,r.jsx)(n.code,{children:"firebase_ui_auth"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firebase authenticates"})," the user and returns a ",(0,r.jsx)(n.code,{children:"firebase_auth.User"})," object."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Your app calls"})," ",(0,r.jsx)(n.code,{children:"FirebaseAuthController.login(user)"})," with the Firebase user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"The controller extracts"})," the Firebase ID token from the user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token is sent"})," to your server's ",(0,r.jsx)(n.code,{children:"firebaseIdp.login()"})," endpoint."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server validates"})," the JWT using the service account credentials."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server creates or updates"})," the user account and issues a Serverpod session token."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client session is updated"})," and the user is authenticated with Serverpod in the Flutter app."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"initializeFirebaseSignIn()"})," call in the client setup will ensure that the user gets automatically signed out from Firebase when signing out from Serverpod to keep both systems in sync."]})}),"\n",(0,r.jsx)(n.h2,{id:"present-the-authentication-ui",children:"Present the authentication UI"}),"\n",(0,r.jsx)(n.h3,{id:"using-firebase_ui_auth",children:"Using firebase_ui_auth"}),"\n",(0,r.jsxs)(n.p,{children:["The easiest way to add Firebase authentication is using the ",(0,r.jsx)(n.code,{children:"firebase_ui_auth"})," package with its pre-built ",(0,r.jsx)(n.code,{children:"SignInScreen"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:firebase_auth/firebase_auth.dart' as firebase_auth;\nimport 'package:firebase_ui_auth/firebase_ui_auth.dart' as firebase_ui;\nimport 'package:flutter/material.dart';\nimport 'package:serverpod_auth_idp_flutter_firebase/serverpod_auth_idp_flutter_firebase.dart';\n\nclass SignInPage extends StatefulWidget {\n  const SignInPage({super.key});\n\n  @override\n  State<SignInPage> createState() => _SignInPageState();\n}\n\nclass _SignInPageState extends State<SignInPage> {\n  late final FirebaseAuthController controller;\n\n  @override\n  void initState() {\n    super.initState();\n    controller = FirebaseAuthController(\n      client: client,\n      onError: (error) {\n        ScaffoldMessenger.of(context).showSnackBar(\n          SnackBar(content: Text('Error: $error')),\n        );\n      },\n    );\n  }\n\n  @override\n  void dispose() {\n    controller.dispose();\n    super.dispose();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return firebase_ui.SignInScreen(\n      providers: [\n        firebase_ui.EmailAuthProvider(),\n      ],\n      actions: [\n        firebase_ui.AuthStateChangeAction<firebase_ui.SignedIn>((context, state) async {\n          final user = firebase_auth.FirebaseAuth.instance.currentUser;\n          if (user != null) {\n            await controller.login(user);\n          }\n        }),\n        firebase_ui.AuthStateChangeAction<firebase_ui.UserCreated>((context, state) async {\n          final user = firebase_auth.FirebaseAuth.instance.currentUser;\n          if (user != null) {\n            await controller.login(user);\n          }\n        }),\n      ],\n    );\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For details on using the ",(0,r.jsx)(n.code,{children:"FirebaseAuthController"})," directly and building custom authentication UIs, see the ",(0,r.jsx)(n.a,{href:"./customizing-the-ui",children:"customizing the UI section"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},99299(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/1-server-key-a3d225c962e46d6135eff54f7191bb84.png"},54497(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/2-auth-provider-3d8a103f08b06690db115d59dd029039.png"},28453(e,n,i){i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);