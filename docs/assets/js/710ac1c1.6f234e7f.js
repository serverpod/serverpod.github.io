"use strict";(self.webpackChunkserverpod_docs=self.webpackChunkserverpod_docs||[]).push([[16678],{14899:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"concepts/authentication","title":"Authentication","description":"In Serverpod, authentication is managed through the serverpod_auth module. It makes it easy to authenticate users through email or 3rd parties. Currently supported is Signing in with email, Google, and Apple. Future versions of the authentication module will include more options. Using this module requires some setup with Google and Apple for things to work.","source":"@site/versioned_docs/version-0.9.20/04-concepts/07-authentication.md","sourceDirName":"04-concepts","slug":"/concepts/authentication","permalink":"/0.9.20/concepts/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-0.9.20/04-concepts/07-authentication.md","tags":[],"version":"0.9.20","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Modules","permalink":"/0.9.20/concepts/modules"},"next":{"title":"Uploading files","permalink":"/0.9.20/concepts/file-uploads"}}');var s=i(74848),o=i(28453);const r={},a="Authentication",l={},d=[{value:"Installing the module",id:"installing-the-module",level:2},{value:"Setting up Sign in with Email",id:"setting-up-sign-in-with-email",level:2},{value:"Setting up Sign in with Google",id:"setting-up-sign-in-with-google",level:2},{value:"Setting up Sign in with Apple",id:"setting-up-sign-in-with-apple",level:2},{value:"Setting up Sign in with Firebase",id:"setting-up-sign-in-with-firebase",level:2},{value:"Add sign-in buttons in your code",id:"add-sign-in-buttons-in-your-code",level:2},{value:"Displaying or editing user images",id:"displaying-or-editing-user-images",level:2},{value:"Supported authentication methods",id:"supported-authentication-methods",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,s.jsxs)(n.p,{children:["In Serverpod, authentication is managed through the ",(0,s.jsx)(n.code,{children:"serverpod_auth"})," module. It makes it easy to authenticate users through email or 3rd parties. Currently supported is Signing in with email, Google, and Apple. Future versions of the authentication module will include more options. Using this module requires some setup with Google and Apple for things to work."]}),"\n",(0,s.jsx)(n.p,{children:"The authentication module also handles basic user information, such as user names and profile pictures."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/serverpod/serverpod/raw/main/misc/images/sign-in.png",alt:"Sign-in with Serverpod"})}),"\n",(0,s.jsx)(n.h2,{id:"installing-the-module",children:"Installing the module"}),"\n",(0,s.jsxs)(n.p,{children:["Please refer to the previous section, ",(0,s.jsx)(n.a,{href:"./modules",children:"Modules"}),", for instructions on how to add a module to your project."]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-sign-in-with-email",children:"Setting up Sign in with Email"}),"\n",(0,s.jsxs)(n.p,{children:["To properly configure Sign in with Email, you must connect your Serverpod to an external service that can send the emails. One convenient option is the ",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/mailer",children:"mailer"}),"](",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/mailer",children:"https://pub.dev/packages/mailer"}),") package, which can send emails through any SMTP service. Most email providers, such as Sendgrid or Mandrill, support SMTP."]}),"\n",(0,s.jsxs)(n.p,{children:["In your main ",(0,s.jsx)(n.code,{children:"server.dart"})," file, you can configure the auth module. First, make sure to include the module:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:serverpod_auth_server/module.dart' as auth;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, add the configuration before you start your Serverpod:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"auth.AuthConfig.set(auth.AuthConfig(\n  sendValidationEmail: (session, email, validationCode) async {\n    // Send your validation email here.\n  },\n  sendPasswordResetEmail: (session, userInfo, validationCode) async {\n    // Send a password reset email here.\n  },\n));\n\n// Start the server.\nawait pod.start();\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["For debugging purposes, you can print the validation code to the console. The chat module example does just this. You can view that code ",(0,s.jsx)(n.a,{href:"https://github.com/serverpod/serverpod/blob/main/examples/chat/chat_server/lib/server.dart",children:"here"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-sign-in-with-google",children:"Setting up Sign in with Google"}),"\n",(0,s.jsxs)(n.p,{children:["To set up Sign in with Google, you will need a Google account for your organization and set up a new project. For the project, you need to set up ",(0,s.jsx)(n.em,{children:"Credentials"})," and ",(0,s.jsx)(n.em,{children:"Oauth consent screen"}),". You will need an OAuth 2.0 Client id of type ",(0,s.jsx)(n.em,{children:"Web application"}),"."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Follow the instructions in the ",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/google_sign_in",children:"google_sign_in"})," plug-in for iOS and Android.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For iOS, make sure that you obtain the ",(0,s.jsx)(n.code,{children:"GoogleService-Info.plist"})," and add it to your Xcode project."]}),"\n",(0,s.jsx)(n.li,{children:"For Android, there are other setup steps you need to take."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["In Google cloud, you need to do some additional setup.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Activate the ",(0,s.jsx)(n.em,{children:"People API"})," on your project."]}),"\n",(0,s.jsxs)(n.li,{children:["Set up the OAuth consent screen. You must add the ",(0,s.jsx)(n.code,{children:"../auth/userinfo.email"})," and ",(0,s.jsx)(n.code,{children:"../auth/userinfo.profile"})," scopes. You can also set up additional scopes and access them through Google's APIs on the client or server side."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Finally, you need to set up the Google client secret so your server can authenticate the user with Google. In GCP's ",(0,s.jsx)(n.em,{children:"APIs & Services"}),", select the ",(0,s.jsx)(n.em,{children:"Credentials tab"}),". Download the JSON from your ",(0,s.jsx)(n.em,{children:"OAuth 2.0 Client IDs"}),". Rename it to ",(0,s.jsx)(n.code,{children:"google_client_secret.json"})," and place it in the ",(0,s.jsx)(n.code,{children:"config"})," directory of your server."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-sign-in-with-apple",children:"Setting up Sign in with Apple"}),"\n",(0,s.jsxs)(n.p,{children:["You will need an Apple developer account to configure Sign in with Apple. Follow the instructions in ",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/sign_in_with_apple",children:"sign_in_with_apple"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Note that Sign in with Apple may not work on some versions of the Simulator (iOS 13.5 works). This issue doesn't affect real devices."})}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-sign-in-with-firebase",children:"Setting up Sign in with Firebase"}),"\n",(0,s.jsx)(n.p,{children:"Serverpod uses FlutterFire UI to handle authentication through Firebase. It allows you to add social sign-in types that Serverpod doesn't directly support."}),"\n",(0,s.jsxs)(n.p,{children:["To add authentication with Firebase, you must first install and initialize the Firebase CLI tools and Flutter fire. Follow the instructions ",(0,s.jsx)(n.a,{href:"https://firebase.google.com/docs/flutter/setup?platform=web",children:"here"})," for your Flutter project. In the Firebase console, configure the different social sign-ins you plan to use. Then pass your provider configurations to either the signInWithFirebase method or the SignInWithFirebaseButton of the ",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/serverpod_auth_firebase_flutter",children:"serverpod_auth_firebase_flutter"})," package."]}),"\n",(0,s.jsxs)(n.p,{children:["Server-side, you need to create a set of authentication keys in the ",(0,s.jsx)(n.a,{href:"https://console.firebase.google.com/",children:"Firebase console"}),", download the JSON file, rename it to firebase_service_account_key.json and place it in the config folder."]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"Serverpod automatically merges accounts that are using the same email addresses, so make sure only to allow sign-ins where the email has been verified."})}),"\n",(0,s.jsx)(n.h2,{id:"add-sign-in-buttons-in-your-code",children:"Add sign-in buttons in your code"}),"\n",(0,s.jsxs)(n.p,{children:["First, you need to add dependencies to your app's ",(0,s.jsx)(n.code,{children:"pubspec.yaml"})," file for the methods of signing in that you want to support. Make sure to use the same version numbers as for serverpod itself."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter:\n    sdk: flutter\n  example_client:\n    path: ../example_client\n  serverpod_auth_google_flutter: ^0.9.5\n  serverpod_auth_apple_flutter: ^0.9.5\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Next, you need to set up a ",(0,s.jsx)(n.code,{children:"SessionManager"}),", which keeps track of the user's state. It will also handle the authentication keys passed to the client from the server, upload user profile images, etc."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"void main() async {\n  // Need to call this as we are using Flutter bindings before runApp is called.\n  WidgetsFlutterBinding.ensureInitialized();\n\n  // Sets up a singleton client object that can be used to talk to the server\n  // from anywhere in our app. The client is generated from your server code.\n  // The client is set up to connect to a Serverpod running on a local server on\n  // the default port. You will need to modify this to connect to staging or\n  // production servers.\n  client = Client(\n    'http://localhost:8080/',\n    authenticationKeyManager: FlutterAuthenticationKeyManager(),\n  );\n\n  // The session manager keeps track of the signed-in state of the user. You\n  // can query it to see if the user is currently signed in and get information\n  // about the user.\n  sessionManager = SessionManager(\n    caller: client.modules.auth,\n  );\n  await sessionManager.initialize();\n\n  runApp(MyApp());\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now, you can simply add the sign-in buttons to your code."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"SignInWithGoogleButton(\n  caller: client.modules.auth,\n  onSignedIn: () { ... handle sign in here ... },\n  onFailure: () { ... handle fail to sign in here ... },\n)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This is a complete example of a sign-in dialog: ",(0,s.jsx)(n.a,{href:"https://github.com/serverpod/serverpod/blob/main/packages/serverpod/example/example_flutter/lib/src/sign_in_dialog.dart",children:"sign_in_dialog.dart"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"displaying-or-editing-user-images",children:"Displaying or editing user images"}),"\n",(0,s.jsx)(n.p,{children:"The module has built-in methods for handling a user's basic settings, including uploading new profile pictures."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/serverpod/serverpod/raw/main/misc/images/user-image-button.png",alt:"UserImageButton"})}),"\n",(0,s.jsxs)(n.p,{children:["To display a user's profile picture, use the ",(0,s.jsx)(n.code,{children:"CircularUserImage"})," widget and pass a ",(0,s.jsx)(n.code,{children:"UserInfo"})," retrieved from the ",(0,s.jsx)(n.code,{children:"SessionManager"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["To edit a user profile image, use the ",(0,s.jsx)(n.code,{children:"UserImageButton"})," widget. It will automatically fetch the signed-in user's profile picture and communicate with the server."]}),"\n",(0,s.jsx)(n.h2,{id:"supported-authentication-methods",children:"Supported authentication methods"}),"\n",(0,s.jsxs)(n.p,{children:["Currently, sign-in with Google, Apple, Firebase, and email is natively supported. If you write another authentication module, please consider ",(0,s.jsx)(n.a,{href:"/contribute",children:"contributing"})," your code."]})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);