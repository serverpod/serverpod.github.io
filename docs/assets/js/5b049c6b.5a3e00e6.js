"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[56546],{75740(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"upgrading/upgrade-to-three","title":"Upgrade to 3.0","description":"The new authentication module has separate migration documentation. This guide covers only core framework changes.","source":"@site/versioned_docs/version-3.2.0/08-upgrading/01-upgrade-to-three.md","sourceDirName":"08-upgrading","slug":"/upgrading/upgrade-to-three","permalink":"/upgrading/upgrade-to-three","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.2.0/08-upgrading/01-upgrade-to-three.md","tags":[],"version":"3.2.0","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Community-supported deployments","permalink":"/deployments/community-supported-deployments"},"next":{"title":"Upgrade from Mini to full","permalink":"/upgrading/upgrade-from-mini"}}');var i=s(74848),t=s(28453);const d={},a="Upgrade to 3.0",l={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Breaking changes summary",id:"breaking-changes-summary",level:2},{value:"Updating your project",id:"updating-your-project",level:2},{value:"Update the CLI",id:"update-the-cli",level:3},{value:"Update pubspec.yaml files",id:"update-pubspecyaml-files",level:3},{value:"Update the Dockerfile",id:"update-the-dockerfile",level:3},{value:"Run updates",id:"run-updates",level:3},{value:"Create and apply migrations",id:"create-and-apply-migrations",level:3},{value:"Migration checklist",id:"migration-checklist",level:2},{value:"Web server (Relic framework)",id:"web-server-relic-framework",level:2},{value:"Route.handleCall signature",id:"routehandlecall-signature",level:3},{value:"Widget class names",id:"widget-class-names",level:3},{value:"Static route updates",id:"static-route-updates",level:3},{value:"Session.request property",id:"sessionrequest-property",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Custom authentication handlers",id:"custom-authentication-handlers",level:3},{value:"AuthenticationInfo changes",id:"authenticationinfo-changes",level:3},{value:"session.authenticated is now synchronous",id:"sessionauthenticated-is-now-synchronous",level:3},{value:"Client auth key provider",id:"client-auth-key-provider",level:3},{value:"Enum serialization",id:"enum-serialization",level:2},{value:"Model changes",id:"model-changes",level:2},{value:"SerializableEntity removed",id:"serializableentity-removed",level:3},{value:"Removed YAML keywords",id:"removed-yaml-keywords",level:3},{value:"Deprecated APIs",id:"deprecated-apis",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"Resources",id:"resources",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"upgrade-to-30",children:"Upgrade to 3.0"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The new authentication module has separate migration documentation. This guide covers only core framework changes."})}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dart SDK: 3.8.0+"}),"\n",(0,i.jsx)(n.li,{children:"Flutter SDK: 3.32.0+"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"breaking-changes-summary",children:"Breaking changes summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#web-server-relic-framework",children:(0,i.jsx)(n.strong,{children:"Web server:"})})," Relic framework integration (custom routes need updates)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#sessionrequest-property",children:(0,i.jsx)(n.strong,{children:"Session.request:"})})," New property to access HTTP request from endpoints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#authentication",children:(0,i.jsx)(n.strong,{children:"Authentication:"})})," ",(0,i.jsx)(n.code,{children:"AuthenticationInfo"})," changes, ",(0,i.jsx)(n.code,{children:"session.authenticated"})," now synchronous"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#enum-serialization",children:(0,i.jsx)(n.strong,{children:"Enum serialization:"})})," Default changed from ",(0,i.jsx)(n.code,{children:"byIndex"})," to ",(0,i.jsx)(n.code,{children:"byName"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#model-changes",children:(0,i.jsx)(n.strong,{children:"Model changes:"})})," ",(0,i.jsx)(n.code,{children:"SerializableEntity"})," removed, YAML keywords updated"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"updating-your-project",children:"Updating your project"}),"\n",(0,i.jsx)(n.h3,{id:"update-the-cli",children:"Update the CLI"}),"\n",(0,i.jsx)(n.p,{children:"Update the Serverpod command line interface to the latest version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dart pub global activate serverpod_cli\n"})}),"\n",(0,i.jsx)(n.p,{children:"Verify the installed version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"serverpod version\n"})}),"\n",(0,i.jsx)(n.h3,{id:"update-pubspecyaml-files",children:"Update pubspec.yaml files"}),"\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"pubspec.yaml"})," files in your ",(0,i.jsx)(n.code,{children:"server"}),", ",(0,i.jsx)(n.code,{children:"client"}),", and ",(0,i.jsx)(n.code,{children:"flutter"})," directories. Change all Serverpod package versions to ",(0,i.jsx)(n.code,{children:"3.0.0"})," (or later 3.x version)."]}),"\n",(0,i.jsxs)(n.p,{children:["Update the Dart SDK constraint in all ",(0,i.jsx)(n.code,{children:"pubspec.yaml"})," files:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"environment:\n  sdk: '>=3.8.0 <4.0.0'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"update-the-dockerfile",children:"Update the Dockerfile"}),"\n",(0,i.jsxs)(n.p,{children:["Update the Dart version in your project's ",(0,i.jsx)(n.code,{children:"Dockerfile"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",children:"FROM dart:3.8 AS build\n\n...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-updates",children:"Run updates"}),"\n",(0,i.jsxs)(n.p,{children:["After updating your ",(0,i.jsx)(n.code,{children:"pubspec.yaml"})," files, run these commands in each package directory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dart pub upgrade\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then regenerate your project in your ",(0,i.jsx)(n.code,{children:"server"})," directory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"serverpod generate\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-and-apply-migrations",children:"Create and apply migrations"}),"\n",(0,i.jsxs)(n.p,{children:["A database migration is required for Serverpod 3.0. The session log table now stores authenticated user IDs as ",(0,i.jsx)(n.code,{children:"String"})," instead of ",(0,i.jsx)(n.code,{children:"int"})," to support non-numeric identifiers (e.g., ",(0,i.jsx)(n.code,{children:"UUID"}),"s)."]}),"\n",(0,i.jsx)(n.p,{children:"Create and apply the migration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"serverpod create-migration\ndart run bin/main.dart --apply-migrations\n"})}),"\n",(0,i.jsx)(n.h2,{id:"migration-checklist",children:"Migration checklist"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Update CLI, pubspec files, and Dockerfile (see above)"}),"\n",(0,i.jsx)(n.li,{children:"Update custom Route classes (see Web Server section)"}),"\n",(0,i.jsx)(n.li,{children:"Update enum serialization strategy (see Enum section)"}),"\n",(0,i.jsxs)(n.li,{children:["Replace ",(0,i.jsx)(n.code,{children:"SerializableEntity"})," with ",(0,i.jsx)(n.code,{children:"SerializableModel"})," in custom models"]}),"\n",(0,i.jsxs)(n.li,{children:["Update custom ",(0,i.jsx)(n.code,{children:"AuthenticationInfo"})," usage (see Authentication section)"]}),"\n",(0,i.jsx)(n.li,{children:"Test and deploy"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"web-server-relic-framework",children:"Web server (Relic framework)"}),"\n",(0,i.jsxs)(n.p,{children:["Serverpod 3.0 integrates the ",(0,i.jsx)(n.a,{href:"https://pub.dev/packages/relic",children:"Relic framework"})," for web server functionality, bringing it out of experimental status. This provides improved performance, better request/response handling, and built-in WebSocket support."]}),"\n",(0,i.jsx)(n.h3,{id:"routehandlecall-signature",children:"Route.handleCall signature"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Serverpod 2.x"}),(0,i.jsx)(n.th,{children:"Serverpod 3.0"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Request"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HttpRequest request"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Request request"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Return"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Future<bool>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FutureOr<Result>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Response"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"return true"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"return Response.ok()"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"import 'dart:io';\n\nclass MyRoute extends Route {\n  @override\n  Future<bool> handleCall(Session session, HttpRequest request) async {\n    request.response.write('<html><body>Hello</body></html>');\n    return true;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class MyRoute extends Route {\n  @override\n  FutureOr<Result> handleCall(Session session, Request request) async {\n    return Response.ok(\n      body: Body.fromString('<html><body>Hello</body></html>', mimeType: MimeType.html),\n    );\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Changes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"HttpRequest"})," \u2192 ",(0,i.jsx)(n.code,{children:"Request"})," (from Relic)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Future<bool>"})," \u2192 ",(0,i.jsx)(n.code,{children:"FutureOr<Result>"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"request.remoteIpAddress"})," \u2192 ",(0,i.jsx)(n.code,{children:"request.remoteInfo"})," (both return ",(0,i.jsx)(n.code,{children:"String"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"request.headers.value('name')"})," \u2192 ",(0,i.jsx)(n.code,{children:"request.headers['name']"})]}),"\n",(0,i.jsxs)(n.li,{children:["Return ",(0,i.jsx)(n.code,{children:"Response"})," instead of ",(0,i.jsx)(n.code,{children:"bool"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"widget-class-names",children:"Widget class names"}),"\n",(0,i.jsx)(n.p,{children:"The web server widget classes have been reorganized for better clarity. Legacy class names are deprecated but still available for backward compatibility."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Old (Deprecated)"}),(0,i.jsx)(n.th,{children:"New"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AbstractWidget"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WebWidget"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Widget"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TemplateWidget"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WidgetList"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ListWidget"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WidgetJson"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"JsonWidget"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WidgetRedirect"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RedirectWidget"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"WidgetRoute"})," class remains unchanged and continues to be the base class for web routes."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<Widget> build(...) => Widget(name: 'page')..values = {...};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<WebWidget> build(...) => TemplateWidget(name: 'page', values: {...});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"static-route-updates",children:"Static route updates"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"RouteStaticDirectory"})," class has been deprecated in favor of ",(0,i.jsx)(n.code,{children:"StaticRoute.directory()"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  RouteStaticDirectory(\n    serverDirectory: 'web/static',\n    basePath: '/',\n  ),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  StaticRoute.directory(Directory('web/static')),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The new ",(0,i.jsx)(n.code,{children:"StaticRoute"})," provides better cache control options. You can use the built-in static helper methods for common caching scenarios:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  StaticRoute.directory(\n    Directory('web/static'),\n    cacheControlFactory: StaticRoute.publicImmutable(maxAge: 3600),\n  ),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:"Available cache control factory methods:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StaticRoute.public(maxAge: seconds)"})," - Public cache with optional max-age"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StaticRoute.publicImmutable(maxAge: seconds)"})," - Public immutable cache with optional max-age"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StaticRoute.privateNoCache()"})," - Private cache with no-cache directive"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StaticRoute.noStore()"})," - No storage allowed"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can also provide a custom factory function:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  StaticRoute.directory(\n    Directory('web/static'),\n    cacheControlFactory: (ctx, fileInfo) => CacheControlHeader(\n      publicCache: true,\n      maxAge: 3600,\n      immutable: true,\n    ),\n  ),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sessionrequest-property",children:"Session.request property"}),"\n",(0,i.jsxs)(n.p,{children:["With the Relic framework integration, the ",(0,i.jsx)(n.code,{children:"Session"})," object now provides access to the underlying HTTP request through the ",(0,i.jsx)(n.code,{children:"request"})," property. This allows endpoint methods to access request metadata such as client IP address and headers directly from the session."]}),"\n",(0,i.jsxs)(n.p,{children:["Use optional chaining as it's ",(0,i.jsx)(n.code,{children:"null"})," on some session types (e.g., sessions created for background tasks)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class MyEndpoint extends Endpoint {\n  Future<String> getClientInfo(Session session) async {\n    final ip = session.request?.remoteInfo ?? 'unknown';\n    final userAgent = session.request?.headers.userAgent ?? 'unknown';\n    return 'IP: $ip, UA: $userAgent';\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"Serverpod 3.0 includes several changes to the authentication system that improve type safety and performance."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Besides minor interface changes described in this section, the legacy authentication system is still supported and can be used alongside the new version. This allows to safely upgrade your project to Serverpod 3.0 while using the legacy authentication and gradually migrate to the new one."})}),"\n",(0,i.jsx)(n.h3,{id:"custom-authentication-handlers",children:"Custom authentication handlers"}),"\n",(0,i.jsxs)(n.p,{children:["In the new authentication system, the default authentication header has changed from ",(0,i.jsx)(n.code,{children:"Basic"})," to ",(0,i.jsx)(n.code,{children:"Bearer"})," - which is now officially supported. This introduced a change for custom ",(0,i.jsx)(n.code,{children:"AuthenticationHandler"})," implementations: the ",(0,i.jsx)(n.code,{children:"token"})," parameter will now receive the token unwrapped from the ",(0,i.jsx)(n.code,{children:"Bearer"})," prefix - just as it does for ",(0,i.jsx)(n.code,{children:"Basic"})," tokens."]}),"\n",(0,i.jsxs)(n.p,{children:["If your application relies on the default ",(0,i.jsx)(n.code,{children:"authenticationHandler"})," function, no change is required. Only custom implementations that previously implemented ",(0,i.jsx)(n.code,{children:"Bearer"})," authentication will need to be updated to expect the unwrapped token."]}),"\n",(0,i.jsxs)(n.p,{children:["Another change when using custom authentication handlers is that tokens without scheme prefix are no longer supported by default to enforce HTTP header standards. The preferred fix is to wrap the token with the ",(0,i.jsx)(n.code,{children:"Bearer"})," prefix, but this will invalidate existing tokens. If you are you are using a custom authentication handler in production and need to keep the old behavior, you can set the ",(0,i.jsx)(n.code,{children:"validateHeaders"})," parameter to ",(0,i.jsx)(n.code,{children:"false"})," in your ",(0,i.jsx)(n.code,{children:"production.yaml"})," config file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiServer:\n  ...\n\ninsightsServer:\n  ...\n\nwebServer:\n  ...\n\nvalidateHeaders: false # <-- Add this line\n\nsessionLogs:\n  consoleEnabled: false\n"})}),"\n",(0,i.jsx)(n.h3,{id:"authenticationinfo-changes",children:"AuthenticationInfo changes"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"AuthenticationInfo"})," class has been updated:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"authId"})," is now non-nullable (previously optional)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userIdentifier"})," parameter type changed from ",(0,i.jsx)(n.code,{children:"Object"})," to ",(0,i.jsx)(n.code,{children:"String"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"sessionauthenticated-is-now-synchronous",children:"session.authenticated is now synchronous"}),"\n",(0,i.jsxs)(n.p,{children:["Authentication is now resolved when the session is created, making ",(0,i.jsx)(n.code,{children:"session.authenticated"})," synchronous. This improves performance by eliminating repeated async lookups."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (async):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final auth = await session.authenticated;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (sync):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final auth = session.authenticated;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"client-auth-key-provider",children:"Client auth key provider"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"authKeyProvider"})," interface replaces the previous ",(0,i.jsx)(n.code,{children:"authenticationKeyManager"}),". This interface has been simplified to make it more explicit what the client needs\u2014it now only requires something that can provide an auth key wrapped as a header."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Client(host)..authenticationKeyManager = myManager;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Client(host)..authKeyProvider = myProvider;\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["To keep backwards compatibility with the old authentication system, the ",(0,i.jsx)(n.code,{children:"FlutterAuthenticationKeyManager"})," from the legacy package now implements the ",(0,i.jsx)(n.code,{children:"AuthKeyProvider"})," interface, so you can safely pass it to the client as the ",(0,i.jsx)(n.code,{children:"authKeyProvider"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"enum-serialization",children:"Enum serialization"}),"\n",(0,i.jsxs)(n.p,{children:["The default enum serialization strategy has changed from ",(0,i.jsx)(n.code,{children:"byIndex"})," to ",(0,i.jsx)(n.code,{children:"byName"}),". This change improves robustness when reordering or adding enum values, as serialized data remains valid even if the enum definition changes. With ",(0,i.jsx)(n.code,{children:"byName"}),", the string representation is stored instead of the numeric index, making your data more resilient and easier to debug."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Keep old behavior:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enum: UserRole\nserialized: byIndex # Add this\nvalues:\n  - admin\n  - user\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use new default:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enum: UserRole\n# serialized: byName - is now default\nvalues:\n  - admin\n  - user\n"})}),"\n",(0,i.jsx)(n.h2,{id:"model-changes",children:"Model changes"}),"\n",(0,i.jsx)(n.h3,{id:"serializableentity-removed",children:"SerializableEntity removed"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"SerializableEntity"})," class, deprecated since Serverpod 2.0, has been removed. Replace ",(0,i.jsx)(n.code,{children:"extends SerializableEntity"})," with ",(0,i.jsx)(n.code,{children:"implements SerializableModel"})," in your custom model classes."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class CustomClass extends SerializableEntity {\n  Map<String, dynamic> toJson() => {'name': name};\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class CustomClass implements SerializableModel {\n  Map<String, dynamic> toJson() => {'name': name};\n  factory CustomClass.fromJson(Map<String, dynamic> json) => CustomClass(json['name']);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"removed-yaml-keywords",children:"Removed YAML keywords"}),"\n",(0,i.jsxs)(n.p,{children:["The following deprecated YAML keywords have been removed. Run ",(0,i.jsx)(n.code,{children:"serverpod generate"})," to see errors with migration guidance."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Old keyword"}),(0,i.jsx)(n.th,{children:"Replacement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parent=table"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"relation(parent=table)"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"database"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scope=serverOnly"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"api"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"!persist"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"class: Company\ntable: company\nfields:\n  name: String\n  ceoId: int, parent=employee\n  internalNotes: String, database\n  tempData: String, api\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"class: Company\ntable: company\nfields:\n  name: String\n  ceoId: int, relation(parent=employee)\n  internalNotes: String, scope=serverOnly\n  tempData: String, !persist\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deprecated-apis",children:"Deprecated APIs"}),"\n",(0,i.jsx)(n.p,{children:"The following APIs have been deprecated but will continue to work for the foreseeable future to maintain compatibility with older clients. They will be removed in a future major version:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Legacy streaming endpoints \u2192 Use ",(0,i.jsx)(n.a,{href:"/concepts/streams",children:"streaming methods"})," for new code"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsx)(n.p,{children:"Additional improvements in Serverpod 3.0:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Session log user ID as String:"})," The session log table now stores authenticated user IDs as ",(0,i.jsx)(n.code,{children:"String"})," instead of ",(0,i.jsx)(n.code,{children:"int"}),". This enables support for non-numeric identifiers such as UUIDs. A database migration is required (see ",(0,i.jsx)(n.a,{href:"#create-and-apply-migrations",children:"Create and apply migrations"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Graceful SIGTERM shutdown:"})," The server now handles ",(0,i.jsx)(n.code,{children:"SIGTERM"})," signals gracefully, allowing in-flight requests to complete before shutting down. This improves behavior in containerized deployments (Docker, Kubernetes) where orchestrators send ",(0,i.jsx)(n.code,{children:"SIGTERM"})," before terminating processes."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Auto-stop on integrity check failure:"})," In development mode, the server now automatically stops if the database integrity check fails (e.g., schema mismatch). This prevents running with an inconsistent database state during development."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://pub.dev/packages/relic",children:"Relic Framework"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/serverpod/serverpod/issues",children:"GitHub Issues"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://serverpod.dev/discord",children:"Discord Community"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453(e,n,s){s.d(n,{R:()=>d,x:()=>a});var r=s(96540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);