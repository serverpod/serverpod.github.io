"use strict";(globalThis.webpackChunkserverpod_docs=globalThis.webpackChunkserverpod_docs||[]).push([[74838],{22817(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"concepts/webserver/static-files","title":"Static files","description":"Static assets like images, CSS, and JavaScript files are essential for web","source":"@site/versioned_docs/version-3.2.0/06-concepts/18-webserver/05-static-files.md","sourceDirName":"06-concepts/18-webserver","slug":"/concepts/webserver/static-files","permalink":"/3.2.0/concepts/webserver/static-files","draft":false,"unlisted":false,"editUrl":"https://github.com/serverpod/serverpod_docs/tree/main/versioned_docs/version-3.2.0/06-concepts/18-webserver/05-static-files.md","tags":[],"version":"3.2.0","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Middleware","permalink":"/3.2.0/concepts/webserver/middleware"},"next":{"title":"Server-Side HTML","permalink":"/3.2.0/concepts/webserver/server-side-html"}}');var i=t(74848),r=t(28453);const c={},a="Static files",o={},l=[{value:"Serving static files",id:"serving-static-files",level:2},{value:"Cache control",id:"cache-control",level:2},{value:"Static file cache-busting",id:"static-file-cache-busting",level:2},{value:"Generating versioned urls",id:"generating-versioned-urls",level:3},{value:"Conditional requests (<code>Etags</code> and <code>Last-Modified</code>)",id:"conditional-requests-etags-and-last-modified",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"static-files",children:"Static files"})}),"\n",(0,i.jsxs)(n.p,{children:["Static assets like images, CSS, and JavaScript files are essential for web\napplications. The ",(0,i.jsx)(n.code,{children:"StaticRoute.directory()"})," method makes it easy to serve entire\ndirectories with automatic content-type detection for common file formats."]}),"\n",(0,i.jsx)(n.h2,{id:"serving-static-files",children:"Serving static files"}),"\n",(0,i.jsxs)(n.p,{children:["The simplest way to serve static files is to use ",(0,i.jsx)(n.code,{children:"StaticRoute.directory()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final staticDir = Directory('web/static');\n\npod.webServer.addRoute(\n  StaticRoute.directory(staticDir),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This serves all files from the ",(0,i.jsx)(n.code,{children:"web/static"})," directory at the ",(0,i.jsx)(n.code,{children:"/static"})," path.\nFor example, ",(0,i.jsx)(n.code,{children:"web/static/logo.png"})," becomes accessible at ",(0,i.jsx)(n.code,{children:"/static/logo.png"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"/**"})," tail-match wildcard is required for serving directories. It matches all\npaths under the prefix, allowing ",(0,i.jsx)(n.code,{children:"StaticRoute"})," to map URLs to file system paths.\nSee ",(0,i.jsx)(n.a,{href:"routing#wildcards",children:"Routing"})," for more on wildcards."]})}),"\n",(0,i.jsx)(n.h2,{id:"cache-control",children:"Cache control"}),"\n",(0,i.jsxs)(n.p,{children:["Control how browsers and CDNs cache your static files using the\n",(0,i.jsx)(n.code,{children:"cacheControlFactory"})," parameter:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"pod.webServer.addRoute(\n  StaticRoute.directory(\n    staticDir,\n    cacheControlFactory: StaticRoute.publicImmutable(maxAge: const Duration(minutes: 5)),\n  ),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"static-file-cache-busting",children:"Static file cache-busting"}),"\n",(0,i.jsx)(n.p,{children:"When deploying static assets, browsers and CDNs (like CloudFront) cache files\naggressively for performance. This means updated files may not be served to\nusers unless you implement a cache-busting strategy."}),"\n",(0,i.jsxs)(n.p,{children:["Serverpod provides ",(0,i.jsx)(n.code,{children:"CacheBustingConfig"})," to automatically version your static\nfiles. For more details, see the ",(0,i.jsx)(n.a,{href:"https://docs.dartrelic.dev/",children:"Relic documentation"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final staticDir = Directory('web/static');\n\nfinal cacheBustingConfig = CacheBustingConfig(\n  mountPrefix: '/static',\n  fileSystemRoot: staticDir,\n  separator: '@',  // or use custom separator like '___'\n);\n\npod.webServer.addRoute(\n  StaticRoute.directory(\n    staticDir,\n    cacheBustingConfig: cacheBustingConfig,\n    cacheControlFactory: StaticRoute.publicImmutable(maxAge: const Duration(minutes: 5)),\n  ),\n  '/static/**',\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generating-versioned-urls",children:"Generating versioned urls"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"assetPath()"})," method to generate cache-busted URLs for your assets:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// In your route handler\nfinal imageUrl = await cacheBustingConfig.assetPath('/static/logo.png');\n// Returns: /static/logo@<hash>.png\n\n// Pass to your template\nreturn MyPageWidget(logoUrl: imageUrl);\n"})}),"\n",(0,i.jsx)(n.p,{children:"The cache-busting system:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Automatically generates content-based hashes for asset versioning"}),"\n",(0,i.jsxs)(n.li,{children:["Allows custom separators (default ",(0,i.jsx)(n.code,{children:"@"}),", but you can use ",(0,i.jsx)(n.code,{children:"___"})," or any other)"]}),"\n",(0,i.jsx)(n.li,{children:"Preserves file extensions"}),"\n",(0,i.jsxs)(n.li,{children:["Works transparently - requesting ",(0,i.jsx)(n.code,{children:"/static/logo@abc123.png"})," serves\n",(0,i.jsx)(n.code,{children:"/static/logo.png"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"conditional-requests-etags-and-last-modified",children:["Conditional requests (",(0,i.jsx)(n.code,{children:"Etags"})," and ",(0,i.jsx)(n.code,{children:"Last-Modified"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"StaticRoute"})," automatically supports HTTP conditional requests through Relic's\n",(0,i.jsx)(n.code,{children:"StaticHandler"}),". This provides efficient caching without transferring file\ncontent when unchanged:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Supported features:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ETag headers"})," - Content-based fingerprinting for cache validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Last-Modified headers"})," - Timestamp-based cache validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"If-None-Match"})," - Client sends ETag, server returns 304 Not Modified if\nunchanged"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"If-Modified-Since"})," - Client sends timestamp, server returns 304 if not\nmodified"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These work automatically without configuration:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Initial request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'GET /static/logo.png HTTP/1.1\nHost: example.com\n\nHTTP/1.1 200 OK\nETag: "abc123"\nLast-Modified: Tue, 15 Nov 2024 12:00:00 GMT\nContent-Length: 12345\n\n[file content]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Subsequent request with ETag:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'GET /static/logo.png HTTP/1.1\nHost: example.com\nIf-None-Match: "abc123"\n\nHTTP/1.1 304 Not Modified\nETag: "abc123"\n\n[no body - saves bandwidth]\n'})}),"\n",(0,i.jsx)(n.p,{children:"When combined with cache-busting, conditional requests provide a fallback\nvalidation mechanism even for cached assets, ensuring efficient delivery while\nmaintaining correctness."}),"\n",(0,i.jsxs)(n.p,{children:["For dynamic content that changes per request, see ",(0,i.jsx)(n.a,{href:"server-side-html",children:"Server-side HTML"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>c,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);